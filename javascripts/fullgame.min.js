function initControls(){setupjoy(),window.addEventListener("keydown",keydown,!1),window.addEventListener("keyup",keyup,!1),window.addEventListener("keypress",keypress,!1),canvas.onmousedown=onmousedown,canvas.addEventListener("touchstart",ontouchstart,!1),canvas.addEventListener("touchmove",ontouchmove,!1),canvas.addEventListener("touchend",ontouchend,!1),tiltoffset=window.screen.orientation.angle,console.log("Offset: "),console.log(window.screen.orientation),window.DeviceOrientationEvent||(console.log("DeviceOrientation is not supported"),nojoystick=!1,setupjoy());try{if(nojoystick){var e=new FULLTILT.DeviceOrientation({type:"game"});e.start(function(){if(nojoystick){var t=e.getScreenAdjustedEuler().alpha;if(!t)return console.log("DeviceOrientation is not supported"),nojoystick=!1,void setupjoy();t>180&&(t-=360),t=Math.PI*t/180;var o=getDifference(t,pogo.frame.body.angle);pogo.frame.body.angularVelocity=3*o}})}}catch(e){console.log("DeviceOrientation library is not supported"),nojoystick=!1,setupjoy()}}function setupjoy(){fixedjoy&&(jloc={x:3*w/4,y:3*h/4},lastmouse={x:jloc.x,y:jloc.y})}function handleOrientation(e){var t=-e.gamma+tiltoffset;console.log(t),t=2*Math.PI*t/360;var o=getDifference(t,pogo.frame.body.angle);pogo.frame.body.angularVelocity=3*o}function ontouchstart(e){if(e.preventDefault(),nojoystick)return pogo.spring.restLength=1.25,void pogo.spring.applyForce();pogo.spring.restLength=.25,pogo.spring.applyForce(),currentmouse={clientX:e.touches[0].clientX,clientY:e.touches[0].clientY};var t=Math.atan2(currentmouse.clientX-lastmouse.x,currentmouse.clientY-lastmouse.y);pogo.frame.body.angularVelocity=3*(t-pogo.frame.body.angle)}function ontouchmove(e){nojoystick||(currentmouse={clientX:e.touches[0].clientX,clientY:e.touches[0].clientY},e.preventDefault(),null!=lastmouse.x?(lastmouse.x!=e.touches[0].clientX,a=lastmouse.x-e.touches[0].clientX,b=lastmouse.y-e.touches[0].clientY,reacttocontrols()):lastmouse=fixedjoy?{x:jloc.x,y:jloc.y}:{x:e.touches[0].clientX,y:e.touches[0].clientY},mousedrag=!0)}function ontouchend(e){return nojoystick?(pogo.spring.restLength=.25,void pogo.spring.applyForce()):(currentmouse=null,mousedrag=!1,lastmouse={x:null,y:null},pogo.frame.body.angularVelocity=0,pogo.spring.restLength=1.25,void pogo.spring.applyForce())}function onmousedown(){pogo.spring.restLength=.25,pogo.spring.applyForce(),nojoystick||(document.onmousemove=function(e){currentmouse=e,null!=lastmouse.x?(lastmouse.x!=e.clientX,a=lastmouse.x-e.clientX,b=lastmouse.y-e.clientY,reacttocontrols()):lastmouse=fixedjoy?{x:jloc.x,y:jloc.y}:{x:e.clientX,y:e.clientY},mousedrag=!0}),this.onmouseup=function(){document.onmousemove=null,currentmouse=null,mousedrag=!1,lastmouse={x:null,y:null},pogo.frame.body.angularVelocity=0,pogo.spring.restLength=1.25,pogo.spring.applyForce()}}function reacttocontrols(){var e=Math.atan2(currentmouse.clientX-lastmouse.x,currentmouse.clientY-lastmouse.y),t=getDifference(e,pogo.frame.body.angle);pogo.frame.body.angularVelocity=3*t}function getDifference(e,t){var o=e-t;return o=function(e,t){return e-Math.floor(e/t)*t}(o+Math.PI,2*Math.PI),o-=Math.PI}function keydown(e){[32,37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault(),e.keyCode==keys.up&&(keyspressed.up=!0),e.keyCode==keys.space&&(keyspressed.space=!0),e.keyCode==keys.left&&(keyspressed.left=!0),e.keyCode==keys.right&&(keyspressed.right=!0)}function keyup(e){e.keyCode==keys.up&&(keyspressed.up=!1),e.keyCode==keys.space&&(keyspressed.space=!1),e.keyCode==keys.left&&(keyspressed.left=!1),e.keyCode==keys.right&&(keyspressed.right=!1)}function keypress(e){[32,37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault()}function initControls(){setupjoy(),window.addEventListener("keydown",keydown,!1),window.addEventListener("keyup",keyup,!1),window.addEventListener("keypress",keypress,!1),canvas.onmousedown=onmousedown,canvas.addEventListener("touchstart",ontouchstart,!1),canvas.addEventListener("touchmove",ontouchmove,!1),canvas.addEventListener("touchend",ontouchend,!1),tiltoffset=window.screen.orientation.angle,console.log("Offset: "),console.log(window.screen.orientation),window.DeviceOrientationEvent||(console.log("DeviceOrientation is not supported"),nojoystick=!1,setupjoy());try{if(nojoystick){var e=new FULLTILT.DeviceOrientation({type:"game"});e.start(function(){if(nojoystick){var t=e.getScreenAdjustedEuler().alpha;if(!t)return console.log("DeviceOrientation is not supported"),nojoystick=!1,void setupjoy();t>180&&(t-=360),t=Math.PI*t/180;var o=getDifference(t,pogo.frame.body.angle);pogo.frame.body.angularVelocity=3*o}})}}catch(e){console.log("DeviceOrientation library is not supported"),nojoystick=!1,setupjoy()}}function setupjoy(){fixedjoy&&(jloc={x:3*w/4,y:3*h/4},lastmouse={x:jloc.x,y:jloc.y})}function handleOrientation(e){var t=-e.gamma+tiltoffset;console.log(t),t=2*Math.PI*t/360;var o=getDifference(t,pogo.frame.body.angle);pogo.frame.body.angularVelocity=3*o}function ontouchstart(e){if(e.preventDefault(),nojoystick)return pogo.spring.restLength=1.25,void pogo.spring.applyForce();pogo.spring.restLength=.25,pogo.spring.applyForce(),currentmouse={clientX:e.touches[0].clientX,clientY:e.touches[0].clientY};var t=Math.atan2(currentmouse.clientX-lastmouse.x,currentmouse.clientY-lastmouse.y);pogo.frame.body.angularVelocity=3*(t-pogo.frame.body.angle)}function ontouchmove(e){nojoystick||(currentmouse={clientX:e.touches[0].clientX,clientY:e.touches[0].clientY},e.preventDefault(),null!=lastmouse.x?(lastmouse.x!=e.touches[0].clientX,a=lastmouse.x-e.touches[0].clientX,b=lastmouse.y-e.touches[0].clientY,reacttocontrols()):lastmouse=fixedjoy?{x:jloc.x,y:jloc.y}:{x:e.touches[0].clientX,y:e.touches[0].clientY},mousedrag=!0)}function ontouchend(e){return nojoystick?(pogo.spring.restLength=.25,void pogo.spring.applyForce()):(currentmouse=null,mousedrag=!1,lastmouse={x:null,y:null},pogo.frame.body.angularVelocity=0,pogo.spring.restLength=1.25,void pogo.spring.applyForce())}function onmousedown(){pogo.spring.restLength=.25,pogo.spring.applyForce(),nojoystick||(document.onmousemove=function(e){currentmouse=e,null!=lastmouse.x?(lastmouse.x!=e.clientX,a=lastmouse.x-e.clientX,b=lastmouse.y-e.clientY,reacttocontrols()):lastmouse=fixedjoy?{x:jloc.x,y:jloc.y}:{x:e.clientX,y:e.clientY},mousedrag=!0}),this.onmouseup=function(){document.onmousemove=null,currentmouse=null,mousedrag=!1,lastmouse={x:null,y:null},pogo.frame.body.angularVelocity=0,pogo.spring.restLength=1.25,pogo.spring.applyForce()}}function reacttocontrols(){var e=Math.atan2(currentmouse.clientX-lastmouse.x,currentmouse.clientY-lastmouse.y),t=getDifference(e,pogo.frame.body.angle);pogo.frame.body.angularVelocity=3*t}function getDifference(e,t){var o=e-t;return o=function(e,t){return e-Math.floor(e/t)*t}(o+Math.PI,2*Math.PI),o-=Math.PI}function keydown(e){[32,37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault(),e.keyCode==keys.up&&(keyspressed.up=!0),e.keyCode==keys.space&&(keyspressed.space=!0),e.keyCode==keys.left&&(keyspressed.left=!0),e.keyCode==keys.right&&(keyspressed.right=!0)}function keyup(e){e.keyCode==keys.up&&(keyspressed.up=!1),e.keyCode==keys.space&&(keyspressed.space=!1),e.keyCode==keys.left&&(keyspressed.left=!1),e.keyCode==keys.right&&(keyspressed.right=!1)}function keypress(e){[32,37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault()}function clearTimer(){null!==restarttimer&&clearTimeout(restarttimer)}function changeOrientation(){var e=document.getElementById("myCanvas");if(e.width!=window.innerWidth){var t=e.width;document.getElementById("myCanvas").width=e.height,document.getElementById("myCanvas").height=t}canvas=document.getElementById("myCanvas"),w=canvas.width,h=canvas.height,ctx=canvas.getContext("2d"),ctx.lineWidth=.05,setupjoy()}function fullscreen(){document.getElementById("myCanvas").style.width="100%",document.getElementById("myCanvas").style.height="100%",document.getElementById("myCanvas").width=window.innerWidth,document.getElementById("myCanvas").height=window.innerHeight}function resetHealth(){document.getElementById("health").style.animation="fadeinout 4s linear forwards";var e=document.getElementById("health");e.style.display="block";var t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),document.getElementById("health").innerHTML='<i class="fa fa-heart" aria-hidden="true"></i> <i id="h2" class="fa fa-heart" aria-hidden="true"></i> <i id="h3" class="fa fa-heart" aria-hidden="true"></i>'}function loseHeart(){document.getElementById("health").style.animation="fadeinout 4s linear forwards";var e=document.getElementById("health");e.style.display="block";var t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),2==lives&&(document.getElementById("health").innerHTML='<i class="fa fa-heart" aria-hidden="true"></i> <i id="h2" class="fa fa-heart" aria-hidden="true"></i> <i id="h3" class="fa fa-heart-o" aria-hidden="true"></i>'),1==lives&&(document.getElementById("health").innerHTML='<i class="fa fa-heart" aria-hidden="true"></i> <i id="h2" class="fa fa-heart-o" aria-hidden="true"></i> <i id="h3" class="fa fa-heart-o" aria-hidden="true"></i>'),lives<=0&&(document.getElementById("health").innerHTML='<i class="fa fa-heart-o" aria-hidden="true"></i> <i id="h2" class="fa fa-heart-o" aria-hidden="true"></i> <i id="h3" class="fa fa-heart-o" aria-hidden="true"></i>')}function processopts(){var e,t,o;switch(e=t=o=!1,$(".dropdowntitle").val()){case"Joystick":t=!0,o=!1;break;case"Unfixed Joystick":t=!1,o=!1;break;case"Gyro":o=!0;break;case"Keyboard":e=!0;case"":}updatehelp(o,e,t)}function saveopts(){saveopts1(!0)}function saveopts1(e){switch(keyboard=!1,$(".dropdowntitle").val()){case"Joystick":fixedjoy=!0,nojoystick=!1;break;case"Unfixed Joystick":fixedjoy=!1,nojoystick=!1;break;case"Gyro":nojoystick=!0;break;case"Keyboard":keyboard=!0;case"":}updatehelp(nojoystick,keyboard,fixedjoy),setupjoy()}function onload(){window.mobileAndTabletcheck=function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e},mobile=window.mobileAndTabletcheck(),mobile?($(".keyboard").hide(),$(".dropdowntitle").html('Gyro <span class="caret">'),$(".dropdowntitle").val("Gyro")):$(".gyro").hide(),$(".controls").clone().appendTo(".controlsdiv"),$(".helptxtdiv").clone().appendTo(".tutcontrolsdiv"),$(".dropdown-menu li a").on("click",function(){$(".dropdowntitle").html($(this).text()+' <span class="caret">'),$(".dropdowntitle").val($(this).text()),processopts()}),fullscreen(),window.addEventListener("orientationchange",function(){changeOrientation()},!1),window.onresize=function(){w=canvas.width=window.innerWidth,w=canvas.height=window.innerHeight,ctx=canvas.getContext("2d"),ctx.lineWidth=.05}}function init(){if(gameOver=!1,pendingquit=!1,console.log("Mobile or tablet: "+mobile),nojoystick=mobile,updatehelp(nojoystick,keyboard,fixedjoy),mobile){elems=document.getElementsByClassName("dtop");for(var e=0;e<elems.length;e++)elems[e].style.display="none"}canvas=document.getElementById("myCanvas"),w=canvas.width,h=canvas.height,ctx=canvas.getContext("2d"),ctx.lineWidth=.05,noise.seed(10*Math.random()),tutorialm?inittut():initgame(),initControls()}function copysec(e){for(var t=[],o=0;o<e.o.length;o++){var n=new p2.Circle({radius:.5,sensor:!0}),i=new p2.Body({mass:1,position:e.o[o].position,fixedX:e.o[o].fixedX,fixedY:e.o[o].fixedY,velocity:e.o[o].velocity});i.addShape(n),n.collisionGroup=OBSTACLE,n.collisionMask=FRAME|STICK,t.push(i)}var a=new Object;a.shape=new p2.Heightfield({heights:e.d,elementWidth:2}),a.body=new p2.Body({position:e.h.body.position}),a.shape.collisionGroup=GROUND,a.shape.collisionMask=FRAME|STICK,a.body.addShape(a.shape);var l=null;if(null!=e.h1){l=new Object,l.body=new p2.Body({position:e.h1.body.position}),l.body.fromPolygon(JSON.parse(JSON.stringify(e.h1verts)));for(var s=0;s<l.body.shapes.length;s++)l.body.shapes[s].collisionGroup=GROUND,l.body.shapes[s].collisionMask=FRAME|STICK,l.body.shapes[s].material=icematerial}return{d:e.d,h:a,h1:l,h1verts:e.h1verts,o:t,od:e.od,inverts:e.inverts}}function changenum(e,t,o){var n=copysec(e);n.h.body.position[0]+=(t-o)*secwidth;for(var i=0;i<n.o.length;i++)n.o[i].position[0]+=(t-o)*secwidth,n.o[i].velocity=[0,0];return null!=n.h1&&(n.h1.body.position[0]+=(t-o)*secwidth),n}function caveMouthSigmoid(e){return-2*(e/(1+Math.abs(e)))-1}function generateSection(){for(var e=[],t=[],o=!1,n=null,i=null,a=!1,l=0;l<=secwidth/2;l++){var s=(l+secnum*secwidth/2)/10,r=1.75*noise.simplex2(s,0),c=distToTime(secnum*secwidth+2*l);if(c>2)if(c%2<1&&(Math.floor(c)<7||9==Math.floor(c))){r/=1.75;var d=null;if(c%1<=.5){var p=c%1*4-1;d=caveMouthSigmoid(p)*caveDepth}if(c%1>.5){var p=(c-.5)%1*4-1;d=caveMouthSigmoid(-p)*caveDepth}if(r+=d,d<-caveDepth/2||o){var u=r+caveHeight;o||(n=2*l,i=u,o=!0,t.push([5,5]),t.push([0,8])),t.push([2*l-n,u-i]),l%rarity==rarity-2&&l!=secwidth/2&&(Math.random()>.5?r+=2*Math.random():t.push([2*l-n,u-i-1.5*Math.random()-1]))}}else c>=7&&c<9&&(o?r=-2:(r=Math.max(r,1),n=2*l,i=-9,o=!0,a=!0,t.push([0,0])),t.push([2*l-n,1-i]));e.push(r)}var y=new Object;y.shape=new p2.Heightfield({heights:e,elementWidth:2}),y.body=new p2.Body({position:[-1,-1]}),y.shape.collisionGroup=GROUND,y.shape.collisionMask=FRAME|STICK,y.body.addShape(y.shape);if(o){a?t.push([t[t.length-1][0],0]):t.push([t[t.length-1][0],t[t.length-1][1]+5+3]);var h=new Object;h.body=new p2.Body({position:[n-1,i-1]}),h.body.fromPolygon(JSON.parse(JSON.stringify(t)));for(var l=0;l<h.body.shapes.length;l++)h.body.shapes[l].collisionGroup=GROUND,h.body.shapes[l].collisionMask=FRAME|STICK,h.body.shapes[l].material=icematerial}for(var m=[],u=null,g=[],l=1;l<e.length;l++)if(l%rarity==0){var c=Math.floor(distToTime(secnum*secwidth+2*l));u=Math.random()>.5&&0!=c&&c>2&&c%2<1?e[l]+2*Math.random():e[l]+5-2*Math.random(),0==c&&(u+=4),c>2&&c<3&&(u-=20),m.push(u);var f=new p2.Circle({radius:.5,sensor:!0}),v=new p2.Body({mass:1,position:[2*l,u],fixedX:!0,fixedY:!0});v.addShape(f),f.collisionGroup=OBSTACLE,f.collisionMask=FRAME|STICK,g.push(v)}return secnum+=1,null!=h&&t.length<1&&(t=[[-1,1],[-1,0],[1,0],[1,1],[.5,.5]]),{d:e,h:y,h1:h,h1verts:t,o:g,od:m,inverts:new Array(g.length).fill(!1)}}function addSection(e){world.addBody(e.h.body);for(var t=0;t<e.o.length;t++)world.addBody(e.o[t]);null!=e.h1&&world.addBody(e.h1.body)}function removeSection(e){world.removeBody(e.h.body);for(var t=0;t<e.o.length;t++)world.removeBody(e.o[t]);null!=e.h1&&world.removeBody(e.h1.body)}function getsecwidth(){var e=Math.ceil(w/50+padding),t=Math.ceil(e/rarity)*rarity;return t}function isEmpty(e){return!e||0===e.length}function distToTime(e){return lvlCnt*(1-Math.pow(1-1/lvlCnt,e/lvl1length))}function initgame(){orientationData=new FULLTILT.DeviceOrientation({type:"game"}),initRender(),cookie=getCookie("topscore"),isEmpty(cookie)?document.cookie="topscore=0; expires=Tue, 19 Jan 2038 03:14:07 UTC;":topscore=parseInt(cookie),score=0,secnum=0,lives=3,resetHealth(),gameOver=!1,pendingquit=!1,world=new p2.World({gravity:[0,-7]}),world.defaultContactMaterial.friction=100,world.defaultContactMaterial.restitution=.1,world.addContactMaterial(new p2.ContactMaterial(icematerial,pogomaterial,{restitution:0,friction:25}));var e=w/50/2;pogo={stick:new Object,frame:new Object,spring:null},pogo.stick.shape=new p2.Box({width:.25,height:1.6,material:pogomaterial}),pogo.stick.body=new p2.Body({mass:.25,position:[e,2.75],angularVelocity:angularVelocity,velocity:[5,0]}),pogo.frame.shape=new p2.Box({width:.5,height:1.5,material:pogomaterial}),pogo.frame.body=new p2.Body({mass:3,position:[e,3],angularVelocity:angularVelocity,velocity:[5,0]}),pogo.frame.body.addShape(pogo.frame.shape),pogo.stick.body.addShape(pogo.stick.shape),world.addBody(pogo.frame.body),world.addBody(pogo.stick.body);var t=new p2.PrismaticConstraint(pogo.frame.body,pogo.stick.body,{localAnchorA:[0,.5],localAnchorB:[0,.5],localAxisA:[0,1],disableRotationalLock:!0}),o=new p2.PrismaticConstraint(pogo.frame.body,pogo.stick.body,{localAnchorA:[0,0],localAnchorB:[0,1],localAxisA:[0,1],disableRotationalLock:!0});t.setLimits(-1,-.4),world.addConstraint(o),world.addConstraint(t),pogo.spring=new p2.LinearSpring(pogo.frame.body,pogo.stick.body,{restLength:restLength,stiffness:stiffness,damping:damping,localAnchorA:[0,0],localAnchorB:[0,0]}),world.addSpring(pogo.spring),secwidth=getsecwidth(),sectionA=generateSection(),sectionB=changenum(generateSection(),1,0),addSection(sectionA),addSection(sectionB),pogo.frame.shape.collisionGroup=FRAME,pogo.stick.shape.collisionGroup=STICK,pogo.frame.shape.collisionMask=GROUND|OBSTACLE,pogo.stick.shape.collisionMask=GROUND|OBSTACLE,world.on("postStep",updateObstacles),world.on("beginContact",function(e){if(e.bodyA==pogo.frame.body||e.bodyB==pogo.frame.body){var t=e.bodyA==sectionA.h.body||e.bodyB==sectionA.h.body;t=t||e.bodyA==sectionB.h.body||e.bodyB==sectionB.h.body,t?(lives=0,loseHeart()):(lives-=1,loseHeart()),(lives<=0||t)&&(gameOver=!0,leftplay=!1)}})}function updateObstacles(){var e=distToTime((secnum-1)*secwidth);if(e>3)if(e<5){if(null===sectionA.h1,!0)for(var t=0;t<sectionA.o.length;t++)sectionA.o[t].fixedY=!1,sectionA.o[t].velocity[1]=2.5*Math.sin(3*world.time);if(null===sectionB.h1,!0)for(var t=0;t<sectionB.o.length;t++)sectionB.o[t].fixedY=!1,sectionB.o[t].velocity[1]=2.5*Math.sin(3*world.time)}else{var o=function(e,t,o){var n=[t[0]-e[0],t[1]-e[1]],i=Math.sqrt(n[0]*n[0]+n[1]*n[1]);if(i<=0)return console.log("zero mag! target reached!"),[0,0];var a=Math.sin(Math.min(i,9)/10*Math.PI);return a*=3,a=Math.max(a,1),a/i<=0&&console.log("HELP ME!!!!!"),a*=o?-1:1,n=[n[0]*a/i,n[1]*a/i]};if(null===sectionA.h1,!0)for(var t=0;t<sectionA.o.length;t++){var n=sectionA.o[t].position,i=pogo.stick.body.position;sectionA.o[t].velocity=o(n,i,sectionA.inverts[t])}if(null===sectionB.h1,!0)for(var t=0;t<sectionB.o.length;t++){var i=sectionB.o[t].position,n=pogo.stick.body.position;sectionB.o[t].velocity=o(n,i,sectionB.inverts[t])}}}function gohome(){home=!0,console.log(oldlabel),$(".dropdowntitle").val(oldlabel),document.getElementById("pausebutton").className="circlebutton",document.getElementById("helpbutton").className="circlebutton",document.getElementById("settingsbutton").className="circlebutton",document.getElementById("pausebutton").style.display="none",document.getElementById("helpbutton").style.display="none",document.getElementById("settingsbutton").style.display="none",document.getElementById("mainmenu").style.display="inline",document.getElementById("mainmenu").style.opacity="1",document.getElementById("myCanvas").style.display="none",document.getElementById("gamearea").style.backgroundColor="white",document.getElementById("homebutton").style.display="none",document.getElementById("tutnextb").style.display="none",document.getElementById("health").style.display="none",clearTimer(),gameOver&&(leftplay=!0),tutorialm=!1,pause=!1}function play(){tutorialm=!1,home=!1,ga("send","event",{eventCategory:"Menu Interaction",eventAction:"click",eventLabel:"play"}),pause&&back(),document.getElementById("pausebutton").className="circlebutton",document.getElementById("helpbutton").className="circlebutton",document.getElementById("settingsbutton").className="circlebutton",document.getElementById("helpbutton").style.display="none",document.getElementById("settingsbutton").style.display="none",document.getElementById("mainmenu").style.display="none",document.getElementById("mainmenu").style.opacity="0",document.getElementById("myCanvas").style.display="inline",document.getElementById("pausebutton").innerHTML='<i class="fa fa-pause"></i>',document.getElementById("pausebutton").style.display="block",document.getElementById("myCanvas").style.opacity="1",document.getElementById("gamearea").style.backgroundColor="black",document.getElementById("homebutton").style.display="none",pause||init(),requestAnimationFrame(animate),pause=!1}function pausegame(){$("#errortxt").hide(),tutorialm||(pause?play():(pause=!0,document.getElementById("myCanvas").style.opacity="0.3",document.getElementById("pausebutton").innerHTML='<i class="fa fa-play"></i>',document.getElementById("helpbutton").style.display="inline-block",document.getElementById("settingsbutton").style.display="inline-block",document.getElementById("homebutton").style.display="inline-block",document.getElementById("pausebutton").className="circlebuttoni",document.getElementById("helpbutton").className="circlebuttoni",document.getElementById("settingsbutton").className="circlebuttoni"))}function mainbpprep(){document.getElementById("mainmenu").style.display="none",document.getElementById("mainmenu").style.opacity="0",document.getElementById("myCanvas").style.display="inline",document.getElementById("pausebutton").innerHTML='<i class="fa fa-pause"></i>',document.getElementById("pausebutton").style.display="block",document.getElementById("myCanvas").style.opacity="1",document.getElementById("gamearea").style.backgroundColor="black",init(),animate(),pause=!0,document.getElementById("myCanvas").style.opacity="0.3",document.getElementById("pausebutton").innerHTML='<i class="fa fa-play"></i>',document.getElementById("helpbutton").style.display="inline-block",document.getElementById("settingsbutton").style.display="inline-block",document.getElementById("pausebutton").className="circlebuttoni",document.getElementById("helpbutton").className="circlebuttoni",document.getElementById("settingsbutton").className="circlebuttoni"}function tutorial(){console.log("tutorial() Called"),test(),home=!1,ga("send","event",{eventCategory:"Menu Interaction",eventAction:"click",eventLabel:"tutorial"}),oldlabel=$(".dropdowntitle").val(),document.getElementById("mainmenu").style.display="none",document.getElementById("mainmenu").style.opacity="0",document.getElementById("myCanvas").style.display="inline",document.getElementById("myCanvas").style.opacity="1",document.getElementById("tuthelp").style.display="block",document.getElementById("tuthelp").style.opacity="1",document.getElementById("lvl0").style.display="block",document.getElementById("lvl2").style.display="none",document.getElementById("homebutton").style.display="none",document.getElementById("gamearea").style.backgroundColor="black",tutorialm=!0,pause=!1,lvl=0,init(),animate()}function help(){ga("send","event",{eventCategory:"Menu Interaction",eventAction:"click",eventLabel:"help"}),document.getElementById("helpbutton").style.display="none",document.getElementById("settingsbutton").style.display="none",document.getElementById("helparea").style.display="block",document.getElementById("helparea").style.opacity="1",document.getElementById("homebutton").style.display="none"}function help1(){mainbpprep(),help()}function settings(){ga("send","event",{eventCategory:"Menu Interaction",eventAction:"click",eventLabel:"settings"}),document.getElementById("homebutton").style.display="none",document.getElementById("helpbutton").style.display="none",document.getElementById("settingsbutton").style.display="none",document.getElementById("settings").style.display="block",document.getElementById("settings").style.opacity="1"}function settings1(){mainbpprep(),settings()}function back(){document.getElementById("helpbutton").style.display="inline-block",document.getElementById("settingsbutton").style.display="inline-block",document.getElementById("homebutton").style.display="inline-block",document.getElementById("helparea").style.display="none",document.getElementById("helparea").style.opacity="0",document.getElementById("settings").style.display="none",document.getElementById("settings").style.opacity="0"}function togglefixedjoy(){fixedjoy=!fixedjoy,document.getElementById("fixedjoy").innerHTML=(fixedjoy?"Unfix":"Fix")+" joystick location",fixedjoy?(document.getElementById("unfixjoyhelp").display="none",document.getElementById("fixjoyhelp").display="inherit",setupjoy()):(document.getElementById("unfixjoyhelp").display="inherit",document.getElementById("fixjoyhelp").display="none")}function updatehelp(e,t,o){$(".gyrohelp").hide(),$(".keyboardhelp").hide(),$(".joyhelp").hide(),e||t?t?$(".keyboardhelp").show():$(".gyrohelp").show():($(".joyhelp").show(),$(".fixjoyhelp").hide(),$(".unfixjoyhelp").hide(),o?$(".fixjoyhelp").show():$(".unfixjoyhelp").show())}function toggleColor(){colorful=!colorful,document.getElementById("coltoggle").innerHTML=(colorful?"Disable":"Enable")+" colors"}function updateSky(){color.sky="#"+document.getElementById("skyCP").value}function updateGround(){color.ground="#"+document.getElementById("groundCP").value}function updateBody(){color.body="#"+document.getElementById("bodyCP").value}function updateStick(){color.stick="#"+document.getElementById("stickCP").value}function resetcolors(){colorful||toggleColor(),document.getElementById("skyCP").jscolor.fromString(colordef.sky.slice(1)),document.getElementById("groundCP").jscolor.fromString(colordef.ground.slice(1)),document.getElementById("bodyCP").jscolor.fromString(colordef.body.slice(1)),document.getElementById("stickCP").jscolor.fromString(colordef.stick.slice(1)),color.sky=colordef.sky,color.ground=colordef.ground,color.body=colordef.body,color.stick=colordef.stick}function getHatX(e){var t,o=0,n=e/50-xscroll-w/50/2;if(n>sectionB.h.body.position[0]){var i=(n-sectionB.h.body.position[0])/2;t=Math.floor(i);var a=i%2/2,l=sectionB.d[t+1]-sectionB.d[t]||0;o=50*-(sectionB.d[t]+l*a)}else{var i=(n-sectionA.h.body.position[0])/2;t=Math.floor(i);var a=2*i%2/2,l=sectionA.d[t+1]-sectionA.d[t]||0;o=50*-(sectionA.d[t]+l*a)}return o+=h/2,o+=50*yscroll,o+=50}function updateCloud(){for(var e=0;e<this.snow.particles.length;e++)this.snow.particles[e].x-=this.xoffset,this.snow.particles[e].y-=this.yoffset;this.snow.angle+=.01;for(var e=0;e<this.snow.mp;e++){var t=this.snow.particles[e];t.y+=Math.cos(this.snow.angle+t.d)+1+t.r/2,t.x+=2*Math.sin(this.snow.angle);var o=distToTime(score+pogo.frame.body.position[0]-w/50/2);if(0==this.idx&&6!=Math.floor(o)){var n=getHatX(t.x);o>6&&(n=0,n+=this.h/2,n+=50*yscroll),(t.x>w+5||t.x<-5||t.y>n)&&(e%3>0?this.snow.particles[e]={x:Math.random()*w,y:-10,r:t.r,d:t.d}:Math.sin(this.snow.angle)>0?this.snow.particles[e]={x:-5,y:Math.random()*n,r:t.r,d:t.d}:this.snow.particles[e]={x:w+5,y:Math.random()*n,r:t.r,d:t.d})}}this.x-=this.xoffset,this.y-=this.yoffset;for(var e=0;e<this.rain.particles.length;e++)this.rain.particles[e].x-=this.xoffset,this.rain.particles[e].y-=this.yoffset;for(var e=0;e<this.rain.drops.length;e++)this.rain.drops[e].x-=this.xoffset,this.rain.drops[e].y-=this.yoffset;for(var i,a=this.rain.particles,l=this.rain.drops,e=0;i=a[e];e++){i.x+=i.velX,i.y+=i.velY+5;var s=getHatX(i.x);i.y>s&&(a.splice(e--,1),this.rain.splash(i.x,i.y,i.col))}for(var r,e=0;r=l[e];e++)r.x+=r.velX,r.y+=r.velY,r.radius-=.075,r.alpha>0?r.alpha-=.005:r.alpha=0,r.radius<0&&l.splice(e--,1);for(var e=currentRainAmnt;e--;){if(0!=this.idx){e=0;break}this.rain.addRaindrops(Math.floor(Math.random()*this.w*1.5),-500)}var c=this.x<-cloudSize,d=this.x>2*this.w+cloudSize;(c||d)&&(this.y=(this.h/2-20-this.h/87.5-10)*Math.random()-10,this.speed=Math.random()*(cloudSpeedDef-cloudSpeedMin)+cloudSpeedMin,c?this.x=this.w+cloudSize:this.x=-cloudSize),this.x+=this.speed*cloudSpeed}function addRaindrops(e,t,o){for(o=o||2;o--;)this.particles.push({velX:.25*Math.random(),velY:9*Math.random()+1,x:e,y:t,alpha:1,col:"hsla(200, 100%, 50%, 0.8)"})}function splash(e,t,o,n){for(n=n||splashSize;n--;)this.drops.push({velX:4*Math.random()-2,velY:Math.random()*-4,x:e,y:t,radius:.65+Math.floor(1.6*Math.random()),alpha:1,col:o})}function renderCloud(){var e=Math.floor(distToTime(score+pogo.frame.body.position[0]-w/50/2));if(e>=5&&6!=e){ctx.fillStyle="rgba(255, 255, 255, 0.8)",ctx.beginPath();for(var t=0;t<this.snow.mp;t++){var o=this.snow.particles[t];ctx.moveTo(o.x,o.y),ctx.arc(o.x,o.y,o.r,0,2*Math.PI,!0)}ctx.fill()}for(var n,i=2*Math.PI,a=this.rain.particles,l=this.rain.drops,t=0;n=a[t];t++)ctx.globalAlpha=n.alpha,ctx.fillStyle=n.col,ctx.fillRect(n.x,n.y,n.velY/4,n.velY);for(var s,t=0;s=l[t];t++)ctx.globalAlpha=s.alpha,ctx.fillStyle=s.col,ctx.beginPath(),ctx.arc(s.x,s.y,s.radius,0,i),ctx.fill();ctx.shadowBlur=7,ctx.shadowColor="black",ctx.font=cloudSize+"px FontAwesome",ctx.globalAlpha="0.7",ctx.fillStyle="#ffffff",ctx.textAlign="center",ctx.fillText("",this.x-cloudSize/2,this.y),ctx.shadowBlur=0,ctx.globalAlpha="1"}function Snow(){this.angle=0,this.mp=45,this.particles=[];for(var e=0;e<this.mp;e++)this.particles.push({x:Math.random()*w,y:Math.random()*h,r:4*Math.random()+1,d:Math.random()*this.mp})}function Cloud(e,t,o,n,i,a){this.idx=a,this.x=e,this.y=t,this.xoffset=0,this.yoffset=0,this.worldX=0,this.w=n,this.h=i,this.speed=o,this.update=updateCloud,this.render=renderCloud,this.rain={pieces:2,particles:[],drops:[],addRaindrops:addRaindrops,splash:splash},this.snow=new Snow}function initRender(){clouds=[];for(var e=0;e<cloudCnt;e++)clouds.push(new Cloud(Math.random()*w,(h/2-20-h/87.5-10)*Math.random()-10,Math.random()*(cloudSpeedDef-cloudSpeedMin)+cloudSpeedMin,w,h,e));lastpx=w/50/2}function animate(e){if(!home&&!pause){requestAnimationFrame(animate),keyboard&&((keyspressed.up||keyspressed.space)&&(pogo.spring.restLength=1.25,pogo.spring.applyForce()),keyspressed.left&&keyspressed.right||(keyspressed.left&&(pogo.frame.body.angularVelocity=+twistval),keyspressed.right&&(pogo.frame.body.angularVelocity=-twistval)),keyspressed.up||keyspressed.space||(pogo.spring.restLength=.25,pogo.spring.applyForce()),!keyspressed.left&&!keyspressed.right&&Math.abs(pogo.frame.body.angularVelocity)>3*twistval/4&&(pogo.frame.body.angularVelocity/=8));var t=lastTime?(e-lastTime)/1e3:0;lastTime=e,t=Math.min(.1,t),world.step(fixedDeltaTime,t,maxSubSteps),tutorialm?rendertut():render()}}function lerp(e,t,o){return(1-o)*e+o*t}function componentToHex(e){var t=e.toString(16);return 1==t.length?"0"+t:t}function rgbToHex(e,t,o){return"#"+componentToHex(e)+componentToHex(t)+componentToHex(o)}function hexToRgb(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function render(){if(!pause){var e=pogo.frame.body.position[0];if(e-w/50/2>secwidth){
removeSection(sectionA),removeSection(sectionB);for(var t=0;t<sectionA.inverts.length;t++)sectionA.inverts[t]=!1;for(var t=0;t<sectionB.inverts.length;t++)sectionB.inverts[t]=!1;for(var t=0;t<sectionA.o.length;t++){var o=sectionA.o[t];o.position[0]>sectionB.h.body.position[0]&&(sectionB.o.push(o),sectionA.o.splice(t,1),sectionB.inverts.push(!1),sectionA.inverts.splice(t,1))}sectionA=changenum(sectionB,0,1),sectionB=changenum(generateSection(),1,0),pogo.frame.body.position[0]-=secwidth,pogo.stick.body.position[0]-=secwidth,addSection(sectionA),addSection(sectionB),score+=secwidth}if(e<w/50/2&&secnum>2){removeSection(sectionA),removeSection(sectionB);for(var t=0;t<sectionA.inverts.length;t++)sectionA.inverts[t]=!sectionA.inverts[t];for(var t=0;t<sectionB.inverts.length;t++)sectionB.inverts[t]=!sectionB.inverts[t];for(var t=0;t<sectionB.o.length,!1;t++){var o=sectionB.o[t];o.position[0]<sectionB.h.body.position[0]&&(sectionA.o.push(copysec(sectionB).o[t]),sectionB.o.splice(t,1),sectionA.inverts.push(!0),sectionB.inverts.splice(t,1))}secnum-=2,sectionB=changenum(sectionA,1,0),sectionA=generateSection(),pogo.frame.body.position[0]+=secwidth,pogo.stick.body.position[0]+=secwidth,updateObstacles(),addSection(sectionA),addSection(sectionB),updateObstacles(),score-=secwidth}pogo.frame.body.position[0]<0&&(gameOver=!0,leftplay=!1,pogo.frame.body.position[0]=Math.max(pogo.frame.body.position[0],-2),pogo.frame.body.position[1]=Math.max(pogo.frame.body.position[1],-5)),ctx.clearRect(0,0,w,h),colorful?ctx.fillStyle=color.sky:ctx.fillStyle="#FFFFFF",ctx.fillRect(0,0,w,h),ctx.fill();for(var n=50*(Math.max(pogo.frame.body.position[0],w/50/2)+xscroll)%secwidth,t=0;t<clouds.length;t++)clouds[t].xoffset=n;var i=yscroll;e>=w/50/2&&(xscroll=-pogo.frame.body.position[0]),v=pogo.frame.body.position[1]-yscroll,Math.abs(v)>.35?lerpval=.015:lerpval=.01,v<-.2&&(lerpval=.0325),yscroll=v*lerpval+yscroll;var a=distToTime(score+pogo.frame.body.position[0]-w/50/2),l=a*Math.PI-Math.PI;if(ctx.font="100px FontAwesome",ctx.fillStyle="#ffff00",ctx.textAlign="center",ctx.fillText("",Math.cos(l)*h/2+w/2,Math.sin(l)*h/2+50*yscroll+5*h/9),ctx.fillStyle="#ddddff",ctx.textAlign="center",ctx.fillText("",Math.cos(l+Math.PI)*h/2+w/2,Math.sin(l+Math.PI)*h/2+50*yscroll+5*h/9),fadeColors(a),!addedClouds&&a>3){for(var t=0;t<cloudCnt;t++)clouds.push(new Cloud(Math.random()*w,(h/2-20-h/87.5-10)*Math.random()-10,Math.random()*(cloudSpeedDef-cloudSpeedMin)+cloudSpeedMin,w,h,t+cloudCnt));addedClouds=!0}a>3&&(currentRainAmnt=a<4?rainAmnt:0),ctx.save(),ctx.translate(w/2,h/2),ctx.scale(50,-50);for(var t=0;t<clouds.length;t++)clouds[t].yoffset=50*-(yscroll-i);ctx.translate(xscroll,-yscroll),ctx.strokeStyle="#000000",drawpogo();var s=-1,r=-1;ctx.beginPath(),ctx.moveTo(s,-h/50*7/4);for(var e=-xscroll,c=sectionA.d.slice(0,-1).concat(sectionB.d),t=0;t<c.length;t++){var d=2*t;if(d>=e-w/50/2-1&&ctx.lineTo(s+d,r+c[t]),d>e+w/50/2+2)break}ctx.lineTo(s+2*c.length-2,-h/50*7/4),ctx.closePath(),ctx.fillStyle=color.ground,colorful&&ctx.fill(),ctx.stroke();var p=null!=sectionA.h1,u=null!=sectionB.h1;if(ctx.fillStyle="#555555",a<6.85||9==Math.floor(a)||(ctx.fillStyle="#5555FF"),p){ctx.beginPath();var y=sectionA.h1.body.position,m=sectionA.h1verts;ctx.moveTo(m[0][0]+y[0],m[0][1]+y[1]);for(var t=1;t<m.length-1;t++){var d=2*t;ctx.lineTo(y[0]+m[t][0],y[1]+m[t][1])}ctx.lineTo(m[m.length-1][0]+y[0],m[m.length-1][1]+y[1]),ctx.closePath(),colorful&&ctx.fill(),ctx.stroke()}if(u){ctx.beginPath();var y=sectionB.h1.body.position,m=sectionB.h1verts;ctx.moveTo(m[0][0]+y[0],m[0][1]+y[1]);for(var t=1;t<m.length-1;t++){var d=2*t;ctx.lineTo(y[0]+m[t][0],y[1]+m[t][1])}ctx.lineTo(m[m.length-1][0]+y[0],m[m.length-1][1]+y[1]),ctx.closePath(),colorful&&ctx.fill(),ctx.stroke()}ctx.restore();for(var t=0;t<clouds.length;t++)clouds[t].update(),clouds[t].render();ctx.save(),ctx.translate(w/2,h/2),ctx.scale(50,-50),ctx.translate(xscroll,-yscroll),ctx.strokeStyle="#000000",drawObstacles1(sectionA),drawObstacles1(sectionB);for(var g=-1,f=-1,b=!0,t=0;t<sectionA.o.length;t++)sectionA.o[t].position[0]>e+w/50/2&&(sectionA.o[t].position[0]-e<f||f==-1)&&(f=sectionA.o[t].position[0]-e,g=t);for(var t=0;t<sectionB.o.length;t++)sectionB.o[t].position[0]>e+w/50/2&&(sectionB.o[t].position[0]-e<f||f==-1)&&(f=sectionB.o[t].position[0]-e,g=t,b=!1);try{if(b)var o=sectionA.o[g];else var o=sectionB.o[g];canvas_arrow(e+w/50/2-.3-1,o.position[1],e+w/50/2+.5-1,o.position[1]),ctx.strokeStyle="#000000",ctx.stroke()}catch(e){}if(ctx.restore(),drawControls(),ctx.font="20px Comic Sans MS",ctx.fillStyle="#555555",ctx.textAlign="center",ctx.fillText("Next obstacle: "+Math.floor(f),100,h-20),ctx.font="20px Comic Sans MS",ctx.fillStyle="#000000",ctx.textAlign="left",ctx.fillText("Level/Half-Days: "+a,0,60),gameOver){ctx.font="30px Comic Sans MS",ctx.fillStyle="red",ctx.textAlign="center",pendingquit||(endscore=score+Math.round(pogo.frame.body.position[0])-Math.floor(w/50/2),newtopscore=!1,endscore>topscore&&(topscore=endscore,newtopscore=!0,document.cookie="topscore="+endscore+"; expires=Tue, 19 Jan 2038 03:14:07 UTC"),pendingquit=!0,restarttimer=setTimeout(function(){gameOver=!1,pendingquit=!1,initgame()},3e3));var x="";newtopscore&&(x="New High Score!\n"),ctx.fillText(x+"Score: "+endscore,w/2,h/2-40)}else ctx.font="16px Comic Sans MS",ctx.fillStyle="black",ctx.textAlign="left",ctx.fillText("High Score: "+topscore,10,20),ctx.fillText("Score: "+(score-Math.floor(w/50/2)+Math.round(pogo.frame.body.position[0])),10,36)}}function drawControls(){if(!keyboard){var e=canvas.getBoundingClientRect();if(ctx.save(),fixedjoy&&!nojoystick){var t=Math.round((jloc.x-e.left)/(e.right-e.left)*canvas.width),o=Math.round((jloc.y-e.top)/(e.bottom-e.top)*canvas.height);ctx.beginPath(),ctx.arc(t,o,50,0,2*Math.PI,!1),ctx.globalAlpha=.5,ctx.fillStyle="#555555",ctx.fill(),ctx.beginPath(),ctx.arc(t,o,10,0,2*Math.PI,!1),ctx.globalAlpha=.7,ctx.fillStyle="#AAAAAA",ctx.fill()}if(ctx.restore(),mousedrag&&!nojoystick){var n=Math.round((lastmouse.x-e.left)/(e.right-e.left)*canvas.width),i=Math.round((lastmouse.y-e.top)/(e.bottom-e.top)*canvas.height),a=Math.round((currentmouse.clientX-e.left)/(e.right-e.left)*canvas.width),l=Math.round((currentmouse.clientY-e.top)/(e.bottom-e.top)*canvas.height);ctx.beginPath();var s=ctx.lineWidth;ctx.lineWidth=2,ctx.strokeStyle="#999999",ctx.moveTo(n,i),ctx.lineTo(a,l),ctx.stroke(),ctx.beginPath(),ctx.arc(a,l,4,0,2*Math.PI,!1),ctx.fillStyle="#999999",ctx.stroke(),ctx.fill(),ctx.lineWidth=s}}}function fadeColors(e){var t=hexToRgb(color.skynight),o=hexToRgb(color.skyday),n=(e+.5)%2,i=o,a=t;if(n>1){var l=i;i=a,a=l}var s=Math.round(lerp(i.r,a.r,1-n%1)),r=Math.round(lerp(i.g,a.g,1-n%1)),a=Math.round(lerp(i.b,a.b,1-n%1));if(color.sky=rgbToHex(s,r,a),Math.floor(e)<7||9==Math.floor(e)){var c=color.sky,d=.025;if(e>2&&e%2<1-d&&(color.sky="#222222"),e%2>2-d){i=hexToRgb(color.sky),a=hexToRgb("#222222");var p=1-1*(2-e%2)/d,s=Math.round(lerp(i.r,a.r,p)),r=Math.round(lerp(i.g,a.g,p)),a=Math.round(lerp(i.b,a.b,p));color.sky=rgbToHex(s,r,a)}if(e>2&&e%2>1-d){a=hexToRgb(color.sky),i=hexToRgb("#222222");var p=1-1*(1-e%2)/d,s=Math.round(lerp(i.r,a.r,p)),r=Math.round(lerp(i.g,a.g,p)),a=Math.round(lerp(i.b,a.b,p));color.sky=rgbToHex(s,r,a)}if((e>2&&e%2>1||e<2)&&e%2<2-d&&(color.sky=c,color.ground=colordef.ground),e>2&&e%2<=1&&(color.ground="#222222"),e%2>2-d){i=hexToRgb(colordef.ground),a=hexToRgb("#222222");var p=1-1*(2-e%2)/d,s=Math.round(lerp(i.r,a.r,p)),r=Math.round(lerp(i.g,a.g,p)),a=Math.round(lerp(i.b,a.b,p));color.ground=rgbToHex(s,r,a)}if(e>2&&e%2>1-d){a=hexToRgb(colordef.ground),i=hexToRgb("#555555");var p=1-1*(1-e%2)/d,s=Math.round(lerp(i.r,a.r,p)),r=Math.round(lerp(i.g,a.g,p)),a=Math.round(lerp(i.b,a.b,p));color.ground=rgbToHex(s,r,a)}e>2&&e%2>1&&e%2<2-d&&(color.ground=colordef.ground)}}function getCookie(e){for(var t=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var i=o[n];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""}function drawObstacles(){for(var e=w/50/2,t=e-1,n=-xscroll,i=Math.floor((n+t)/(2*rarity)),a=0;a<obstacles.length;a++)o=obstacles[a],Math.abs(o.position[0]-n)<=e&&(ctx.beginPath(),ctx.arc(o.position[0],o.position[1],.5,0,2*Math.PI,!1),ctx.stroke());try{canvas_arrow(n+t-.3,obstacles[i].position[1],n+t+.5,obstacles[i].position[1])}catch(e){}ctx.strokeStyle="#000000"}function drawpogo(){ctx.fillStyle=color.stick,drawbox(pogo.stick),colorful&&ctx.fill(),ctx.fillStyle=color.body,drawbox(pogo.frame),colorful&&ctx.fill()}function drawbox(e){ctx.beginPath();var t=e.body.interpolatedPosition[0],o=e.body.interpolatedPosition[1];ctx.save(),ctx.translate(t,o),ctx.rotate(e.body.angle),ctx.rect(-e.shape.width/2,-e.shape.height/2,e.shape.width,e.shape.height),ctx.stroke(),ctx.restore()}function drawObstacles1(e){for(var t=(e.h.body.position[0]!=-1,w/50/2),n=t-1,i=-xscroll,a=(Math.floor((i+n)/(2*rarity)),0);a<e.o.length;a++)o=e.o[a],Math.abs(o.position[0]-i)<=t,ctx.beginPath(),ctx.arc(o.position[0],o.position[1],.5,0,2*Math.PI,!1),ctx.stroke()}function canvas_arrow(e,t,o,n){var i=.5,a=Math.atan2(n-t,o-e);ctx.beginPath(),ctx.moveTo(e,t),ctx.lineTo(o,n),ctx.lineTo(o-i*Math.cos(a-Math.PI/6),n-i*Math.sin(a-Math.PI/6)),ctx.moveTo(o,n),ctx.lineTo(o-i*Math.cos(a+Math.PI/6),n-i*Math.sin(a+Math.PI/6)),ctx.stroke()}function rendertut(){if(pogo.frame.body.position[0]<0&&(gameOver=!0,leftplay=!1,pogo.frame.body.position[0]=Math.max(pogo.frame.body.position[0],-2),pogo.frame.body.position[1]=Math.max(pogo.frame.body.position[1],-5)),ctx.clearRect(0,0,w,h),colorful?ctx.fillStyle=color.sky:ctx.fillStyle="#FFFFFF",ctx.fillRect(0,0,w,h),ctx.fill(),ctx.save(),xscroll=-pogo.frame.body.position[0],v=pogo.frame.body.position[1]-yscroll,Math.abs(v)>.35?lerpval=.015:lerpval=.01,v<-.2&&(lerpval=.0325),yscroll=v*lerpval+yscroll,ctx.translate(w/2,h/2),ctx.scale(50,-50),ctx.translate(xscroll,-yscroll),ctx.strokeStyle="#000000",drawpogo(),tutlvl>0){var e=heightfield.body.position[1],t=heightfield.body.position[0];ctx.beginPath(),ctx.moveTo(t,-h/50);var o=pogo.frame.body.position[0],n=0;for(var i in data){var a=n*heightfield.shape.elementWidth;if(a>=o-w/50/2-1&&ctx.lineTo(t+a,e+data[n]),a>o+w/50/2+2)break;n+=1}ctx.lineTo(t+data.length-1*heightfield.shape.elementWidth,-h/50),ctx.closePath(),ctx.fillStyle=color.ground,colorful&&ctx.fill(),ctx.stroke(),tutlvl>1&&drawObstacles()}ctx.restore(),drawControls(),tutlvl>1&&(ctx.font="20px Comic Sans MS",ctx.fillStyle="#555555",ctx.textAlign="center",ctx.fillText("Next obstacle: "+Math.floor(2*rarity-pogo.frame.body.position[0]%(2*rarity)),w-100,h-20)),tutlvl>0&&(gameOver?(ctx.font="30px Comic Sans MS",ctx.fillStyle="red",ctx.textAlign="center",pendingquit||(score=Math.round(pogo.frame.body.position[0]),pendingquit=!0,restarttimer=setTimeout(function(){gameOver=!1,pendingquit=!1,inittut()},3e3)),ctx.fillText("Score: "+score,canvas.width/2,canvas.height/2-40)):(ctx.font="16px Comic Sans MS",ctx.fillStyle="black",ctx.textAlign="left",score=Math.round(pogo.frame.body.position[0]),ctx.fillText("Score: "+score,10,20)))}function tutnext(){if(tutlvl++,gameOver&&(leftplay=!0),1==tutlvl&&(document.getElementById("lvl0").style.display="none",document.getElementById("lvl1").style.display="block"),2==tutlvl&&(document.getElementById("nexttxt").style.display="none",document.getElementById("lvl1").style.display="none",document.getElementById("lvl2").style.display="block"),tutlvl>2){document.getElementById("tuthelp").style.display="none",data=[],noise.seed(10*Math.random()),data.push(0);for(var e=0;e<numDataPoints;e++){v=e/10;var t=noise.simplex2(v,0);noise.perlin2(v,0);data.push(1.75*t)}return tutlvl=0,void gohome()}inittut()}function inittut(){document.getElementById("tutnextb").style.display="inline",lives=3,tutlvl>1&&resetHealth(),gameOver=!1,pendingquit=!1,world=new p2.World({gravity:[0,-7]}),0==tutlvl&&(world.gravity=[0,0]),data=[],noise.seed(10*Math.random()),data.push(0);for(var e=0;e<numDataPoints;e++){v=e/10;var t=noise.simplex2(v,0);noise.perlin2(v,0);data.push(1*t)}world.defaultContactMaterial.friction=100,world.defaultContactMaterial.restitution=.1,tut.tutlvl0(),tutlvl>0&&(tut.tutlvl1(),tutlvl>1&&tut.tutlvl2()),tutlvl>0?world.on("beginContact",function(e){if(e.bodyA==pogo.frame.body||e.bodyB==pogo.frame.body){var t=e.bodyA==heightfield.body||e.bodyB==heightfield.body;t?(lives=0,loseHeart()):(lives-=1,loseHeart()),(lives<=0||t)&&(gameOver=!0,leftplay=!1)}}):world.on("beginContact",function(e){return leftplay=!1,!0})}var twistval=2.6,fixedjoy=!0,jloc=new Object,tiltoffset=0,orientationData,keyboard=!1,keys={left:37,right:39,up:38,space:32},keyspressed={left:!1,right:!1,up:!1,space:!1},mousedrag=!1,currentmouse=null,lastmouse={x:null,y:null},twistval=2.6,fixedjoy=!0,jloc=new Object,tiltoffset=0,orientationData,keyboard=!1,keys={left:37,right:39,up:38,space:32},keyspressed={left:!1,right:!1,up:!1,space:!1},mousedrag=!1,currentmouse=null,lastmouse={x:null,y:null},gameOver=!1,pendingquit=!1,pause=!1,home=!0,restarttimer=null,lives=3,tutorialm=!1,leftplay=!1,topscore=0,score=0,world,pogo,firstrh=!0,angularVelocity=-.25,FRAME=1,STICK=2,GROUND=4,OBSTACLE=8,mobile=!1,oldcontrols={nojoystick:null,fixedjoy:null,keyboard:null},nojoystick=!1,heightfield,oldlabel="",stiffness=350,damping=.5,restLength=.25,rarity=10,pogomaterial=new p2.Material,icematerial=new p2.Material,sectionA={d:null,h:null,o:null},sectionB={d:null,h:null,o:null},secnum=0,secwidth=null,padding=2,caveDepth=4,caveHeight=5,lvlCnt=10,lvl1length=100,test=function(){},canvas,ctx,w,h,colorful=!0,colordef={sky:"#4d79ff",skyday:"#4d79ff",skynight:"#241c52",ground:"#00b300",body:"#ed00ed",stick:"#ff66ff"},color=Object.assign({},colordef),currentRainAmnt=0,rainAmnt=4,addedClouds=!1,cloudSpeed=1,cloudSize=100,cloudSpeedDef=1.5,cloudSpeedMin=.2,cloudCnt=5,splashSize=5,clouds=[];speed=300;var lastTime,maxSubSteps=5,fixedDeltaTime=1/speed,xscroll=0,yscroll=0,endscore=0,newtopscore=!1,tutlvl=0,numDataPoints=500,heightfield=new Object,data=[],obstacles=[],tut={tutlvl0:function(){pogo={stick:new Object,frame:new Object,spring:null},pogo.stick.shape=new p2.Box({width:.25,height:1.6}),pogo.stick.body=new p2.Body({mass:.25,position:[0,2.75],angularVelocity:angularVelocity,velocity:[5,0]}),pogo.frame.shape=new p2.Box({width:.5,height:1.5,sensor:!0}),pogo.frame.body=new p2.Body({mass:3,position:[0,3],angularVelocity:angularVelocity,velocity:[5,0]}),pogo.frame.body.addShape(pogo.frame.shape),pogo.stick.body.addShape(pogo.stick.shape),world.addBody(pogo.frame.body),world.addBody(pogo.stick.body);var e=new p2.PrismaticConstraint(pogo.frame.body,pogo.stick.body,{localAnchorA:[0,.5],localAnchorB:[0,.5],localAxisA:[0,1],disableRotationalLock:!0}),t=new p2.PrismaticConstraint(pogo.frame.body,pogo.stick.body,{localAnchorA:[0,0],localAnchorB:[0,1],localAxisA:[0,1],disableRotationalLock:!0});e.setLimits(-1,-.4),world.addConstraint(t),world.addConstraint(e),pogo.spring=new p2.LinearSpring(pogo.frame.body,pogo.stick.body,{restLength:restLength,stiffness:stiffness,damping:damping,localAnchorA:[0,0],localAnchorB:[0,0]}),world.addSpring(pogo.spring);var o=1,n=2;pogo.frame.shape.collisionGroup=o,pogo.stick.shape.collisionGroup=n,pogo.frame.shape.collisionMask=~n,pogo.stick.shape.collisionMask=~o},tutlvl1:function(){heightfield.shape=new p2.Heightfield({heights:data,elementWidth:2}),heightfield.body=new p2.Body({position:[-1,-1]}),heightfield.body.addShape(heightfield.shape),world.addBody(heightfield.body);var e=4;heightfield.shape.collisionGroup=e,heightfield.shape.collisionMask=-1},tutlvl2:function(){var e=8;obstacles=[];for(var t=5;t<200;t++)if(t%rarity==0){Math.random()>.5?y=data[t]+2*Math.random():y=data[t]+5-2*Math.random();var o=new p2.Circle({radius:.5}),n=new p2.Body({mass:1,position:[2*t,y],fixedX:!0,fixedY:!0});n.addShape(o),o.collisionGroup=e,obstacles.push(n),world.addBody(n)}}};