function initControls(){setupjoy(),window.addEventListener("keydown",keydown,!1),window.addEventListener("keyup",keyup,!1),window.addEventListener("keypress",keypress,!1),canvas.onmousedown=onmousedown,canvas.addEventListener("touchstart",ontouchstart,!1),canvas.addEventListener("touchmove",ontouchmove,!1),canvas.addEventListener("touchend",ontouchend,!1),tiltoffset=0,window.DeviceOrientationEvent||(console.log("DeviceOrientation is not supported"),nojoystick=!1,setupjoy());try{if(nojoystick){var orientationData=new FULLTILT.DeviceOrientation({type:"game"});orientationData.start(function(){if(nojoystick){var angle=orientationData.getScreenAdjustedEuler().alpha;if(!angle)return console.log("DeviceOrientation is not supported"),nojoystick=!1,void setupjoy();angle>180&&(angle-=360),angle=Math.PI*angle/180;var diff=getDifference(angle,pogo.frame.body.angle);pogo.frame.body.angularVelocity=3*diff}})}}catch(e){console.log("DeviceOrientation library is not supported"),nojoystick=!1,setupjoy()}}function setupjoy(){fixedjoy&&(jloc={x:3*w/4,y:3*h/4},lastmouse={x:jloc.x,y:jloc.y})}function handleOrientation(event){var y=-event.gamma+tiltoffset;console.log(y),y=2*Math.PI*y/360;var diff=getDifference(y,pogo.frame.body.angle);pogo.frame.body.angularVelocity=3*diff}function ontouchstart(e){if(e.preventDefault(),nojoystick)return pogo.spring.restLength=1.25,void pogo.spring.applyForce();pogo.spring.restLength=.25,pogo.spring.applyForce(),currentmouse={clientX:e.touches[0].clientX,clientY:e.touches[0].clientY};var angle=Math.atan2(currentmouse.clientX-lastmouse.x,currentmouse.clientY-lastmouse.y);pogo.frame.body.angularVelocity=3*(angle-pogo.frame.body.angle)}function ontouchmove(e){nojoystick||(currentmouse={clientX:e.touches[0].clientX,clientY:e.touches[0].clientY},e.preventDefault(),null!=lastmouse.x?(a=lastmouse.x-e.touches[0].clientX,b=lastmouse.y-e.touches[0].clientY,reacttocontrols()):lastmouse=fixedjoy?{x:jloc.x,y:jloc.y}:{x:e.touches[0].clientX,y:e.touches[0].clientY},mousedrag=!0)}function ontouchend(e){return nojoystick?(pogo.spring.restLength=.25,void pogo.spring.applyForce()):(currentmouse=null,mousedrag=!1,lastmouse={x:null,y:null},pogo.frame.body.angularVelocity=0,pogo.spring.restLength=1.25,void pogo.spring.applyForce())}function onmousedown(){pogo.spring.restLength=.25,pogo.spring.applyForce(),nojoystick||(document.onmousemove=function(e){currentmouse=e,null!=lastmouse.x?(a=lastmouse.x-e.clientX,b=lastmouse.y-e.clientY,reacttocontrols()):lastmouse=fixedjoy?{x:jloc.x,y:jloc.y}:{x:e.clientX,y:e.clientY},mousedrag=!0}),this.onmouseup=function(){document.onmousemove=null,currentmouse=null,mousedrag=!1,lastmouse={x:null,y:null},pogo.frame.body.angularVelocity=0,pogo.spring.restLength=1.25,pogo.spring.applyForce()}}function reacttocontrols(){var angle=Math.atan2(currentmouse.clientX-lastmouse.x,currentmouse.clientY-lastmouse.y),diff=getDifference(angle,pogo.frame.body.angle);pogo.frame.body.angularVelocity=3*diff}function getDifference(x,y){var a=x-y;return a=function(i,j){return i-Math.floor(i/j)*j}(a+Math.PI,2*Math.PI),a-=Math.PI}function keydown(evt){[32,37,38,39,40].indexOf(evt.keyCode)>-1&&evt.preventDefault(),evt.keyCode!=keys.up&&87!=evt.keyCode||(keyspressed.up=!0),evt.keyCode!=keys.space&&87!=evt.keyCode||(keyspressed.space=!0),evt.keyCode!=keys.left&&65!=evt.keyCode||(keyspressed.left=!0),evt.keyCode!=keys.right&&68!=evt.keyCode||(keyspressed.right=!0)}function keyup(evt){evt.keyCode!=keys.up&&87!=evt.keyCode||(keyspressed.up=!1),evt.keyCode!=keys.space&&87!=evt.keyCode||(keyspressed.space=!1),evt.keyCode!=keys.left&&65!=evt.keyCode||(keyspressed.left=!1),evt.keyCode!=keys.right&&68!=evt.keyCode||(keyspressed.right=!1)}function keypress(evt){}function clearTimer(){null!==restarttimer&&clearTimeout(restarttimer)}function changeOrientation(){var canv=document.getElementById("myCanvas");if(canv.width!=window.innerWidth){var tmp=canv.width;document.getElementById("myCanvas").width=canv.height,document.getElementById("myCanvas").height=tmp}canvas=document.getElementById("myCanvas"),w=canvas.width,h=canvas.height,ctx=canvas.getContext("2d"),ctx.lineWidth=.05,setupjoy()}function fullscreen(){document.getElementById("myCanvas").style.width="100%",document.getElementById("myCanvas").style.height="100%",document.getElementById("myCanvas").width=window.innerWidth,document.getElementById("myCanvas").height=window.innerHeight}function resetHealth(){document.getElementById("health").style.animation="fadeinout 4s linear forwards";var elm=document.getElementById("health");elm.style.display="block";var newone=elm.cloneNode(!0);elm.parentNode.replaceChild(newone,elm),document.getElementById("health").innerHTML='<i class="fa fa-heart" aria-hidden="true"></i> <i id="h2" class="fa fa-heart" aria-hidden="true"></i> <i id="h3" class="fa fa-heart" aria-hidden="true"></i>'}function loseHeart(){document.getElementById("health").style.animation="fadeinout 4s linear forwards";var elm=document.getElementById("health");elm.style.display="block";var newone=elm.cloneNode(!0);elm.parentNode.replaceChild(newone,elm),2==lives&&(document.getElementById("health").innerHTML='<i class="fa fa-heart" aria-hidden="true"></i> <i id="h2" class="fa fa-heart" aria-hidden="true"></i> <i id="h3" class="fa fa-heart-o" aria-hidden="true"></i>'),1==lives&&(document.getElementById("health").innerHTML='<i class="fa fa-heart" aria-hidden="true"></i> <i id="h2" class="fa fa-heart-o" aria-hidden="true"></i> <i id="h3" class="fa fa-heart-o" aria-hidden="true"></i>'),lives<=0&&(document.getElementById("health").innerHTML='<i class="fa fa-heart-o" aria-hidden="true"></i> <i id="h2" class="fa fa-heart-o" aria-hidden="true"></i> <i id="h3" class="fa fa-heart-o" aria-hidden="true"></i>')}function processopts(){var k,fj,nj;switch(k=fj=nj=!1,gyro=!1,$(".dropdowntitle").val()){case"Joystick":fj=!0,nj=!1;break;case"Unfixed Joystick":fj=!1,nj=!1;break;case"Gyro":nj=!0,gyro=!0;break;case"Keyboard":k=!0;case"":}updatehelp(nj,k,fj)}function saveopts(){saveopts1(!0)}function saveopts1(tutsave){switch(keyboard=!1,$(".dropdowntitle").val()){case"Joystick":fixedjoy=!0,nojoystick=!1,document.getElementById("modeHUD").innerHTML="Mode: Joystick";break;case"Unfixed Joystick":fixedjoy=!1,nojoystick=!1,document.getElementById("modeHUD").innerHTML="Mode: Unfixed Joystick";break;case"Gyro":nojoystick=!0,document.getElementById("modeHUD").innerHTML="Mode: Gyro";break;case"Keyboard":keyboard=!0,document.getElementById("modeHUD").innerHTML="Mode: Keyboard";case"":}updatehelp(nojoystick,keyboard,fixedjoy),setupjoy()}function onload(){var QueryString=function(){for(var query_string={},query=window.location.search.substring(1),vars=query.split("&"),i=0;i<vars.length;i++){var pair=vars[i].split("=");if("undefined"==typeof query_string[pair[0]])query_string[pair[0]]=decodeURIComponent(pair[1]);else if("string"==typeof query_string[pair[0]]){var arr=[query_string[pair[0]],decodeURIComponent(pair[1])];query_string[pair[0]]=arr}else query_string[pair[0]].push(decodeURIComponent(pair[1]))}return query_string}();if("1"===QueryString.debug&&openDebug(),"1"===QueryString.multi){multi=!0;var id=""+Math.round(1e4*Math.random());if(peer=new Peer(id,{key:peerkey,secure:!1,debug:3}),"1"===QueryString.leader){var otherid=prompt("What is you're opponent's id number?");console.log("Other id: "+otherid),conn=peer.connect(""+otherid),conn.on("open",function(){conn.on("data",function(data){opponentScore=parseInt(data)}),seedVal=10*Math.random(),conn.send(""+seedVal)})}else peer.on("connection",function(conn1){conn=conn1,conn.on("data",function(data){firstData?(firstData=!1,seedVal=parseInt(data)):opponentScore=parseInt(data)})}),alert("Give this id number to the leader: "+id)}else seedVal=10*Math.random();$("#keyslider").rangeslider({polyfill:!1,rangeClass:"rangeslider",disabledClass:"rangeslider--disabled",horizontalClass:"rangeslider--horizontal",verticalClass:"rangeslider--vertical",fillClass:"rangeslider__fill",handleClass:"rangeslider__handle",onInit:function(){sen=getCookie("keysensitivity"),""===sen&&(document.cookie="keysensitivity=100; expires=Tue, 19 Jan 2038 03:14:07 UTC",sen="100"),keysensitivityval=parseInt(sen),$(this).val(keysensitivityval).change()},onSlide:function(position,value){keysensitivityval=value},onSlideEnd:function(position,value){keysensitivityval=value}}),$('input[type="range"]').val(keysensitivityval).change(),window.onbeforeunload=function(){return document.cookie="keysensitivity="+keysensitivityval+"; expires=Tue, 19 Jan 2038 03:14:07 UTC",null},window.mobileAndTabletcheck=function(){var check=!1;return function(a){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))&&(check=!0)}(navigator.userAgent||navigator.vendor||window.opera),check},mobile=window.mobileAndTabletcheck(),mobile||$(".gyro").hide(),$(".controls").clone().appendTo(".controlsdiv"),$(".helptxtdiv").clone().appendTo(".tutcontrolsdiv"),$(".dropdown-menu li a").on("click",function(){$(".dropdowntitle").html($(this).text()+' <span class="caret">'),$(".dropdowntitle").val($(this).text()),processopts()}),fullscreen(),window.addEventListener("orientationchange",function(){changeOrientation()},!1),window.onresize=function(){w=canvas.width=window.innerWidth,w=canvas.height=window.innerHeight,ctx=canvas.getContext("2d"),ctx.lineWidth=.05}}function init(){if(gameOver=!1,pendingquit=!1,console.log("Mobile or tablet: "+mobile),nojoystick=!0,keyboard=!mobile,mobile&&(gyro=!0),mobile?document.getElementById("modeHUD").innerHTML="Mode: Gyro":($(".dropdowntitle").html('Keyboard <span class="caret">'),$(".dropdowntitle").val("Keyboard")),$("#errortxt").html+=""+nojoystick,updatehelp(nojoystick,keyboard,fixedjoy),mobile){elems=document.getElementsByClassName("dtop");for(var i=0;i<elems.length;i++)elems[i].style.display="none";nojoystick&&($(".keyboard").hide(),$(".dropdowntitle").html('Gyro <span class="caret">'),$(".dropdowntitle").val("Gyro"))}canvas=document.getElementById("myCanvas"),w=canvas.width,h=canvas.height,ctx=canvas.getContext("2d"),ctx.lineWidth=.05,filtersEnabled="undefined"!=typeof ctx.filter,noise.seed(seedVal),tutorialm?inittut():initgame(),initControls()}function copysec(s){for(var obstacles=[],idx=0;idx<s.o.length;idx++){var circleShape=new p2.Circle({radius:.5,sensor:!0}),circleBody=new p2.Body({mass:1,position:s.o[idx].position,fixedX:s.o[idx].fixedX,fixedY:s.o[idx].fixedY,velocity:s.o[idx].velocity});circleBody.addShape(circleShape),circleShape.collisionGroup=OBSTACLE,circleShape.collisionMask=FRAME|STICK,obstacles.push(circleBody)}var heightfield=new Object;heightfield.shape=new p2.Heightfield({heights:s.d,elementWidth:2}),heightfield.body=new p2.Body({position:s.h.body.position}),heightfield.shape.collisionGroup=GROUND,heightfield.shape.collisionMask=FRAME|STICK,heightfield.body.addShape(heightfield.shape);var h1=null;if(null!=s.h1){h1=new Object,h1.body=new p2.Body({position:s.h1.body.position}),h1.body.fromPolygon(JSON.parse(JSON.stringify(s.h1verts)));for(var i=0;i<h1.body.shapes.length;i++)h1.body.shapes[i].collisionGroup=GROUND,h1.body.shapes[i].collisionMask=FRAME|STICK,h1.body.shapes[i].material=icematerial}return{d:s.d,h:heightfield,h1:h1,h1verts:s.h1verts,o:obstacles,od:s.od,inverts:s.inverts}}function changenum(s1,num,oldnum){var s=copysec(s1);s.h.body.position[0]+=(num-oldnum)*secwidth;for(var i=0;i<s.o.length;i++)s.o[i].position[0]+=(num-oldnum)*secwidth,s.o[i].velocity=[0,0];return null!=s.h1&&(s.h1.body.position[0]+=(num-oldnum)*secwidth),s}function caveMouthSigmoid(x){return-2*(x/(1+Math.abs(x)))-1}function generateSection(){for(var data=[],ceilverts=[],startedceil=!1,ceilx=null,ceily=null,ice=!1,i=0;i<=secwidth/2;i++){var v=(i+secnum*secwidth/2)/10,value=1.75*noise.simplex2(v,0),lvl=distToTime(secnum*secwidth+2*i);if(lvl>2)if(lvl%2<1&&(Math.floor(lvl)<7||9==Math.floor(lvl))){value/=1.75;var ychange=null;if(lvl%1<=.5){var x=lvl%1*4-1;ychange=caveMouthSigmoid(x)*caveDepth}if(lvl%1>.5){var x=(lvl-.5)%1*4-1;ychange=caveMouthSigmoid(-x)*caveDepth}if(value+=ychange,ychange<-caveDepth/2||startedceil){var y=value+caveHeight;startedceil||(ceilx=2*i,ceily=y,startedceil=!0,ceilverts.push([5,5]),ceilverts.push([0,8])),ceilverts.push([2*i-ceilx,y-ceily]),i%rarity==rarity-2&&i!=secwidth/2&&(Math.random()>.5?value+=2*Math.random():ceilverts.push([2*i-ceilx,y-ceily-1.5*Math.random()-1]))}}else lvl>=7&&lvl<9&&(startedceil?value=-2:(value=Math.max(value,1),ceilx=2*i,ceily=-9,startedceil=!0,ice=!0,ceilverts.push([0,0])),ceilverts.push([2*i-ceilx,1-ceily]));data.push(value)}var heightfield=new Object;if(heightfield.shape=new p2.Heightfield({heights:data,elementWidth:2}),heightfield.body=new p2.Body({position:[-1,-1]}),heightfield.shape.collisionGroup=GROUND,heightfield.shape.collisionMask=FRAME|STICK,heightfield.body.addShape(heightfield.shape),startedceil){ice?ceilverts.push([ceilverts[ceilverts.length-1][0],0]):ceilverts.push([ceilverts[ceilverts.length-1][0],ceilverts[ceilverts.length-1][1]+5+3]);var h1=new Object;h1.body=new p2.Body({position:[ceilx-1,ceily-1]}),h1.body.fromPolygon(JSON.parse(JSON.stringify(ceilverts)));for(var i=0;i<h1.body.shapes.length;i++)h1.body.shapes[i].collisionGroup=GROUND,h1.body.shapes[i].collisionMask=FRAME|STICK,h1.body.shapes[i].material=icematerial}for(var od=[],y=null,obstacles=[],i=1;i<data.length;i++)if(i%rarity==0){var lvl=Math.floor(distToTime(secnum*secwidth+2*i));y=Math.random()>.5&&0!=lvl&&lvl>2&&lvl%2<1?data[i]+2*Math.random():data[i]+5-2*Math.random(),0==lvl&&(y+=4),lvl>2&&lvl<3&&(y-=20),od.push(y);var circleShape=new p2.Circle({radius:.5,sensor:!0}),circleBody=new p2.Body({mass:1,position:[2*i,y],fixedX:!0,fixedY:!0});circleBody.addShape(circleShape),circleShape.collisionGroup=OBSTACLE,circleShape.collisionMask=FRAME|STICK,obstacles.push(circleBody)}return secnum+=1,null!=h1&&ceilverts.length<1&&(ceilverts=[[-1,1],[-1,0],[1,0],[1,1],[.5,.5]]),{d:data,h:heightfield,h1:h1,h1verts:ceilverts,o:obstacles,od:od,inverts:new Array(obstacles.length).fill(!1)}}function addSection(s){world.addBody(s.h.body);for(var i=0;i<s.o.length;i++)world.addBody(s.o[i]);null!=s.h1&&world.addBody(s.h1.body)}function removeSection(s){world.removeBody(s.h.body);for(var i=0;i<s.o.length;i++)world.removeBody(s.o[i]);null!=s.h1&&world.removeBody(s.h1.body)}function getsecwidth(){var canvaswidth=Math.ceil(w/50+padding),x=Math.ceil(canvaswidth/rarity)*rarity;return x}function isEmpty(str){return!str||0===str.length}function distToTime(dist){return lvlCnt*(1-Math.pow(1-1/lvlCnt,dist/lvl1length))}function initgame(){orientationData=new FULLTILT.DeviceOrientation({type:"game"}),initRender(),cookie=getCookie("topscore"),isEmpty(cookie)?document.cookie="topscore=0; expires=Tue, 19 Jan 2038 03:14:07 UTC;":topscore=parseInt(cookie),score=0,secnum=0,lives=3,resetHealth(),gameOver=!1,pendingquit=!1,world=new p2.World({gravity:[0,-7]}),world.defaultContactMaterial.friction=100,world.defaultContactMaterial.restitution=.1,world.addContactMaterial(new p2.ContactMaterial(icematerial,pogomaterial,{restitution:0,friction:25}));var pogox=w/50/2;pogo={stick:new Object,frame:new Object,spring:null},pogo.stick.shape=new p2.Box({width:.25,height:1.6,material:pogomaterial}),pogo.stick.body=new p2.Body({mass:.25,position:[pogox,2.75],angularVelocity:angularVelocity,velocity:[5,0]}),pogo.frame.shape=new p2.Box({width:.5,height:1.5,material:pogomaterial}),pogo.frame.body=new p2.Body({mass:3,position:[pogox,3],angularVelocity:angularVelocity,velocity:[5,0]}),pogo.frame.body.addShape(pogo.frame.shape),pogo.stick.body.addShape(pogo.stick.shape),world.addBody(pogo.frame.body),world.addBody(pogo.stick.body);var c1=new p2.PrismaticConstraint(pogo.frame.body,pogo.stick.body,{localAnchorA:[0,.5],localAnchorB:[0,.5],localAxisA:[0,1],disableRotationalLock:!0}),c2=new p2.PrismaticConstraint(pogo.frame.body,pogo.stick.body,{localAnchorA:[0,0],localAnchorB:[0,1],localAxisA:[0,1],disableRotationalLock:!0});c1.setLimits(-1,-.4),world.addConstraint(c2),world.addConstraint(c1),pogo.spring=new p2.LinearSpring(pogo.frame.body,pogo.stick.body,{restLength:restLength,stiffness:stiffness,damping:damping,localAnchorA:[0,0],localAnchorB:[0,0]}),world.addSpring(pogo.spring),secwidth=getsecwidth(),sectionA=generateSection(),sectionB=changenum(generateSection(),1,0),addSection(sectionA),addSection(sectionB),pogo.frame.shape.collisionGroup=FRAME,pogo.stick.shape.collisionGroup=STICK,pogo.frame.shape.collisionMask=GROUND|OBSTACLE,pogo.stick.shape.collisionMask=GROUND|OBSTACLE,world.on("postStep",updateObstacles),world.on("beginContact",function(event){if(!debugtesting&&(event.bodyA==pogo.frame.body||event.bodyB==pogo.frame.body)){var h=event.bodyA==sectionA.h.body||event.bodyB==sectionA.h.body;h=h||event.bodyA==sectionB.h.body||event.bodyB==sectionB.h.body,h?(lives=0,loseHeart()):(lives-=1,loseHeart()),(lives<=0||h)&&(gameOver=!0,leftplay=!1)}})}function updateObstacles(){var t=distToTime((secnum-1)*secwidth);if(t>3)if(t<5){for(var i=0;i<sectionA.o.length;i++)sectionA.o[i].fixedY=!1,sectionA.o[i].velocity[1]=2.5*Math.sin(3*world.time);for(var i=0;i<sectionB.o.length;i++)sectionB.o[i].fixedY=!1,sectionB.o[i].velocity[1]=2.5*Math.sin(3*world.time)}else{for(var calc=function(b,a,invert){var v=[a[0]-b[0],a[1]-b[1]],mag=Math.sqrt(v[0]*v[0]+v[1]*v[1]);if(mag<=0)return console.log("zero mag! target reached!"),[0,0];var speed=Math.sin(Math.min(mag,9)/10*Math.PI);return speed*=3,speed=Math.max(speed,1),speed/mag<=0&&console.log("HELP ME!!!!!"),speed*=invert?-1:1,v=[v[0]*speed/mag,v[1]*speed/mag]},i=0;i<sectionA.o.length;i++){var pos=sectionA.o[i].position,ppos=pogo.stick.body.position;sectionA.o[i].velocity=calc(pos,ppos,sectionA.inverts[i])}for(var i=0;i<sectionB.o.length;i++){var ppos=sectionB.o[i].position,pos=pogo.stick.body.position;sectionB.o[i].velocity=calc(pos,ppos,sectionB.inverts[i])}}}function openDebug(){!function(){var scriptTag=document.createElement("script");scriptTag.type="text/javascript",scriptTag.src="https://getfirebug.com/firebug-lite.js#startOpened",document.getElementsByTagName("head")[0].appendChild(scriptTag);var ready=function(){console.log("test")};scriptTag.onreadystatechange=function(){"complete"==scriptTag.readyState&&ready()},scriptTag.onload=ready}()}function gohome(){home=!0,console.log(oldlabel),$(".dropdowntitle").val(oldlabel),document.getElementById("pausebutton").className="circlebutton",document.getElementById("helpbutton").className="circlebutton",document.getElementById("settingsbutton").className="circlebutton",document.getElementById("pausebutton").style.display="none",document.getElementById("modeHUD").style.display="none",document.getElementById("helpbutton").style.display="none",document.getElementById("settingsbutton").style.display="none",document.getElementById("mainmenu").style.display="inline",document.getElementById("mainmenu").style.opacity="1",document.getElementById("myCanvas").style.display="none",document.getElementById("gamearea").style.backgroundColor="white",document.getElementById("homebutton").style.display="none",document.getElementById("tutnextb").style.display="none",document.getElementById("health").style.display="none",clearTimer(),gameOver&&(leftplay=!0),tutorialm=!1,pause=!1}function play(){tutorialm=!1,home=!1,ga("send","event",{eventCategory:"Menu Interaction",eventAction:"click",eventLabel:"play"}),pause&&back(),document.getElementById("modeHUD").style.display="block",document.getElementById("modeHUD").style.animation="zoominout 0.75s linear forwards",document.getElementById("pausebutton").className="circlebutton",document.getElementById("helpbutton").className="circlebutton",document.getElementById("settingsbutton").className="circlebutton",document.getElementById("helpbutton").style.display="none",document.getElementById("settingsbutton").style.display="none",document.getElementById("mainmenu").style.display="none",document.getElementById("mainmenu").style.opacity="0",document.getElementById("myCanvas").style.display="inline",document.getElementById("pausebutton").innerHTML='<i class="fa fa-pause"></i>',document.getElementById("pausebutton").style.display="block",document.getElementById("myCanvas").style.opacity="1",document.getElementById("gamearea").style.backgroundColor="black",document.getElementById("homebutton").style.display="none",pause||init(),requestAnimationFrame(animate),pause=!1}function pausegame(){$("#errortxt").hide(),tutorialm||(pause?play():(pause=!0,filtersEnabled?document.getElementById("myCanvas").style.opacity="0.7":document.getElementById("myCanvas").style.opacity="0.5",document.getElementById("pausebutton").innerHTML='<i class="fa fa-play"></i>',document.getElementById("helpbutton").style.display="inline-block",document.getElementById("settingsbutton").style.display="inline-block",document.getElementById("homebutton").style.display="inline-block",document.getElementById("pausebutton").className="circlebuttoni",document.getElementById("helpbutton").className="circlebuttoni",document.getElementById("settingsbutton").className="circlebuttoni"))}function mainbpprep(){document.getElementById("mainmenu").style.display="none",document.getElementById("mainmenu").style.opacity="0",document.getElementById("myCanvas").style.display="inline",document.getElementById("pausebutton").innerHTML='<i class="fa fa-pause"></i>',document.getElementById("pausebutton").style.display="block",document.getElementById("myCanvas").style.opacity="1",document.getElementById("gamearea").style.backgroundColor="black",init(),animate(),pause=!0,document.getElementById("myCanvas").style.opacity="0.3",document.getElementById("pausebutton").innerHTML='<i class="fa fa-play"></i>',document.getElementById("helpbutton").style.display="inline-block",document.getElementById("settingsbutton").style.display="inline-block",document.getElementById("pausebutton").className="circlebuttoni",document.getElementById("helpbutton").className="circlebuttoni",document.getElementById("settingsbutton").className="circlebuttoni"}function tutorial(){console.log("tutorial() Called"),test(),home=!1,ga("send","event",{eventCategory:"Menu Interaction",eventAction:"click",eventLabel:"tutorial"}),oldlabel=$(".dropdowntitle").val(),document.getElementById("mainmenu").style.display="none",document.getElementById("mainmenu").style.opacity="0",document.getElementById("myCanvas").style.display="inline",document.getElementById("myCanvas").style.opacity="1",document.getElementById("tuthelp").style.display="block",document.getElementById("tuthelp").style.opacity="1",document.getElementById("lvl0").style.display="block",document.getElementById("lvl2").style.display="none",document.getElementById("homebutton").style.display="none",document.getElementById("gamearea").style.backgroundColor="black",tutorialm=!0,pause=!1,lvl=0,init(),animate()}function help(){ga("send","event",{eventCategory:"Menu Interaction",eventAction:"click",eventLabel:"help"}),document.getElementById("helpbutton").style.display="none",document.getElementById("settingsbutton").style.display="none",document.getElementById("helparea").style.display="block",document.getElementById("helparea").style.opacity="1",document.getElementById("homebutton").style.display="none"}function help1(){mainbpprep(),help()}function settings(){ga("send","event",{eventCategory:"Menu Interaction",eventAction:"click",eventLabel:"settings"}),document.getElementById("homebutton").style.display="none",document.getElementById("helpbutton").style.display="none",document.getElementById("settingsbutton").style.display="none",document.getElementById("settings").style.display="block",document.getElementById("settings").style.opacity="1"}function settings1(){mainbpprep(),settings()}function back(){document.getElementById("helpbutton").style.display="inline-block",document.getElementById("settingsbutton").style.display="inline-block",document.getElementById("homebutton").style.display="inline-block",document.getElementById("helparea").style.display="none",document.getElementById("helparea").style.opacity="0",document.getElementById("settings").style.display="none",document.getElementById("settings").style.opacity="0"}function togglefixedjoy(){fixedjoy=!fixedjoy,document.getElementById("fixedjoy").innerHTML=(fixedjoy?"Unfix":"Fix")+" joystick location",fixedjoy?(document.getElementById("unfixjoyhelp").display="none",document.getElementById("fixjoyhelp").display="inherit",setupjoy()):(document.getElementById("unfixjoyhelp").display="inherit",document.getElementById("fixjoyhelp").display="none")}function updatehelp(nojoystickself,keyboardself,fixedjoyself){$(".gyrohelp").hide(),$(".keyboardhelp").hide(),$(".joyhelp").hide(),nojoystickself||keyboardself?keyboardself?$(".keyboardhelp").show():$(".gyrohelp").show():($(".joyhelp").show(),$(".fixjoyhelp").hide(),$(".unfixjoyhelp").hide(),fixedjoyself?$(".fixjoyhelp").show():$(".unfixjoyhelp").show())}function toggleColor(){colorful=!colorful,document.getElementById("coltoggle").innerHTML=(colorful?"Disable":"Enable")+" colors"}function updateSky(){color.sky="#"+document.getElementById("skyCP").value}function updateGround(){color.ground="#"+document.getElementById("groundCP").value}function updateBody(){color.body="#"+document.getElementById("bodyCP").value}function updateStick(){color.stick="#"+document.getElementById("stickCP").value}function resetcolors(){colorful||toggleColor(),document.getElementById("skyCP").jscolor.fromString(colordef.sky.slice(1)),document.getElementById("groundCP").jscolor.fromString(colordef.ground.slice(1)),document.getElementById("bodyCP").jscolor.fromString(colordef.body.slice(1)),document.getElementById("stickCP").jscolor.fromString(colordef.stick.slice(1)),color.sky=colordef.sky,color.ground=colordef.ground,color.body=colordef.body,color.stick=colordef.stick}function getHatX(x){var idx,gh=0,worldX=x/50-xscroll-w/50/2;if(worldX>sectionB.h.body.position[0]){var real=(worldX-sectionB.h.body.position[0])/2;idx=Math.floor(real);var amnt=real%2/2,diff=sectionB.d[idx+1]-sectionB.d[idx]||0;gh=50*-(sectionB.d[idx]+diff*amnt)}else{var real=(worldX-sectionA.h.body.position[0])/2;idx=Math.floor(real);var amnt=2*real%2/2,diff=sectionA.d[idx+1]-sectionA.d[idx]||0;gh=50*-(sectionA.d[idx]+diff*amnt)}return gh+=h/2,gh+=50*yscroll,gh+=50}function updateCloud(){for(var i=0;i<this.snow.particles.length;i++)this.snow.particles[i].x-=this.xoffset,this.snow.particles[i].y-=this.yoffset;this.snow.angle+=.01;for(var i=0;i<this.snow.mp;i++){var p=this.snow.particles[i];p.y+=Math.cos(this.snow.angle+p.d)+1+p.r/2,p.x+=2*Math.sin(this.snow.angle);var lvl=distToTime(score+pogo.frame.body.position[0]-w/50/2);if(0==this.idx&&6!=Math.floor(lvl)){var h=getHatX(p.x);lvl>6&&(h=0,h+=this.h/2,h+=50*yscroll),(p.x>w+5||p.x<-5||p.y>h)&&(i%3>0?this.snow.particles[i]={x:Math.random()*w,y:-10,r:p.r,d:p.d}:Math.sin(this.snow.angle)>0?this.snow.particles[i]={x:-5,y:Math.random()*h,r:p.r,d:p.d}:this.snow.particles[i]={x:w+5,y:Math.random()*h,r:p.r,d:p.d})}}this.x-=this.xoffset,this.y-=this.yoffset;for(var i=0;i<this.rain.particles.length;i++)this.rain.particles[i].x-=this.xoffset,this.rain.particles[i].y-=this.yoffset;for(var i=0;i<this.rain.drops.length;i++)this.rain.drops[i].x-=this.xoffset,this.rain.drops[i].y-=this.yoffset;for(var activeparticles,localparticles=this.rain.particles,localdrops=this.rain.drops,i=0;activeparticles=localparticles[i];i++){activeparticles.x+=activeparticles.velX,activeparticles.y+=activeparticles.velY+5;var gh=getHatX(activeparticles.x);activeparticles.y>gh&&(localparticles.splice(i--,1),this.rain.splash(activeparticles.x,activeparticles.y,activeparticles.col))}for(var activedrops,i=0;activedrops=localdrops[i];i++)activedrops.x+=activedrops.velX,activedrops.y+=activedrops.velY,activedrops.radius-=.075,activedrops.alpha>0?activedrops.alpha-=.005:activedrops.alpha=0,activedrops.radius<0&&localdrops.splice(i--,1);for(var i=currentRainAmnt;i--;){if(0!=this.idx){i=0;break}this.rain.addRaindrops(Math.floor(Math.random()*this.w*1.5),-500)}var left=this.x<-cloudSize,right=this.x>2*this.w+cloudSize;(left||right)&&(this.y=(this.h/2-20-this.h/87.5-10)*Math.random()-10,this.speed=Math.random()*(cloudSpeedDef-cloudSpeedMin)+cloudSpeedMin,left?this.x=this.w+cloudSize:this.x=-cloudSize),this.x+=this.speed*cloudSpeed}function addRaindrops(x,y,pieces){for(pieces=pieces||2;pieces--;)this.particles.push({velX:.25*Math.random(),velY:9*Math.random()+1,x:x,y:y,alpha:1,col:"hsla(200, 100%, 50%, 0.8)"})}function splash(x,y,col,cnt){for(cnt=cnt||splashSize;cnt--;)this.drops.push({velX:4*Math.random()-2,velY:Math.random()*-4,x:x,y:y,radius:.65+Math.floor(1.6*Math.random()),alpha:1,col:col})}function renderCloud(){var val=Math.floor(distToTime(score+pogo.frame.body.position[0]-w/50/2));if(val>=5&&6!=val){ctx.fillStyle="rgba(255, 255, 255, 0.8)",ctx.beginPath();for(var i=0;i<this.snow.mp;i++){var p=this.snow.particles[i];ctx.moveTo(p.x,p.y),ctx.arc(p.x,p.y,p.r,0,2*Math.PI,!0)}ctx.fill()}for(var activeparticles,tau=2*Math.PI,localparticles=this.rain.particles,localdrops=this.rain.drops,i=0;activeparticles=localparticles[i];i++)ctx.globalAlpha=activeparticles.alpha,ctx.fillStyle=activeparticles.col,ctx.fillRect(activeparticles.x,activeparticles.y,activeparticles.velY/4,activeparticles.velY);for(var activedrops,i=0;activedrops=localdrops[i];i++)ctx.globalAlpha=activedrops.alpha,ctx.fillStyle=activedrops.col,ctx.beginPath(),ctx.arc(activedrops.x,activedrops.y,activedrops.radius,0,tau),ctx.fill();ctx.shadowBlur=7,ctx.shadowColor="black",ctx.font=cloudSize+"px FontAwesome",ctx.globalAlpha="0.7",ctx.fillStyle="#ffffff",ctx.textAlign="center",ctx.fillText("",this.x-cloudSize/2,this.y),ctx.shadowBlur=0,ctx.globalAlpha="1"}function Snow(){this.angle=0,this.mp=45,this.particles=[];for(var i=0;i<this.mp;i++)this.particles.push({x:Math.random()*w,y:Math.random()*h,r:4*Math.random()+1,d:Math.random()*this.mp})}function Cloud(x,y,speed,w,h,idx){this.idx=idx,this.x=x,this.y=y,this.xoffset=0,this.yoffset=0,this.worldX=0,this.w=w,this.h=h,this.speed=speed,this.update=updateCloud,this.render=renderCloud,this.rain={pieces:2,particles:[],drops:[],addRaindrops:addRaindrops,splash:splash
},this.snow=new Snow}function initRender(){clouds=[];for(var i=0;i<cloudCnt;i++)clouds.push(new Cloud(Math.random()*w,(h/2-20-h/87.5-10)*Math.random()-10,Math.random()*(cloudSpeedDef-cloudSpeedMin)+cloudSpeedMin,w,h,i));lastpx=w/50/2}function animate(time){if(!(home||pause&&fullPause)){requestAnimationFrame(animate),keyboard&&((keyspressed.up||keyspressed.space)&&(pogo.spring.restLength=1.25,pogo.spring.applyForce()),keyspressed.left&&keyspressed.right||(keyspressed.left&&(pogo.frame.body.angularVelocity=+twistval*keysensitivityval/100),keyspressed.right&&(pogo.frame.body.angularVelocity=-twistval*keysensitivityval/100)),keyspressed.up||keyspressed.space||(pogo.spring.restLength=.25,pogo.spring.applyForce()),!keyspressed.left&&!keyspressed.right&&Math.abs(pogo.frame.body.angularVelocity)>twistval*keysensitivityval/100*3/7&&(pogo.frame.body.angularVelocity/=8));var deltaTime=lastTime?(time-lastTime)/1e3:0;lastTime=time,deltaTime=Math.min(.1,deltaTime),world.step(fixedDeltaTime,deltaTime,maxSubSteps),tutorialm?rendertut():render()}}function lerp(a,b,u){return(1-u)*a+u*b}function componentToHex(c){var hex=c.toString(16);return 1==hex.length?"0"+hex:hex}function rgbToHex(r,g,b){return"#"+componentToHex(r)+componentToHex(g)+componentToHex(b)}function hexToRgb(hex){var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null}function render(){if(pause){if(fullPause||!filtersEnabled)return void(ctx.filter="none");ctx.filter="blur(30px)",fullPause=!0}else ctx.filter="none",fullPause=!1;var px=pogo.frame.body.position[0];if(px-w/50/2>secwidth){removeSection(sectionA),removeSection(sectionB);for(var i=0;i<sectionA.inverts.length;i++)sectionA.inverts[i]=!1;for(var i=0;i<sectionB.inverts.length;i++)sectionB.inverts[i]=!1;for(var i=0;i<sectionA.o.length;i++){var o=sectionA.o[i];o.position[0]>sectionB.h.body.position[0]&&(sectionB.o.push(o),sectionA.o.splice(i,1),sectionB.inverts.push(!1),sectionA.inverts.splice(i,1))}sectionA=changenum(sectionB,0,1),sectionB=changenum(generateSection(),1,0),pogo.frame.body.position[0]-=secwidth,pogo.stick.body.position[0]-=secwidth,addSection(sectionA),addSection(sectionB),score+=secwidth}if(px<w/50/2&&secnum>2){removeSection(sectionA),removeSection(sectionB);for(var i=0;i<sectionA.inverts.length;i++)sectionA.inverts[i]=!sectionA.inverts[i];for(var i=0;i<sectionB.inverts.length;i++)sectionB.inverts[i]=!sectionB.inverts[i];secnum-=2,sectionB=changenum(sectionA,1,0),sectionA=generateSection(),pogo.frame.body.position[0]+=secwidth,pogo.stick.body.position[0]+=secwidth,updateObstacles(),addSection(sectionA),addSection(sectionB),updateObstacles(),score-=secwidth}pogo.frame.body.position[0]<0&&(gameOver=!0,leftplay=!1,pogo.frame.body.position[0]=Math.max(pogo.frame.body.position[0],-2),pogo.frame.body.position[1]=Math.max(pogo.frame.body.position[1],-5)),ctx.clearRect(0,0,w,h),colorful?ctx.fillStyle=color.sky:ctx.fillStyle="#FFFFFF",ctx.fillRect(0,0,w,h),ctx.fill();for(var xdelta=50*(Math.max(pogo.frame.body.position[0],w/50/2)+xscroll)%secwidth,i=0;i<clouds.length;i++)clouds[i].xoffset=xdelta;var ysold=yscroll;px>=w/50/2&&(xscroll=-pogo.frame.body.position[0]),v=pogo.frame.body.position[1]-yscroll,Math.abs(v)>.35?lerpval=.015:lerpval=.01,v<-.2&&(lerpval=.0325),yscroll=v*lerpval+yscroll;var progress=distToTime(score+pogo.frame.body.position[0]-w/50/2),angle=progress*Math.PI-Math.PI;if(ctx.font="100px FontAwesome",ctx.fillStyle="#ffff00",ctx.textAlign="center",ctx.fillText("",Math.cos(angle)*h/2+w/2,Math.sin(angle)*h/2+50*yscroll+5*h/9),ctx.fillStyle="#ddddff",ctx.textAlign="center",ctx.fillText("",Math.cos(angle+Math.PI)*h/2+w/2,Math.sin(angle+Math.PI)*h/2+50*yscroll+5*h/9),fadeColors(progress),!addedClouds&&progress>3){for(var i=0;i<cloudCnt;i++)clouds.push(new Cloud(Math.random()*w,(h/2-20-h/87.5-10)*Math.random()-10,Math.random()*(cloudSpeedDef-cloudSpeedMin)+cloudSpeedMin,w,h,i+cloudCnt));addedClouds=!0}progress>3&&(currentRainAmnt=progress<4?rainAmnt:0),ctx.save(),ctx.translate(w/2,h/2),ctx.scale(50,-50);for(var i=0;i<clouds.length;i++)clouds[i].yoffset=50*-(yscroll-ysold);ctx.translate(xscroll,-yscroll),drawpogo();var x=-1,y=-1;ctx.beginPath(),ctx.moveTo(x,-h/50*7/4);for(var px=-xscroll,cdata=sectionA.d.slice(0,-1).concat(sectionB.d),i=0;i<cdata.length;i++){var x1=2*i;if(x1>=px-w/50/2-1&&ctx.lineTo(x+x1,y+cdata[i]),x1>px+w/50/2+2)break}ctx.lineTo(x+2*cdata.length-2,-h/50*7/4),ctx.closePath(),ctx.fillStyle=color.ground,colorful&&ctx.fill(),ctx.stroke();var ah1=null!=sectionA.h1,bh1=null!=sectionB.h1;if(ctx.fillStyle="#555555",progress<6.85||9==Math.floor(progress)||(ctx.fillStyle="#5555FF"),ah1){ctx.beginPath();var startpos=sectionA.h1.body.position,dat=sectionA.h1verts;ctx.moveTo(dat[0][0]+startpos[0],dat[0][1]+startpos[1]);for(var i=1;i<dat.length-1;i++){var x1=2*i;ctx.lineTo(startpos[0]+dat[i][0],startpos[1]+dat[i][1])}ctx.lineTo(dat[dat.length-1][0]+startpos[0],dat[dat.length-1][1]+startpos[1]),ctx.closePath(),colorful&&ctx.fill(),ctx.stroke()}if(bh1){ctx.beginPath();var startpos=sectionB.h1.body.position,dat=sectionB.h1verts;ctx.moveTo(dat[0][0]+startpos[0],dat[0][1]+startpos[1]);for(var i=1;i<dat.length-1;i++){var x1=2*i;ctx.lineTo(startpos[0]+dat[i][0],startpos[1]+dat[i][1])}ctx.lineTo(dat[dat.length-1][0]+startpos[0],dat[dat.length-1][1]+startpos[1]),ctx.closePath(),colorful&&ctx.fill(),ctx.stroke()}ctx.restore();for(var i=0;i<clouds.length;i++)clouds[i].update(),clouds[i].render();ctx.save(),ctx.translate(w/2,h/2),ctx.scale(50,-50),ctx.translate(xscroll,-yscroll),ctx.strokeStyle="#000000",drawObstacles1(sectionA),drawObstacles1(sectionB);for(var idx=-1,closest=-1,A=!0,i=0;i<sectionA.o.length;i++)sectionA.o[i].position[0]>px+w/50/2&&(sectionA.o[i].position[0]-px<closest||closest==-1)&&(closest=sectionA.o[i].position[0]-px,idx=i);for(var i=0;i<sectionB.o.length;i++)sectionB.o[i].position[0]>px+w/50/2&&(sectionB.o[i].position[0]-px<closest||closest==-1)&&(closest=sectionB.o[i].position[0]-px,idx=i,A=!1);try{if(A)var o=sectionA.o[idx];else var o=sectionB.o[idx];canvas_arrow(px+w/50/2-.3-1,o.position[1],px+w/50/2+.5-1,o.position[1]),ctx.strokeStyle="#000000",ctx.stroke()}catch(e){}ctx.restore(),drawControls(),ctx.font="20px Courier New",ctx.fillStyle="#555555",ctx.textAlign="left",ctx.fillText("Next obstacle: "+Math.floor(closest),10,h-20),ctx.fillStyle="#000000";var daysRaw=progress/2+.25,delta=24*daysRaw*60*60,days=Math.floor(delta/86400);delta-=86400*days;var hours=Math.floor(delta/3600)%24;delta-=3600*hours;var minutes=Math.floor(delta/60)%60;delta-=60*minutes;var timeTxt="Day "+days+", ",hrsTxt=hours%12+1+"";if(timeTxt+=("0"+hrsTxt).substring(hrsTxt.length-1)+":",timeTxt+=("0"+minutes).substring((""+minutes).length-1)+" ",timeTxt+=hours>11?"PM":"AM",ctx.fillText(timeTxt,10,60),ctx.fillText(""+opponentScore,10,80),gameOver){ctx.font="30px Courier New",ctx.fillStyle="red",ctx.textAlign="center",pendingquit||(endscore=score+Math.round(pogo.frame.body.position[0])-Math.floor(w/50/2),newtopscore=!1,endscore>topscore&&(topscore=endscore,newtopscore=!0,document.cookie="topscore="+endscore+"; expires=Tue, 19 Jan 2038 03:14:07 UTC"),pendingquit=!0,restarttimer=setTimeout(function(){gameOver=!1,pendingquit=!1,initgame()},3e3));var msg="";newtopscore&&(msg="New High Score!\n"),ctx.fillText(msg+"Score: "+endscore,w/2,h/2-40)}else{ctx.font="20px Courier New",ctx.fillStyle="black",ctx.textAlign="left",ctx.fillText("High Score: "+topscore,10,25);var scoreVal=score-Math.floor(w/50/2)+Math.round(pogo.frame.body.position[0]);ctx.fillText("Score: "+scoreVal,10,42),sendScore(scoreVal)}}function drawControls(){if(!keyboard&&!gyro){canvas.getBoundingClientRect();if(ctx.save(),fixedjoy&&!nojoystick){var jx=Math.round(jloc.x),jy=Math.round(jloc.y);ctx.beginPath(),ctx.arc(jx,jy,50,0,2*Math.PI,!1),ctx.globalAlpha=.5,ctx.fillStyle="#555555",ctx.fill(),ctx.beginPath(),ctx.arc(jx,jy,10,0,2*Math.PI,!1),ctx.globalAlpha=.7,ctx.fillStyle="#AAAAAA",ctx.fill()}if(ctx.restore(),ctx.save(),mousedrag&&!nojoystick){var mx1=Math.round(lastmouse.x),my1=Math.round(lastmouse.y),mx2=Math.round(currentmouse.clientX),my2=Math.round(currentmouse.clientY);ctx.beginPath();var origw=ctx.lineWidth;ctx.lineWidth=2,ctx.strokeStyle="#999999",ctx.moveTo(mx1,my1),ctx.lineTo(mx2,my2),ctx.stroke(),ctx.beginPath(),ctx.arc(mx2,my2,4,0,2*Math.PI,!1),ctx.fillStyle="#999999",ctx.stroke(),ctx.fill(),ctx.lineWidth=origw}ctx.restore()}}function fadeColors(progress){var nightCol=hexToRgb(color.skynight),dayCol=hexToRgb(color.skyday),t=(progress+.5)%2,a=dayCol,b=nightCol;if(t>1){var tmp=a;a=b,b=tmp}var r=Math.round(lerp(a.r,b.r,1-t%1)),g=Math.round(lerp(a.g,b.g,1-t%1)),b=Math.round(lerp(a.b,b.b,1-t%1));if(color.sky=rgbToHex(r,g,b),Math.floor(progress)<7||9==Math.floor(progress)){var skyold=color.sky,caveFade=.025;if(progress>2&&progress%2<1-caveFade&&(color.sky="#222222"),progress%2>2-caveFade){a=hexToRgb(color.sky),b=hexToRgb("#222222");var val=1-1*(2-progress%2)/caveFade,r=Math.round(lerp(a.r,b.r,val)),g=Math.round(lerp(a.g,b.g,val)),b=Math.round(lerp(a.b,b.b,val));color.sky=rgbToHex(r,g,b)}if(progress>2&&progress%2>1-caveFade){b=hexToRgb(color.sky),a=hexToRgb("#222222");var val=1-1*(1-progress%2)/caveFade,r=Math.round(lerp(a.r,b.r,val)),g=Math.round(lerp(a.g,b.g,val)),b=Math.round(lerp(a.b,b.b,val));color.sky=rgbToHex(r,g,b)}if((progress>2&&progress%2>1||progress<2)&&progress%2<2-caveFade&&(color.sky=skyold,color.ground=colordef.ground),progress>2&&progress%2<=1&&(color.ground="#222222"),progress%2>2-caveFade){a=hexToRgb(colordef.ground),b=hexToRgb("#222222");var val=1-1*(2-progress%2)/caveFade,r=Math.round(lerp(a.r,b.r,val)),g=Math.round(lerp(a.g,b.g,val)),b=Math.round(lerp(a.b,b.b,val));color.ground=rgbToHex(r,g,b)}if(progress>2&&progress%2>1-caveFade){b=hexToRgb(colordef.ground),a=hexToRgb("#555555");var val=1-1*(1-progress%2)/caveFade,r=Math.round(lerp(a.r,b.r,val)),g=Math.round(lerp(a.g,b.g,val)),b=Math.round(lerp(a.b,b.b,val));color.ground=rgbToHex(r,g,b)}progress>2&&progress%2>1&&progress%2<2-caveFade&&(color.ground=colordef.ground)}}function getCookie(cname){for(var name=cname+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(name))return c.substring(name.length,c.length)}return""}function drawObstacles(){for(var m=w/50/2,d=m-1,px=-xscroll,i1=Math.floor((px+d)/(2*rarity)),i=0;i<obstacles.length;i++)o=obstacles[i],Math.abs(o.position[0]-px)<=m&&(ctx.beginPath(),ctx.arc(o.position[0],o.position[1],.5,0,2*Math.PI,!1),ctx.stroke());try{canvas_arrow(px+d-.3,obstacles[i1].position[1],px+d+.5,obstacles[i1].position[1])}catch(e){}ctx.strokeStyle="#000000"}function drawpogo(){ctx.fillStyle=color.stick,drawbox(pogo.stick),colorful&&ctx.fill(),ctx.fillStyle=color.body,drawbox(pogo.frame),colorful&&ctx.fill()}function drawbox(obj){ctx.beginPath();var x=obj.body.interpolatedPosition[0],y=obj.body.interpolatedPosition[1];ctx.save(),ctx.translate(x,y),ctx.rotate(obj.body.angle),ctx.rect(-obj.shape.width/2,-obj.shape.height/2,obj.shape.width,obj.shape.height),ctx.stroke(),ctx.restore()}function drawObstacles1(s){for(var i=0;i<s.o.length;i++)o=s.o[i],ctx.beginPath(),ctx.arc(o.position[0],o.position[1],.5,0,2*Math.PI,!1),ctx.stroke()}function canvas_arrow(fromx,fromy,tox,toy){var headlen=.5,angle=Math.atan2(toy-fromy,tox-fromx);ctx.beginPath(),ctx.moveTo(fromx,fromy),ctx.lineTo(tox,toy),ctx.lineTo(tox-headlen*Math.cos(angle-Math.PI/6),toy-headlen*Math.sin(angle-Math.PI/6)),ctx.moveTo(tox,toy),ctx.lineTo(tox-headlen*Math.cos(angle+Math.PI/6),toy-headlen*Math.sin(angle+Math.PI/6)),ctx.stroke()}function rendertut(){if(pogo.frame.body.position[0]<0&&(gameOver=!0,leftplay=!1,pogo.frame.body.position[0]=Math.max(pogo.frame.body.position[0],-2),pogo.frame.body.position[1]=Math.max(pogo.frame.body.position[1],-5)),ctx.clearRect(0,0,w,h),colorful?ctx.fillStyle=color.sky:ctx.fillStyle="#FFFFFF",ctx.fillRect(0,0,w,h),ctx.fill(),ctx.save(),xscroll=-pogo.frame.body.position[0],v=pogo.frame.body.position[1]-yscroll,Math.abs(v)>.35?lerpval=.015:lerpval=.01,v<-.2&&(lerpval=.0325),yscroll=v*lerpval+yscroll,ctx.translate(w/2,h/2),ctx.scale(50,-50),ctx.translate(xscroll,-yscroll),ctx.strokeStyle="#000000",drawpogo(),tutlvl>0){var y=heightfield.body.position[1],x=heightfield.body.position[0];ctx.beginPath(),ctx.moveTo(x,-h/50);var px=pogo.frame.body.position[0],i=0;for(var d in data){var x1=i*heightfield.shape.elementWidth;if(x1>=px-w/50/2-1&&ctx.lineTo(x+x1,y+data[i]),x1>px+w/50/2+2)break;i+=1}ctx.lineTo(x+data.length-1*heightfield.shape.elementWidth,-h/50),ctx.closePath(),ctx.fillStyle=color.ground,colorful&&ctx.fill(),ctx.stroke(),tutlvl>1&&drawObstacles()}ctx.restore(),drawControls(),tutlvl>1&&(ctx.font="20px Comic Sans MS",ctx.fillStyle="#555555",ctx.textAlign="center",ctx.fillText("Next obstacle: "+Math.floor(2*rarity-pogo.frame.body.position[0]%(2*rarity)),w-100,h-20)),tutlvl>0&&(gameOver?(ctx.font="30px Comic Sans MS",ctx.fillStyle="red",ctx.textAlign="center",pendingquit||(score=Math.round(pogo.frame.body.position[0]),pendingquit=!0,restarttimer=setTimeout(function(){gameOver=!1,pendingquit=!1,inittut()},3e3)),ctx.fillText("Score: "+score,canvas.width/2,canvas.height/2-40)):(ctx.font="16px Comic Sans MS",ctx.fillStyle="black",ctx.textAlign="left",score=Math.round(pogo.frame.body.position[0]),ctx.fillText("Score: "+score,10,20)))}function tutnext(){if(tutlvl++,gameOver&&(leftplay=!0),1==tutlvl&&(document.getElementById("lvl0").style.display="none",document.getElementById("lvl1").style.display="block"),2==tutlvl&&(document.getElementById("nexttxt").style.display="none",document.getElementById("lvl1").style.display="none",document.getElementById("lvl2").style.display="block"),tutlvl>2){document.getElementById("tuthelp").style.display="none",data=[],noise.seed(10*Math.random()),data.push(0);for(var i=0;i<numDataPoints;i++){v=i/10;var value=noise.simplex2(v,0);noise.perlin2(v,0);data.push(1.75*value)}return tutlvl=0,void gohome()}inittut()}function inittut(){document.getElementById("tutnextb").style.display="inline",lives=3,tutlvl>1&&resetHealth(),gameOver=!1,pendingquit=!1,world=new p2.World({gravity:[0,-7]}),0==tutlvl&&(world.gravity=[0,0]),data=[],noise.seed(10*Math.random()),data.push(0);for(var i=0;i<numDataPoints;i++){v=i/10;var value=noise.simplex2(v,0);noise.perlin2(v,0);data.push(1*value)}world.defaultContactMaterial.friction=100,world.defaultContactMaterial.restitution=.1,tut.tutlvl0(),tutlvl>0&&(tut.tutlvl1(),tutlvl>1&&tut.tutlvl2()),tutlvl>0?world.on("beginContact",function(event){if(event.bodyA==pogo.frame.body||event.bodyB==pogo.frame.body){var h=event.bodyA==heightfield.body||event.bodyB==heightfield.body;h?(lives=0,loseHeart()):(lives-=1,loseHeart()),(lives<=0||h)&&(gameOver=!0,leftplay=!1)}}):world.on("beginContact",function(event){return leftplay=!1,!0})}var twistval=2.6,fixedjoy=!0,jloc=new Object,tiltoffset=0,orientationData,keyboard=!1,keysensitivityval=100,keys={left:37,right:39,up:38,space:32},keyspressed={left:!1,right:!1,up:!1,space:!1},mousedrag=!1,currentmouse=null,lastmouse={x:null,y:null},debugtesting=!1,gameOver=!1,pendingquit=!1,pause=!1,home=!0,restarttimer=null,lives=3,tutorialm=!1,leftplay=!1,topscore=0,score=0,world,pogo,firstrh=!0,angularVelocity=-.25,opponentScore=0,FRAME=1,STICK=2,GROUND=4,OBSTACLE=8,mobile=!1,oldcontrols={nojoystick:null,fixedjoy:null,keyboard:null},nojoystick=!1,heightfield,oldlabel="",stiffness=350,damping=.5,restLength=.25,rarity=10,pogomaterial=new p2.Material,icematerial=new p2.Material,sectionA={d:null,h:null,o:null},sectionB={d:null,h:null,o:null},multi=!1,conn,peerkey="k21h7zsvzls4te29",peer,seedVal,firstData=!0,secnum=0,secwidth=null,padding=2,caveDepth=4,caveHeight=5,lvlCnt=10,lvl1length=100,addedDebug=!1,test=function(){},canvas,ctx,w,h,colorful=!0,colordef={sky:"#4d79ff",skyday:"#4d79ff",skynight:"#241c52",ground:"#00b300",body:"#ed00ed",stick:"#ff66ff"},filtersEnabled=!0,color=JSON.parse(JSON.stringify(colordef)),currentRainAmnt=0,rainAmnt=4,addedClouds=!1,cloudSpeed=1,cloudSize=100,cloudSpeedDef=1.5,cloudSpeedMin=.2,cloudCnt=5,splashSize=5,clouds=[];speed=300;var lastTime,maxSubSteps=5,fixedDeltaTime=1/speed,xscroll=0,yscroll=0,endscore=0,fullPause=!1,sendScore=function(svalue){conn.send(svalue)},gyro=!1,newtopscore=!1,tutlvl=0,numDataPoints=500,heightfield=new Object,data=[],obstacles=[],tut={tutlvl0:function(){pogo={stick:new Object,frame:new Object,spring:null},pogo.stick.shape=new p2.Box({width:.25,height:1.6}),pogo.stick.body=new p2.Body({mass:.25,position:[0,2.75],angularVelocity:angularVelocity,velocity:[5,0]}),pogo.frame.shape=new p2.Box({width:.5,height:1.5,sensor:!0}),pogo.frame.body=new p2.Body({mass:3,position:[0,3],angularVelocity:angularVelocity,velocity:[5,0]}),pogo.frame.body.addShape(pogo.frame.shape),pogo.stick.body.addShape(pogo.stick.shape),world.addBody(pogo.frame.body),world.addBody(pogo.stick.body);var c1=new p2.PrismaticConstraint(pogo.frame.body,pogo.stick.body,{localAnchorA:[0,.5],localAnchorB:[0,.5],localAxisA:[0,1],disableRotationalLock:!0}),c2=new p2.PrismaticConstraint(pogo.frame.body,pogo.stick.body,{localAnchorA:[0,0],localAnchorB:[0,1],localAxisA:[0,1],disableRotationalLock:!0});c1.setLimits(-1,-.4),world.addConstraint(c2),world.addConstraint(c1),pogo.spring=new p2.LinearSpring(pogo.frame.body,pogo.stick.body,{restLength:restLength,stiffness:stiffness,damping:damping,localAnchorA:[0,0],localAnchorB:[0,0]}),world.addSpring(pogo.spring),pogo.frame.shape.collisionGroup=FRAME,pogo.stick.shape.collisionGroup=STICK,pogo.frame.shape.collisionMask=~STICK,pogo.stick.shape.collisionMask=~FRAME},tutlvl1:function(){heightfield.shape=new p2.Heightfield({heights:data,elementWidth:2}),heightfield.body=new p2.Body({position:[-1,-1]}),heightfield.body.addShape(heightfield.shape),world.addBody(heightfield.body),heightfield.shape.collisionGroup=GROUND,heightfield.shape.collisionMask=-1},tutlvl2:function(){var OBSTACLE=8;obstacles=[];for(var i=5;i<200;i++)if(i%rarity==0){Math.random()>.5?y=data[i]+2*Math.random():y=data[i]+5-2*Math.random();var circleShape=new p2.Circle({radius:.5}),circleBody=new p2.Body({mass:1,position:[2*i,y],fixedX:!0,fixedY:!0});circleBody.addShape(circleShape),circleShape.collisionGroup=OBSTACLE,obstacles.push(circleBody),world.addBody(circleBody)}}};