function setupControlSettings(){mobile?(controlMode.mode=controlMode.GYRO,$(".keyboard").hide()):(controlMode.mode=controlMode.KEYBOARD,$(".gyro").hide())}function initControls(){var gyroIncompatible=!1;setupjoy(),window.addEventListener("keydown",keydown,!1),window.addEventListener("keyup",keyup,!1),window.addEventListener("keypress",keypress,!1),canvas.onmousedown=onmousedown,canvas.addEventListener("touchstart",ontouchstart,!1),canvas.addEventListener("touchmove",ontouchmove,!1),canvas.addEventListener("touchend",ontouchend,!1),tiltoffset=0,window.DeviceOrientationEvent||(console.log("DeviceOrientation is not supported"),gyroIncompatible=!0,setupjoy());try{if(!gyroIncompatible){var orientationData=new FULLTILT.DeviceOrientation({type:"game"});orientationData.start(function(){if(!gyroIncompatible){var angle=orientationData.getScreenAdjustedEuler().alpha;if(!angle)return console.log("DeviceOrientation is not supported"),nojoystick=!1,void setupjoy();angle>180&&(angle-=360),angle=Math.PI*angle/180;var diff=getDifference(angle,pogo.frame.body.angle);pogo.frame.body.angularVelocity=3*diff}})}}catch(e){console.log("DeviceOrientation library is not supported"),console.error(e),controlMode.mode==controlMode.GYRO&&(controlMode.mode=controlMode.JOYSTICK),setupjoy()}gyroIncompatible&&(console.log("Gyro Incompatible"),controlMode.mode==controlMode.GYRO&&(controlMode.mode=controlMode.JOYSTICK),setupjoy())}function setupjoy(){controlMode.mode==controlMode.JOYSTICK&&(jloc={x:3*w/4,y:3*h/4},lastmouse={x:jloc.x,y:jloc.y})}function handleOrientation(event){var y=-event.gamma+tiltoffset;console.log(y),y=2*Math.PI*y/360;var diff=getDifference(y,pogo.frame.body.angle);pogo.frame.body.angularVelocity=5*diff}function ontouchstart(e){if(pendingquit)return void(gameOver||(pendingquit=!1,initgame()));if(e.preventDefault(),controlMode.mode==controlMode.GYRO&&(pogo.spring.restLength=1.25,pogo.spring.applyForce()),controlMode.isJoystickVariant){pogo.spring.restLength=.25,pogo.spring.applyForce(),currentmouse={clientX:e.touches[0].clientX,clientY:e.touches[0].clientY};var angle=Math.atan2(currentmouse.clientX-lastmouse.x,currentmouse.clientY-lastmouse.y);pogo.frame.body.angularVelocity=3*(angle-pogo.frame.body.angle)}}function ontouchmove(e){return pendingquit?void(gameOver||(pendingquit=!1,initgame())):void(controlMode.isJoystickVariant&&(currentmouse={clientX:e.touches[0].clientX,clientY:e.touches[0].clientY},e.preventDefault(),null!=lastmouse.x?(a=lastmouse.x-e.touches[0].clientX,b=lastmouse.y-e.touches[0].clientY,reacttocontrols()):lastmouse=fixedjoy?{x:jloc.x,y:jloc.y}:{x:e.touches[0].clientX,y:e.touches[0].clientY},mousedrag=!0))}function ontouchend(e){controlMode.mode==controlMode.GYRO&&(pogo.spring.restLength=.25,pogo.spring.applyForce()),controlMode.isJoystickVariant&&(currentmouse=null,mousedrag=!1,lastmouse={x:null,y:null},pogo.frame.body.angularVelocity=0,pogo.spring.restLength=1.25,pogo.spring.applyForce())}function onmousedown(){return pendingquit?void(gameOver||(pendingquit=!1,initgame())):(pogo.spring.restLength=.25,pogo.spring.applyForce(),controlMode.isJoystickVariant&&(document.onmousemove=function(e){currentmouse=e,null!=lastmouse.x?(a=lastmouse.x-e.clientX,b=lastmouse.y-e.clientY,reacttocontrols()):lastmouse=fixedjoy?{x:jloc.x,y:jloc.y}:{x:e.clientX,y:e.clientY},mousedrag=!0}),void(this.onmouseup=function(){document.onmousemove=null,currentmouse=null,mousedrag=!1,lastmouse={x:null,y:null},pogo.frame.body.angularVelocity=0,pogo.spring.restLength=1.25,pogo.spring.applyForce()}))}function reacttocontrols(){var angle=Math.atan2(currentmouse.clientX-lastmouse.x,currentmouse.clientY-lastmouse.y),diff=getDifference(angle,pogo.frame.body.angle);pogo.frame.body.angularVelocity=3*diff}function getDifference(x,y){var a=x-y;return a=function(i,j){return i-Math.floor(i/j)*j}(a+Math.PI,2*Math.PI),a-=Math.PI}function keydown(evt){return 80==evt.keyCode&&pausegame(),pendingquit?void(gameOver||(pendingquit=!1,initgame())):([32,37,38,39,40].indexOf(evt.keyCode)>-1&&evt.preventDefault(),evt.keyCode!=keys.up&&87!=evt.keyCode||(keyspressed.up=!0),evt.keyCode!=keys.space&&87!=evt.keyCode||(keyspressed.space=!0),evt.keyCode!=keys.left&&65!=evt.keyCode||(keyspressed.left=!0),void(evt.keyCode!=keys.right&&68!=evt.keyCode||(keyspressed.right=!0)))}function keyup(evt){evt.keyCode!=keys.up&&87!=evt.keyCode||(keyspressed.up=!1),evt.keyCode!=keys.space&&87!=evt.keyCode||(keyspressed.space=!1),evt.keyCode!=keys.left&&65!=evt.keyCode||(keyspressed.left=!1),evt.keyCode!=keys.right&&68!=evt.keyCode||(keyspressed.right=!1)}function keypress(evt){}function clearTimer(){null!==restarttimer&&clearTimeout(restarttimer)}function changeOrientation(){canvas=document.getElementById("myCanvas"),w=canvas.width,h=canvas.height,ctx=canvas.getContext("2d"),ctx.lineWidth=.05,setupjoy(),secwidth=getsecwidth()}function fullscreen(){document.getElementById("myCanvas").width=window.innerWidth,document.getElementById("myCanvas").height=window.innerHeight,canvas=document.getElementById("myCanvas"),w=canvas.width,h=canvas.height,secwidth=getsecwidth()}function resetHealth(){document.getElementById("health").style.animation="fadeinout 2s linear forwards";var elm=document.getElementById("health");elm.style.display="block";var newone=elm.cloneNode(!0);elm.parentNode.replaceChild(newone,elm),document.getElementById("health").innerHTML='<i class="fa fa-heart" aria-hidden="true"></i> <i id="h2" class="fa fa-heart" aria-hidden="true"></i> <i id="h3" class="fa fa-heart" aria-hidden="true"></i>'}function loseHeart(){if(!pendingquit){document.getElementById("health").style.animation="fadeinout 2s linear forwards";var elm=document.getElementById("health");elm.style.display="block";var newone=elm.cloneNode(!0);elm.parentNode.replaceChild(newone,elm),2==lives&&(document.getElementById("health").innerHTML='<i class="fa fa-heart" aria-hidden="true"></i> <i id="h2" class="fa fa-heart" aria-hidden="true"></i> <i id="h3" class="fa fa-heart-o" aria-hidden="true"></i>'),1==lives&&(document.getElementById("health").innerHTML='<i class="fa fa-heart" aria-hidden="true"></i> <i id="h2" class="fa fa-heart-o" aria-hidden="true"></i> <i id="h3" class="fa fa-heart-o" aria-hidden="true"></i>'),lives<=0&&(document.getElementById("health").innerHTML='<i class="fa fa-heart-o" aria-hidden="true"></i> <i id="h2" class="fa fa-heart-o" aria-hidden="true"></i> <i id="h3" class="fa fa-heart-o" aria-hidden="true"></i>')}}function processopts(){saveopts(),updatehelp()}function saveopts(){saveopts1(!0)}function saveopts1(tutsave){switch(keyboard=!1,$(".dropdowntitle").val()){case"Joystick":controlMode.mode=controlMode.JOYSTICK,fixedjoy=!0,nojoystick=!1;break;case"Unfixed Joystick":controlMode.mode=controlMode.UNFIXED_JOYSTICK,fixedjoy=!1,nojoystick=!1;break;case"Gyro":controlMode.mode=controlMode.GYRO,nojoystick=!0;break;case"Keyboard":controlMode.mode=controlMode.KEYBOARD,keyboard=!0;case"":}document.getElementById("modeHUD").innerHTML="Mode: "+controlMode.modeName,updatehelp(),setupjoy()}function handleData(data){var obj=JSON.parse(data);opponentScoreData.scoreFrame=obj.scoreFrame,opponentScoreData.scoreStick=obj.scoreStick,opponentScoreData.angle.frame=obj.frameAngle,opponentScoreData.angle.stick=obj.stickAngle,opponentScoreData.size.frame.height=obj.size.frame.height,opponentScoreData.size.frame.width=obj.size.frame.width,opponentScoreData.size.stick.height=obj.size.stick.height,opponentScoreData.size.stick.width=obj.size.stick.width,opponentCoords.frame.y=obj.frameY,opponentCoords.stick.y=obj.stickY,opponentScore=Math.round(parseInt(obj.scoreFrame))}function onload(){var QueryString=function(){for(var query_string={},query=window.location.search.substring(1),vars=query.split("&"),i=0;i<vars.length;i++){var pair=vars[i].split("=");if("undefined"==typeof query_string[pair[0]])query_string[pair[0]]=decodeURIComponent(pair[1]);else if("string"==typeof query_string[pair[0]]){var arr=[query_string[pair[0]],decodeURIComponent(pair[1])];query_string[pair[0]]=arr}else query_string[pair[0]].push(decodeURIComponent(pair[1]))}return query_string}();if("1"===QueryString.debug&&openDebug(),setupControlSettings(),"1"===QueryString.multi){multiplayer=!0,multi=!0;var id=""+Math.round(1e4*Math.random());if(peer=new Peer(id,{key:peerkey,secure:!1,debug:3}),"1"===QueryString.leader){var otherid=prompt("What is you're opponent's id number?");console.log("Other id: "+otherid),conn=peer.connect(""+otherid),conn.on("open",function(){conn.on("data",function(data){handleData(data)}),conn.send("10101")}),seedVal=parseInt(otherid)/1e4}else peer.on("connection",function(conn1){conn=conn1,conn.on("data",function(data){firstData?firstData=!1:handleData(data)})}),alert("Give this id number to the leader: "+id),seedVal=parseInt(id)/1e4}else seedVal=10*Math.random();QueryString.seed&&(seedVal=999),$("#keyslider").rangeslider({polyfill:!1,rangeClass:"rangeslider",disabledClass:"rangeslider--disabled",horizontalClass:"rangeslider--horizontal",verticalClass:"rangeslider--vertical",fillClass:"rangeslider__fill",handleClass:"rangeslider__handle",onInit:function(){sen=getCookie("keysensitivity"),""===sen&&(document.cookie="keysensitivity=100; expires=Tue, 19 Jan 2038 03:14:07 UTC",sen="100"),keysensitivityval=parseInt(sen),$(this).val(keysensitivityval).change()},onSlide:function(position,value){keysensitivityval=value},onSlideEnd:function(position,value){keysensitivityval=value}}),$('input[type="range"]').val(keysensitivityval).change(),window.onbeforeunload=function(){return document.cookie="coinsCnt="+coinsCnt+"; expires=Tue, 19 Jan 2038 03:14:07 UTC",document.cookie="keysensitivity="+keysensitivityval+"; expires=Tue, 19 Jan 2038 03:14:07 UTC",null},coinsCnt=parseInt(getCookie("coinsCnt"))||0,$(".controls").clone().appendTo(".controlsdiv"),$(".helptxtdiv").clone().appendTo(".tutcontrolsdiv"),$(".dropdown-menu li a").on("click",function(){$(".dropdowntitle").html($(this).text()+' <span class="caret">'),$(".dropdowntitle").val($(this).text()),processopts()}),fullscreen(),window.addEventListener("orientationchange",function(){changeOrientation()},!1),window.onresize=function(){w=canvas.width=window.innerWidth,h=canvas.height=window.innerHeight,document.getElementById("myCanvas").style.width="",document.getElementById("myCanvas").style.height="",ctx=canvas.getContext("2d"),ctx.lineWidth=.05,secwidth=getsecwidth()}}function init(){if(gameOver=!1,pendingquit=!1,console.log("Mobile or tablet: "+mobile),nojoystick=!0,keyboard=!mobile,mobile&&(gyro=!0),mobile?document.getElementById("modeHUD").innerHTML="Mode: Gyro":($(".dropdowntitle").html('Keyboard <span class="caret">'),$(".dropdowntitle").val("Keyboard")),$("#errortxt").html+=""+nojoystick,updatehelp(),mobile){elems=document.getElementsByClassName("dtop");for(var i=0;i<elems.length;i++)elems[i].style.display="none";nojoystick&&($(".keyboard").hide(),$(".dropdowntitle").html('Gyro <span class="caret">'),$(".dropdowntitle").val("Gyro"))}canvas=document.getElementById("myCanvas"),w=canvas.width,h=canvas.height,ctx=canvas.getContext("2d"),ctx.lineWidth=.05,filtersEnabled="undefined"!=typeof ctx.filter,noise.seed(10+0*seedVal),tutorialm?inittut():initgamepartial(),initControls()}function copysec(s){for(var obstacles=[],idx=0;idx<s.o.length;idx++){var circleShape=new p2.Circle({radius:.5,sensor:!0}),circleBody=new p2.Body({mass:1,position:s.o[idx].position,fixedX:s.o[idx].fixedX,fixedY:s.o[idx].fixedY,velocity:s.o[idx].velocity}),circleShapeCoin=new p2.Circle({radius:.3,sensor:!0});circleBody.addShape(circleShape),circleBody.addShape(circleShapeCoin,[0,coinDist]),circleShape.collisionGroup=OBSTACLE,circleShape.collisionMask=FRAME|STICK,circleShapeCoin.collisionGroup=OBSTACLE,circleShapeCoin.collisionMask=FRAME|STICK,obstacles.push(circleBody)}var heightfield=new Object;heightfield.shape=new p2.Heightfield({heights:s.d,elementWidth:2}),heightfield.body=new p2.Body({position:s.h.body.position}),heightfield.shape.collisionGroup=GROUND,heightfield.shape.collisionMask=FRAME|STICK,heightfield.body.addShape(heightfield.shape);var h1=null;if(null!=s.h1){h1=new Object,h1.body=new p2.Body({position:s.h1.body.position}),h1.body.fromPolygon(JSON.parse(JSON.stringify(s.h1verts)));for(var i=0;i<h1.body.shapes.length;i++)h1.body.shapes[i].collisionGroup=GROUND,h1.body.shapes[i].collisionMask=FRAME|STICK,h1.body.shapes[i].material=icematerial}return{d:s.d,h:heightfield,h1:h1,h1verts:s.h1verts,o:obstacles,od:s.od,inverts:s.inverts}}function changenum(s1,num,oldnum){var s=copysec(s1);s.h.body.position[0]+=(num-oldnum)*secwidth;for(var i=0;i<s.o.length;i++)s.o[i].position[0]+=(num-oldnum)*secwidth,s.o[i].velocity=[0,0];return null!=s.h1&&(s.h1.body.position[0]+=(num-oldnum)*secwidth),s}function caveMouthSigmoid(x){return-2*(x/(1+Math.abs(x)))-1}function generateSection(){for(var data=[],ceilverts=[],startedceil=!1,ceilx=null,ceily=null,ice=!1,i=0;i<=secwidth/2;i++){var v=(i+secnum*secwidth/2)/10,value=1.75*noise.simplex2(v,0),lvl=distToTime(secnum*secwidth+2*i);if(lvl>2)if(lvl%2<1&&(Math.floor(lvl)<7||9==Math.floor(lvl))){value/=1.75;var ychange=null;if(lvl%1<=.5){var x=lvl%1*4-1;ychange=caveMouthSigmoid(x)*caveDepth}if(lvl%1>.5){var x=(lvl-.5)%1*4-1;ychange=caveMouthSigmoid(-x)*caveDepth}if(value+=ychange,ychange<-caveDepth/2||startedceil){var y=value+caveHeight;startedceil||(ceilx=2*i,ceily=y,startedceil=!0,ceilverts.push([5,5]),ceilverts.push([0,8])),ceilverts.push([2*i-ceilx,y-ceily]),i%rarity==rarity-2&&i!=secwidth/2&&(Math.random()>.5?value+=2*Math.random():ceilverts.push([2*i-ceilx,y-ceily-1.5*Math.random()-1]))}}else lvl>=7&&lvl<9&&(startedceil?value=-2:(value=Math.max(value,1),ceilx=2*i,ceily=-9,startedceil=!0,ice=!0,ceilverts.push([0,0])),ceilverts.push([2*i-ceilx,1-ceily]));data.push(value)}var heightfield=new Object;if(heightfield.shape=new p2.Heightfield({heights:data,elementWidth:2}),heightfield.body=new p2.Body({position:[-1,-1]}),heightfield.shape.collisionGroup=GROUND,heightfield.shape.collisionMask=FRAME|STICK,heightfield.body.addShape(heightfield.shape),startedceil){ice?ceilverts.push([ceilverts[ceilverts.length-1][0],0]):ceilverts.push([ceilverts[ceilverts.length-1][0],ceilverts[ceilverts.length-1][1]+5+3]);var h1=new Object;h1.body=new p2.Body({position:[ceilx-1,ceily-1]}),h1.body.fromPolygon(JSON.parse(JSON.stringify(ceilverts)));for(var i=0;i<h1.body.shapes.length;i++)h1.body.shapes[i].collisionGroup=GROUND,h1.body.shapes[i].collisionMask=FRAME|STICK,h1.body.shapes[i].material=icematerial}for(var od=[],y=null,obstacles=[],i=1;i<data.length;i++)if(i%rarity==0){var lvl=Math.floor(distToTime(secnum*secwidth+2*i));y=Math.random()>.5&&0!=lvl&&lvl>2&&lvl%2<1?data[i]+2*Math.random():data[i]+5-2*Math.random(),0==lvl&&(y+=4),lvl>2&&lvl<3&&(y-=20),od.push(y);var circleShape=new p2.Circle({radius:.5,sensor:!0}),circleBody=new p2.Body({mass:1,position:[2*i,y],fixedX:!0,fixedY:!0}),circleShapeCoin=new p2.Circle({radius:.3,sensor:!0});circleBody.addShape(circleShape),circleBody.addShape(circleShapeCoin),circleShape.collisionGroup=OBSTACLE,circleShape.collisionMask=FRAME|STICK,circleShapeCoin.collisionGroup=OBSTACLE,circleShapeCoin.collisionMask=FRAME|STICK,obstacles.push(circleBody)}return secnum+=1,null!=h1&&ceilverts.length<1&&(ceilverts=[[-1,1],[-1,0],[1,0],[1,1],[.5,.5]]),{d:data,h:heightfield,h1:h1,h1verts:ceilverts,o:obstacles,od:od,inverts:new Array(obstacles.length).fill(!1)}}function addSection(s){world.addBody(s.h.body);for(var i=0;i<s.o.length;i++)world.addBody(s.o[i]);null!=s.h1&&world.addBody(s.h1.body)}function removeSection(s){world.removeBody(s.h.body);for(var i=0;i<s.o.length;i++)world.removeBody(s.o[i]);null!=s.h1&&world.removeBody(s.h1.body)}function getsecwidth(){var canvaswidth=Math.ceil(w/50+padding),x=Math.ceil(canvaswidth/rarity)*rarity;return x}function isEmpty(str){return!str||0===str.length}function distToTime(dist){return lvlCnt*(1-Math.pow(1-1/lvlCnt,dist/lvl1length))}function initgame(){resetHealth(),initgamepartial()}function initgamepartial(){orientationData=new FULLTILT.DeviceOrientation({type:"game"}),initRender(),cookie=getCookie("topscore"),isEmpty(cookie)?document.cookie="topscore=0; expires=Tue, 19 Jan 2038 03:14:07 UTC;":topscore=parseInt(cookie),score=0,secnum=0,lives=3,gameOver=!1,pendingquit=!1,world=new p2.World({gravity:[0,-7]}),world.defaultContactMaterial.friction=100,world.defaultContactMaterial.restitution=.1,world.addContactMaterial(new p2.ContactMaterial(icematerial,pogomaterial,{restitution:0,friction:25}));var pogox=w/50/2;pogo={stick:new Object,frame:new Object,spring:null},pogo.stick.shape=new p2.Box({width:.25,height:1.6,material:pogomaterial}),pogo.stick.body=new p2.Body({mass:.25,position:[pogox,2.75],angularVelocity:angularVelocity,velocity:[5,0]}),pogo.frame.shape=new p2.Box({width:.5,height:1.5,material:pogomaterial}),pogo.frame.body=new p2.Body({mass:3,position:[pogox,3],angularVelocity:angularVelocity,velocity:[5,0]}),pogo.frame.body.addShape(pogo.frame.shape),pogo.stick.body.addShape(pogo.stick.shape),world.addBody(pogo.frame.body),world.addBody(pogo.stick.body);var c1=new p2.PrismaticConstraint(pogo.frame.body,pogo.stick.body,{localAnchorA:[0,.5],localAnchorB:[0,.5],localAxisA:[0,1],disableRotationalLock:!0}),c2=new p2.PrismaticConstraint(pogo.frame.body,pogo.stick.body,{localAnchorA:[0,0],localAnchorB:[0,1],localAxisA:[0,1],disableRotationalLock:!0});c1.setLimits(-1,-.4),world.addConstraint(c2),world.addConstraint(c1),pogo.spring=new p2.LinearSpring(pogo.frame.body,pogo.stick.body,{restLength:restLength,stiffness:stiffness,damping:damping,localAnchorA:[0,0],localAnchorB:[0,0]}),world.addSpring(pogo.spring),secwidth=getsecwidth(),sectionA=generateSection(),sectionB=changenum(generateSection(),1,0),addSection(sectionA),addSection(sectionB),pogo.frame.shape.collisionGroup=FRAME,pogo.stick.shape.collisionGroup=STICK,pogo.frame.shape.collisionMask=GROUND|OBSTACLE,pogo.stick.shape.collisionMask=GROUND|OBSTACLE,world.on("postStep",updateObstacles),world.on("beginContact",function(event){if(event.bodyA==pogo.frame.body||event.bodyB==pogo.frame.body){var h=event.bodyA==sectionA.h.body||event.bodyB==sectionA.h.body;if(h=h||event.bodyA==sectionB.h.body||event.bodyB==sectionB.h.body){if(debugtesting)return;lives=0,loseHeart()}else if(!rabbitElegible||rabbitMode||event.shapeA.sensor||event.shapeB.sensor){if(debugtesting)return;var isCoin=!1;if(event.shapeA==pogo.frame.shape?(console.log(event.shapeB),isCoin=.3==event.shapeB.radius):(console.log(event.shapeA),isCoin=.3==event.shapeA.radius),isCoin)return void coinsCnt++;lives-=1,loseHeart()}else console.log(event),rabbitMode=1,lives=3,icematerial.friction*=2,alert("Welcome. You found my *easter egg* (pun intended)! Don't tell others how to get the rabbit but be sure to show them the result!");(lives<=0||h)&&(gameOver=!0,leftplay=!1)}})}function updateObstacles(){var t=distToTime((secnum-1)*secwidth);if(t>3)if(t<5){for(var i=0;i<sectionA.o.length;i++)sectionA.o[i].fixedY=!1,sectionA.o[i].velocity[1]=2.5*Math.sin(3*world.time);for(var i=0;i<sectionB.o.length;i++)sectionB.o[i].fixedY=!1,sectionB.o[i].velocity[1]=2.5*Math.sin(3*world.time)}else{for(var calc=function(b,a,invert){var v=[a[0]-b[0],a[1]-b[1]],mag=Math.sqrt(v[0]*v[0]+v[1]*v[1]);if(mag<=0)return console.log("zero mag! target reached!"),[0,0];var speed=Math.sin(Math.min(mag,9)/10*Math.PI);return speed*=3,speed=Math.max(speed,1),speed/mag<=0&&console.log("HELP ME!!!!!"),speed*=invert?-1:1,v=[v[0]*speed/mag,v[1]*speed/mag]},i=0;i<sectionA.o.length;i++){var pos=sectionA.o[i].position,ppos=pogo.stick.body.position;sectionA.o[i].velocity=calc(pos,ppos,sectionA.inverts[i])}for(var i=0;i<sectionB.o.length;i++){var ppos=sectionB.o[i].position,pos=pogo.stick.body.position;sectionB.o[i].velocity=calc(pos,ppos,sectionB.inverts[i])}}}function openDebug(){!function(){var scriptTag=document.createElement("script");scriptTag.type="text/javascript",scriptTag.src="https://getfirebug.com/firebug-lite.js#startOpened",document.getElementsByTagName("head")[0].appendChild(scriptTag);var ready=function(){console.log("test")};scriptTag.onreadystatechange=function(){"complete"==scriptTag.readyState&&ready()},scriptTag.onload=ready}()}function gohome(){home=!0,console.log(oldlabel),$(".dropdowntitle").val(oldlabel),document.getElementById("pausebutton").className="circlebutton",document.getElementById("helpbutton").className="circlebutton",document.getElementById("settingsbutton").className="circlebutton",document.getElementById("pausebutton").style.display="none",document.getElementById("modeHUD").style.display="none",document.getElementById("helpbutton").style.display="none",document.getElementById("settingsbutton").style.display="none",document.getElementById("mainmenu").style.display="inline",document.getElementById("mainmenu").style.opacity="1",document.getElementById("myCanvas").style.display="none",document.getElementById("gamearea").style.backgroundColor="white",document.getElementById("homebutton").style.display="none",document.getElementById("tutnextb").style.display="none",document.getElementById("health").style.display="none",clearTimer(),gameOver&&(leftplay=!0),tutorialm=!1,pause=!1}function play(){tutorialm=!1,home=!1,ga("send","event",{eventCategory:"Menu Interaction",eventAction:"click",eventLabel:"play"}),pause&&back(),resetHealth(),document.getElementById("modeHUD").style.display="block",document.getElementById("modeHUD").style.animation="zoominout 0.75s linear forwards",document.getElementById("pausebutton").className="circlebutton",document.getElementById("helpbutton").className="circlebutton",document.getElementById("settingsbutton").className="circlebutton",document.getElementById("helpbutton").style.display="none",document.getElementById("settingsbutton").style.display="none",document.getElementById("mainmenu").style.display="none",document.getElementById("mainmenu").style.opacity="0",document.getElementById("myCanvas").style.display="inline",document.getElementById("pausebutton").innerHTML='<i class="fa fa-pause"></i>',document.getElementById("pausebutton").style.display="block",document.getElementById("myCanvas").style.opacity="1",document.getElementById("gamearea").style.backgroundColor="black",document.getElementById("homebutton").style.display="none",pause||init(),requestAnimationFrame(animate),pause=!1}function pausegame(){$("#errortxt").hide(),tutorialm||(pause?play():(pause=!0,filtersEnabled?document.getElementById("myCanvas").style.opacity="0.7":document.getElementById("myCanvas").style.opacity="0.5",document.getElementById("pausebutton").innerHTML='<i class="fa fa-play"></i>',document.getElementById("helpbutton").style.display="inline-block",document.getElementById("settingsbutton").style.display="inline-block",document.getElementById("homebutton").style.display="inline-block",document.getElementById("pausebutton").className="circlebuttoni",document.getElementById("helpbutton").className="circlebuttoni",document.getElementById("settingsbutton").className="circlebuttoni"))}function mainbpprep(){document.getElementById("mainmenu").style.display="none",document.getElementById("mainmenu").style.opacity="0",document.getElementById("myCanvas").style.display="inline",document.getElementById("pausebutton").innerHTML='<i class="fa fa-pause"></i>',document.getElementById("pausebutton").style.display="block",document.getElementById("myCanvas").style.opacity="1",document.getElementById("gamearea").style.backgroundColor="black",init(),animate(),pause=!0,document.getElementById("myCanvas").style.opacity="0.3",document.getElementById("pausebutton").innerHTML='<i class="fa fa-play"></i>',document.getElementById("helpbutton").style.display="inline-block",document.getElementById("settingsbutton").style.display="inline-block",document.getElementById("pausebutton").className="circlebuttoni",document.getElementById("helpbutton").className="circlebuttoni",document.getElementById("settingsbutton").className="circlebuttoni"}function tutorial(){console.log("tutorial() Called"),test(),home=!1,ga("send","event",{eventCategory:"Menu Interaction",eventAction:"click",eventLabel:"tutorial"}),oldlabel=$(".dropdowntitle").val(),document.getElementById("mainmenu").style.display="none",document.getElementById("mainmenu").style.opacity="0",document.getElementById("myCanvas").style.display="inline",document.getElementById("myCanvas").style.opacity="1",document.getElementById("tuthelp").style.display="block",document.getElementById("tuthelp").style.opacity="1",document.getElementById("lvl0").style.display="block",document.getElementById("lvl2").style.display="none",document.getElementById("homebutton").style.display="none",document.getElementById("gamearea").style.backgroundColor="black",tutorialm=!0,pause=!1,lvl=0,init(),animate()}function help(){ga("send","event",{eventCategory:"Menu Interaction",eventAction:"click",eventLabel:"help"}),document.getElementById("helpbutton").style.display="none",document.getElementById("settingsbutton").style.display="none",document.getElementById("helparea").style.display="block",document.getElementById("helparea").style.opacity="1",document.getElementById("homebutton").style.display="none"}function help1(){mainbpprep(),help()}function settings(){ga("send","event",{eventCategory:"Menu Interaction",eventAction:"click",eventLabel:"settings"}),document.getElementById("homebutton").style.display="none",document.getElementById("helpbutton").style.display="none",document.getElementById("settingsbutton").style.display="none",document.getElementById("settings").style.display="block",document.getElementById("settings").style.opacity="1"}function settings1(){mainbpprep(),settings()}function back(){document.getElementById("helpbutton").style.display="inline-block",document.getElementById("settingsbutton").style.display="inline-block",document.getElementById("homebutton").style.display="inline-block",document.getElementById("helparea").style.display="none",document.getElementById("helparea").style.opacity="0",document.getElementById("settings").style.display="none",document.getElementById("settings").style.opacity="0"}function togglefixedjoy(){fixedjoy=!fixedjoy,document.getElementById("fixedjoy").innerHTML=(fixedjoy?"Unfix":"Fix")+" joystick location",fixedjoy?(document.getElementById("unfixjoyhelp").display="none",document.getElementById("fixjoyhelp").display="inherit",setupjoy()):(document.getElementById("unfixjoyhelp").display="inherit",document.getElementById("fixjoyhelp").display="none")}function updatehelp(){controlMode.isJoystickVariant?($(".joyhelp").show(),$(".gyrohelp").hide(),$(".keyboardhelp").hide(),controlMode.mode==controlMode.JOYSTICK?($(".fixjoyhelp").show(),$(".unfixjoyhelp").hide()):controlMode.mode==controlMode.UNFIXED_JOYSTICK&&($(".fixjoyhelp").hide(),$(".unfixjoyhelp").show())):($(".joyhelp").hide(),controlMode.mode==controlMode.KEYBOARD?($(".gyrohelp").hide(),$(".keyboardhelp").show()):controlMode.mode==controlMode.GYRO&&($(".gyrohelp").show(),$(".keyboardhelp").hide()))}function toggleColor(){colorful=!colorful,document.getElementById("coltoggle").innerHTML=(colorful?"Disable":"Enable")+" colors"}function updateSky(){color.sky="#"+document.getElementById("skyCP").value}function updateGround(){color.ground="#"+document.getElementById("groundCP").value}function updateBody(){color.body="#"+document.getElementById("bodyCP").value}function updateStick(){color.stick="#"+document.getElementById("stickCP").value}function resetcolors(){colorful||toggleColor(),document.getElementById("skyCP").jscolor.fromString(colordef.sky.slice(1)),document.getElementById("groundCP").jscolor.fromString(colordef.ground.slice(1)),document.getElementById("bodyCP").jscolor.fromString(colordef.body.slice(1)),document.getElementById("stickCP").jscolor.fromString(colordef.stick.slice(1)),color.sky=colordef.sky,color.ground=colordef.ground,color.body=colordef.body,color.stick=colordef.stick}function getHatX(x){var idx,gh=0,worldX=x/50-xscroll-w/50/2;if(worldX>sectionB.h.body.position[0]){var real=(worldX-sectionB.h.body.position[0])/2;idx=Math.floor(real);var amnt=real%2/2,diff=sectionB.d[idx+1]-sectionB.d[idx]||0;gh=50*-(sectionB.d[idx]+diff*amnt)}else{var real=(worldX-sectionA.h.body.position[0])/2;idx=Math.floor(real);var amnt=2*real%2/2,diff=sectionA.d[idx+1]-sectionA.d[idx]||0;gh=50*-(sectionA.d[idx]+diff*amnt)}return gh+=h/2,gh+=50*yscroll,gh+=50}function updateCloud(){for(var i=0;i<this.snow.particles.length;i++)this.snow.particles[i].x-=.5*this.xoffset,this.snow.particles[i].y-=this.yoffset;this.snow.angle+=.01;for(var i=0;i<this.snow.mp;i++){var p=this.snow.particles[i];p.y+=Math.cos(this.snow.angle+p.d)+1+p.r/2,p.x+=2*Math.sin(this.snow.angle);var lvl=distToTime(score+pogo.frame.body.position[0]-w/50/2);if(0==this.idx&&6!=Math.floor(lvl)){var h=getHatX(p.x);lvl>6&&(h=0,h+=this.h/2,h+=50*yscroll),(p.x>w+5||p.x<-5||p.y>h)&&(i%3>0?this.snow.particles[i]={x:Math.random()*w*2,y:-10,r:p.r,d:p.d}:Math.sin(this.snow.angle)>0?this.snow.particles[i]={x:-5,y:Math.random()*h,r:p.r,d:p.d}:this.snow.particles[i]={x:w+5,y:Math.random()*h,r:p.r,d:p.d})}}this.x-=this.xoffset,this.y-=this.yoffset;for(var i=0;i<this.rain.particles.length;i++)this.rain.particles[i].x-=this.xoffset,this.rain.particles[i].y+=this.yoffset;for(var i=0;i<this.rain.drops.length;i++)this.rain.drops[i].x-=this.xoffset,this.rain.drops[i].y-=this.yoffset;for(var activeparticles,localparticles=this.rain.particles,localdrops=this.rain.drops,i=0;activeparticles=localparticles[i];i++){activeparticles.x+=activeparticles.velX,activeparticles.y+=activeparticles.velY+5;var gh=getHatX(activeparticles.x);activeparticles.y>gh&&(localparticles.splice(i--,1),this.rain.splash(activeparticles.x,activeparticles.y,activeparticles.col))}for(var activedrops,i=0;activedrops=localdrops[i];i++)activedrops.x+=activedrops.velX,activedrops.y+=activedrops.velY,activedrops.radius-=.075,activedrops.alpha>0?activedrops.alpha-=.005:activedrops.alpha=0,activedrops.radius<0&&localdrops.splice(i--,1);for(var i=currentRainAmnt;i--;){if(0!=this.idx){i=0;break}this.rain.addRaindrops(Math.random()*this.w*2,-500)}var left=this.x<-cloudSize,right=this.x>6*this.w+cloudSize;(cloudsVisible||newlyVisible)&&(left||right)&&(this.y=(this.h/2-20-this.h/87.5-10)*Math.random()-10,this.speed=Math.random()*(cloudSpeedDef-cloudSpeedMin)+cloudSpeedMin,left||justNowVisible?(this.x=this.w+cloudSize,justNowVisible&&(this.x+=2.4*this.w*(Math.random()+.25))):newlyVisible||(this.x=-cloudSize)),justNowVisible=!cloudsVisible,this.x+=this.speed*cloudSpeed}function addRaindrops(x,y,pieces){for(pieces=pieces||2;pieces--;)this.particles.push({velX:.25*Math.random(),velY:9*Math.random()+1,x:x,y:y,alpha:1,col:"hsla(200, 100%, 50%, 0.8)"})}function splash(x,y,col,cnt){for(cnt=cnt||splashSize;cnt--;)this.drops.push({velX:4*Math.random()-2,velY:Math.random()*-4,x:x,y:y,radius:.65+Math.floor(1.6*Math.random()),alpha:1,col:col})}function renderCloud(){var val=Math.floor(distToTime(score+pogo.frame.body.position[0]-w/50/2));if(val>=5&&6!=val){ctx.fillStyle="rgba(255, 255, 255, 0.8)",ctx.beginPath();for(var i=0;i<this.snow.mp;i++){var p=this.snow.particles[i];ctx.moveTo(p.x,p.y),ctx.arc(p.x,p.y,p.r,0,2*Math.PI,!0)}ctx.fill()}for(var activeparticles,tau=2*Math.PI,localparticles=this.rain.particles,localdrops=this.rain.drops,i=0;activeparticles=localparticles[i];i++)ctx.globalAlpha=activeparticles.alpha,ctx.fillStyle=activeparticles.col,ctx.fillRect(activeparticles.x,activeparticles.y,activeparticles.velY/4,activeparticles.velY);for(var activedrops,i=0;activedrops=localdrops[i];i++)ctx.globalAlpha=activedrops.alpha,ctx.fillStyle=activedrops.col,ctx.beginPath(),ctx.arc(activedrops.x,activedrops.y,activedrops.radius,0,tau),ctx.fill();ctx.drawImage(offscreenCanvas,2*(this.x-cloudSize/2),this.y)}function Snow(){this.angle=0,this.mp=45,this.particles=[];for(var i=0;i<this.mp;i++)this.particles.push({x:Math.random()*w,y:Math.random()*h,r:4*Math.random()+1,d:Math.random()*this.mp})}function Cloud(x,y,speed,w,h,idx){this.idx=idx,this.x=x,this.y=y,this.xoffset=0,
this.yoffset=0,this.worldX=0,this.w=w,this.h=h,this.speed=speed,this.update=updateCloud,this.render=renderCloud,this.rain={pieces:2,particles:[],drops:[],splash:splash},this.rain.addRaindrops=addRaindrops,this.snow=new Snow}function initRender(){offscreenContext.fillStyle="rgba(255, 255, 255, 0)",offscreenContext.fillRect(0,0,300,300),offscreenContext.shadowBlur=7,offscreenContext.shadowColor="black",offscreenContext.font=cloudSize+"px FontAwesome",offscreenContext.globalAlpha="0.7",offscreenContext.fillStyle="#ffffff",offscreenContext.fillText("",0,80);var ow=obstacleCanvas.width,oh=obstacleCanvas.height;obstacleContext.lineWidth="0.05",obstacleContext.fillStyle="green",obstacleContext.fillRect(0,0,2*ow,2*oh),obstacleContext.strokeStyle="white",obstacleContext.beginPath(),obstacleContext.arc(ow/2,oh/2,.485,0,2*Math.PI,!1),obstacleContext.stroke(),obstacleContext.strokeStyle="orange",obstacleContext.beginPath(),obstacleContext.arc(ow/2,oh/2,.525,0,2*Math.PI,!1),obstacleContext.stroke(),obstacleContext.strokeStyle="purple",obstacleContext.beginPath(),obstacleContext.arc(ow/2,oh/2+coinDist,.3,0,2*Math.PI,!1),obstacleContext.stroke(),obstacleContext.strokeStyle="black",obstacleContext.beginPath(),obstacleContext.arc(ow/2,oh/2,.5,0,2*Math.PI,!1),obstacleContext.stroke(),clouds=[];for(var i=0;i<cloudCnt;i++)clouds.push(new Cloud(Math.random()*w,(h/2-20-h/87.5-10)*Math.random()-10,Math.random()*(cloudSpeedDef-cloudSpeedMin)+cloudSpeedMin,1.2*w,h,i));lastpx=w/50/2}function animate(time){if(!(home||pause&&fullPause)){requestAnimationFrame(animate),keyboard&&((keyspressed.up||keyspressed.space)&&(pogo.spring.restLength=1.25,pogo.spring.applyForce()),keyspressed.left&&keyspressed.right||(keyspressed.left&&(pogo.frame.body.angularVelocity=+twistval*keysensitivityval/100),keyspressed.right&&(pogo.frame.body.angularVelocity=-twistval*keysensitivityval/100)),keyspressed.up||keyspressed.space||(pogo.spring.restLength=.25,pogo.spring.applyForce()),!keyspressed.left&&!keyspressed.right&&Math.abs(pogo.frame.body.angularVelocity)>twistval*keysensitivityval/100*3/7&&(pogo.frame.body.angularVelocity/=8));var deltaTime=lastTime?(time-lastTime)/1e3:0;lastTime=time,deltaTime=Math.min(.1,deltaTime),world.step(fixedDeltaTime,deltaTime,maxSubSteps),tutorialm?rendertut():render()}}function lerp(a,b,u){return(1-u)*a+u*b}function componentToHex(c){var hex=c.toString(16);return 1==hex.length?"0"+hex:hex}function rgbToHex(r,g,b){return"#"+componentToHex(r)+componentToHex(g)+componentToHex(b)}function hexToRgb(hex){var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null}function manageSectioning(){var px=pogo.frame.body.position[0];if(px-w/50/2>secwidth){removeSection(sectionA),removeSection(sectionB);for(var i=0;i<sectionA.inverts.length;i++)sectionA.inverts[i]=!1;for(var i=0;i<sectionB.inverts.length;i++)sectionB.inverts[i]=!1;for(var i=0;i<sectionA.o.length;i++){var o=sectionA.o[i];o.position[0]>sectionB.h.body.position[0]&&(sectionB.o.push(o),sectionA.o.splice(i,1),sectionB.inverts.push(!1),sectionA.inverts.splice(i,1))}sectionA=changenum(sectionB,0,1),sectionB=changenum(generateSection(),1,0),pogo.frame.body.position[0]-=secwidth,pogo.stick.body.position[0]-=secwidth,addSection(sectionA),addSection(sectionB),score+=secwidth}if(px<w/50/2&&secnum>2){removeSection(sectionA),removeSection(sectionB);for(var i=0;i<sectionA.inverts.length;i++)sectionA.inverts[i]=!sectionA.inverts[i];for(var i=0;i<sectionB.inverts.length;i++)sectionB.inverts[i]=!sectionB.inverts[i];secnum-=2,sectionB=changenum(sectionA,1,0),sectionA=generateSection(),pogo.frame.body.position[0]+=secwidth,pogo.stick.body.position[0]+=secwidth,updateObstacles(),addSection(sectionA),addSection(sectionB),updateObstacles(),score-=secwidth}}function logistic(val){return Math.sign(val)/(1+Math.pow(Math.E,-val))}function drawSunAndMoon(){var angle=progress*Math.PI-Math.PI;ctx.font="100px FontAwesome",ctx.fillStyle="#ffff00",ctx.textAlign="center",ctx.fillText("",Math.cos(angle)*h/2+w/2,Math.sin(angle)*h/2+50*yscroll+5*h/9),ctx.fillStyle="#ddddff",ctx.textAlign="center",ctx.fillText("",Math.cos(angle+Math.PI)*h/2+w/2,Math.sin(angle+Math.PI)*h/2+50*yscroll+5*h/9)}function render(){if(score>5899&&!alreadyWelcomed&&(alreadyWelcomed=!0,alert("Welcome to the end. Sadly, no dragon (yet). P.S. I know you would never cheat to get here ;)")),pause){if(fullPause||!filtersEnabled)return ctx.filter="none",void(fullPause=!0);ctx.filter="blur(30px)",fullPause=!0}else ctx.filter="none",fullPause=!1;var px=pogo.frame.body.position[0];manageSectioning(),(pogo.frame.body.position[0]<0||pogo.frame.body.position[1]<-15)&&(gameOver=!0,leftplay=!1,pogo.frame.body.position[0]=Math.max(pogo.frame.body.position[0],-2),pogo.frame.body.position[1]=Math.max(pogo.frame.body.position[1],-15)),colorful?ctx.fillStyle=color.sky:ctx.fillStyle="#FFFFFF",ctx.fillRect(0,0,w,h);for(var xdelta=50*(Math.max(pogo.frame.body.position[0],w/50/2)+xscroll)%secwidth,i=0;i<clouds.length;i++)clouds[i].xoffset=xdelta;var ysold=yscroll;if(px>=w/50/2&&(xscroll=-pogo.frame.body.position[0]),v=pogo.frame.body.position[1]-yscroll,Math.abs(v)>.35?lerpval=.015:lerpval=.01,v<-.2&&(lerpval=.0325),yscroll=v*lerpval+yscroll,progress=distToTime(score+pogo.frame.body.position[0]-w/50/2),drawSunAndMoon(),fadeColors(progress),!addedClouds&&progress>3){for(var i=0;i<cloudCnt;i++)clouds.push(new Cloud(Math.random()*w,(h/2-20-h/87.5-10)*Math.random()-10,Math.random()*(cloudSpeedDef-cloudSpeedMin)+cloudSpeedMin,w,h,i+cloudCnt));addedClouds=!0}filtersEnabled&&(3==Math.floor(progress)||5==Math.floor(progress)||progress>=7?cloudsDark||(offscreenContext.fillStyle="rgba(255, 255, 255, 0)",offscreenContext.fillRect(0,0,300,300),offscreenContext.filter="brightness(50%)",offscreenContext.shadowBlur=7,offscreenContext.shadowColor="black",offscreenContext.font=cloudSize+"px FontAwesome",offscreenContext.globalAlpha="0.7",offscreenContext.fillStyle="#ffffff",offscreenContext.fillText("",0,80),cloudsDark=!0):cloudsDark&&(offscreenContext.fillStyle="rgba(255, 255, 255, 0)",offscreenContext.fillRect(0,0,300,300),offscreenContext.filter="none",offscreenContext.shadowBlur=7,offscreenContext.shadowColor="black",offscreenContext.font=cloudSize+"px FontAwesome",offscreenContext.globalAlpha="0.7",offscreenContext.fillStyle="#ffffff",offscreenContext.fillText("",0,80),cloudsDark=!1)),progress>3&&(currentRainAmnt=progress<4?rainAmnt:0),ctx.save(),ctx.translate(w/2,h/2),ctx.scale(50,-50);for(var i=0;i<clouds.length;i++)clouds[i].yoffset=50*-(yscroll-ysold)*1.75;ctx.translate(xscroll,-yscroll),drawpogo();var x=-1,y=-1;ctx.beginPath(),ctx.moveTo(x,-h/50*7/4);for(var px=-xscroll,cdata=sectionA.d.slice(0,-1).concat(sectionB.d),i=0;i<cdata.length;i++){var x1=2*i;if(x1>=px-w/50/2-1&&ctx.lineTo(x+x1,y+cdata[i]),x1>px+w/50/2+2)break}ctx.lineTo(x+2*cdata.length-2,-h/50*7/4),ctx.closePath(),ctx.fillStyle=color.ground,colorful&&ctx.fill(),ctx.stroke();var ah1=null!=sectionA.h1,bh1=null!=sectionB.h1;if(ctx.fillStyle="#555555",progress<6.85||9==Math.floor(progress)||(ctx.fillStyle="#5555FF"),ah1){ctx.beginPath();var startpos=sectionA.h1.body.position,dat=sectionA.h1verts;ctx.moveTo(dat[0][0]+startpos[0],dat[0][1]+startpos[1]);for(var i=1;i<dat.length-1;i++){var x1=2*i;ctx.lineTo(startpos[0]+dat[i][0],startpos[1]+dat[i][1])}ctx.lineTo(dat[dat.length-1][0]+startpos[0],dat[dat.length-1][1]+startpos[1]),ctx.closePath(),colorful&&ctx.fill(),ctx.stroke()}if(bh1){ctx.beginPath();var startpos=sectionB.h1.body.position,dat=sectionB.h1verts;ctx.moveTo(dat[0][0]+startpos[0],dat[0][1]+startpos[1]);for(var i=1;i<dat.length-1;i++){var x1=2*i;ctx.lineTo(startpos[0]+dat[i][0],startpos[1]+dat[i][1])}ctx.lineTo(dat[dat.length-1][0]+startpos[0],dat[dat.length-1][1]+startpos[1]),ctx.closePath(),colorful&&ctx.fill(),ctx.stroke()}ctx.restore();for(var i=0;i<clouds.length;i++)clouds[i].update(),clouds[i].render();ctx.save(),ctx.translate(w/2,h/2),ctx.scale(50,-50),ctx.translate(xscroll,-yscroll),ctx.strokeStyle="#000000",drawObstacles1(sectionA),drawObstacles1(sectionB);for(var idx=-1,closest=-1,A=!0,i=0;i<sectionA.o.length;i++)sectionA.o[i].position[0]>px+w/50/2&&(sectionA.o[i].position[0]-px<closest||closest==-1)&&(closest=sectionA.o[i].position[0]-px,idx=i);for(var i=0;i<sectionB.o.length;i++)sectionB.o[i].position[0]>px+w/50/2&&(sectionB.o[i].position[0]-px<closest||closest==-1)&&(closest=sectionB.o[i].position[0]-px,idx=i,A=!1);try{if(A)var o=sectionA.o[idx];else var o=sectionB.o[idx];canvas_arrow(px+w/50/2-.3-1,o.position[1],px+w/50/2+.5-1+.04,o.position[1]),ctx.strokeStyle="white",ctx.stroke(),canvas_arrow(px+w/50/2-.3-1,o.position[1],px+w/50/2+.5-1,o.position[1]),ctx.strokeStyle="black",ctx.stroke()}catch(e){}ctx.restore(),drawControls();var groundRGB=hexToRgb(color.ground),groundLuma=Math.round(255*(.2126*groundRGB.r+.7152*groundRGB.g+.0722*groundRGB.b-40)/100);ctx.fillStyle=rgbToHex(255-groundLuma,255-groundLuma,255-groundLuma),ctx.font="20px Courier New",ctx.textAlign="left",ctx.fillText("Next obstacle: "+Math.floor(closest),10,h-20);var skyRGB=hexToRgb(color.sky),skyLuma=Math.round(255*(.2126*skyRGB.r+.7152*skyRGB.g+.0722*skyRGB.b-30)/90)-10;ctx.fillStyle=rgbToHex(255-skyLuma,255-skyLuma,255-skyLuma);var daysRaw=progress/2+.25,delta=24*daysRaw*60*60,days=Math.floor(delta/86400);delta-=86400*days;var hours=Math.floor(delta/3600)%24;delta-=3600*hours;var minutes=Math.floor(delta/60)%60;delta-=60*minutes;var timeTxt="Day "+days+", ",hrsTxt=hours%12+1+"";if(timeTxt+=("0"+hrsTxt).substring(hrsTxt.length-1)+":",timeTxt+=("0"+minutes).substring((""+minutes).length-1)+" ",timeTxt+=hours>11?"PM":"AM",ctx.fillText(timeTxt,10,60),ctx.fillText(coinsCnt+"€",10,80),multi&&ctx.fillText(""+opponentScore,10,100),gameOver){ctx.font="30px Courier New",ctx.fillStyle="red",ctx.textAlign="center",pendingquit||(endscore=score+Math.round(pogo.frame.body.position[0])-Math.floor(w/50/2),newtopscore=!1,endscore>topscore&&(topscore=endscore,newtopscore=!0,document.cookie="topscore="+endscore+"; expires=Tue, 19 Jan 2038 03:14:07 UTC"),pendingquit=!0,restarttimer=setTimeout(function(){gameOver=!1,mobile&&(pendingquit=!1,initgame())},3e3));var msg="";newtopscore&&(msg="New High Score!\n"),ctx.fillText(msg+"Score: "+endscore,w/2,h/2-40)}else pendingquit?(ctx.font="30px Courier New",ctx.fillStyle="red",ctx.textAlign="center",ctx.fillText("Press Any Key to Continue...",w/2,h/2-40)):(ctx.textAlign="left",ctx.fillText("High Score: "+topscore,10,25),scoreVal=score-Math.floor(w/50/2)+Math.round(pogo.frame.body.position[0]),ctx.fillText("Score: "+scoreVal,10,42),multiplayer&&sendData(JSON.stringify({scoreFrame:""+(score-Math.floor(w/50/2)+pogo.frame.body.interpolatedPosition[0]),scoreStick:""+(score-Math.floor(w/50/2)+pogo.stick.body.interpolatedPosition[0]),stickY:""+pogo.stick.body.position[1],frameY:""+pogo.frame.body.position[1],frameAngle:pogo.frame.body.angle,stickAngle:pogo.stick.body.angle,size:{frame:{height:pogo.frame.shape.height,width:pogo.frame.shape.width},stick:{height:pogo.stick.shape.height,width:pogo.stick.shape.width}}})))}function drawControls(){if(!keyboard&&!gyro){canvas.getBoundingClientRect();if(ctx.save(),fixedjoy&&!nojoystick){var jx=Math.round(jloc.x),jy=Math.round(jloc.y);ctx.beginPath(),ctx.arc(jx,jy,50,0,2*Math.PI,!1),ctx.globalAlpha=.5,ctx.fillStyle="#555555",ctx.fill(),ctx.beginPath(),ctx.arc(jx,jy,10,0,2*Math.PI,!1),ctx.globalAlpha=.7,ctx.fillStyle="#AAAAAA",ctx.fill()}if(ctx.restore(),ctx.save(),mousedrag&&!nojoystick){var mx1=Math.round(lastmouse.x),my1=Math.round(lastmouse.y),mx2=Math.round(currentmouse.clientX),my2=Math.round(currentmouse.clientY);ctx.beginPath();var origw=ctx.lineWidth;ctx.lineWidth=2,ctx.strokeStyle="#999999",ctx.moveTo(mx1,my1),ctx.lineTo(mx2,my2),ctx.stroke(),ctx.beginPath(),ctx.arc(mx2,my2,4,0,2*Math.PI,!1),ctx.fillStyle="#999999",ctx.stroke(),ctx.fill(),ctx.lineWidth=origw}ctx.restore()}}function fadeColors(progress){var nightCol=hexToRgb(color.skynight),dayCol=hexToRgb(color.skyday),t=(progress+.5)%2,a=dayCol,b=nightCol;if(t>1){var tmp=a;a=b,b=tmp}var r=Math.round(lerp(a.r,b.r,1-t%1)),g=Math.round(lerp(a.g,b.g,1-t%1)),b=Math.round(lerp(a.b,b.b,1-t%1));if(color.sky=rgbToHex(r,g,b),!(Math.floor(progress)>=7&&9!=Math.floor(progress))){var skyold=color.sky,caveFade=.02;if(progress>2&&progress%2<1-caveFade&&(color.sky="#222222"),progress%2>2-caveFade){a=hexToRgb(color.sky),b=hexToRgb("#222222");var val=1-1*(2-progress%2)/caveFade,r=Math.round(lerp(a.r,b.r,val)),g=Math.round(lerp(a.g,b.g,val)),b=Math.round(lerp(a.b,b.b,val));color.sky=rgbToHex(r,g,b)}else if(progress>2&&progress%2>1-caveFade){a=hexToRgb("#222222"),b=hexToRgb(color.sky);var val=1-1*(1-progress%2)/caveFade,r=Math.round(lerp(a.r,b.r,val)),g=Math.round(lerp(a.g,b.g,val)),b=Math.round(lerp(a.b,b.b,val));color.sky=rgbToHex(r,g,b)}if((progress>2&&progress%2>1||progress<2)&&progress%2<2-caveFade&&(color.sky=skyold,color.ground=colordef.ground),progress>2&&progress%2<=1?(color.ground="#555555",cloudsVisible=!1,newlyVisible=!1,rabbitElegible=!1):rabbitElegible=!0,progress%2>2-caveFade){a=hexToRgb(colordef.ground),b=hexToRgb("#555555");var val=1-1*(2-progress%2)/caveFade,r=Math.round(lerp(a.r,b.r,val)),g=Math.round(lerp(a.g,b.g,val)),b=Math.round(lerp(a.b,b.b,val));color.ground=rgbToHex(r,g,b)}else if(progress>2&&progress%2>1-caveFade){b=hexToRgb(colordef.ground),a=hexToRgb("#555555");var val=1-1*(1-progress%2)/caveFade,r=Math.round(lerp(a.r,b.r,val)),g=Math.round(lerp(a.g,b.g,val)),b=Math.round(lerp(a.b,b.b,val));newlyVisible=!0,cloudsVisible=!0,color.ground=rgbToHex(r,g,b)}progress>2&&progress%2>1&&progress%2<2-caveFade&&(color.ground=colordef.ground,rabbitElegible=!0,cloudsVisible=!0,newlyVisible=!1)}}function getCookie(cname){for(var name=cname+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(name))return c.substring(name.length,c.length)}return""}function drawObstacles(){for(var m=w/50/2,d=m-1,px=-xscroll,i1=Math.floor((px+d)/(2*rarity)),i=0;i<obstacles.length;i++)o=obstacles[i],Math.abs(o.position[0]-px)<=m&&(ctx.beginPath(),ctx.arc(o.position[0],o.position[1],.5,0,2*Math.PI,!1),ctx.stroke(),ctx.strokeStyle="#ffffff",ctx.beginPath(),ctx.arc(o.position[0],o.position[1],.7,0,2*Math.PI,!1),ctx.stroke());try{canvas_arrow(px+d-.3,obstacles[i1].position[1],px+d+.5,obstacles[i1].position[1])}catch(e){}ctx.strokeStyle="#000000"}function drawpogo(){if(ctx.fillStyle=color.stick,rabbitMode||(drawbox(pogo.stick),colorful&&ctx.fill()),rabbitMode){var ps=pogo.stick;ctx.save(),ctx.translate(ps.body.position[0],ps.body.position[1]),ctx.rotate(ps.body.angle+Math.PI),ctx.drawImage(roboBunnyLegs,4*-ps.shape.width,.5*-ps.shape.height,2,118/52),ctx.restore()}if(rabbitMode||(ctx.fillStyle=color.body,drawbox(pogo.frame),colorful&&ctx.fill()),rabbitMode){var pf=pogo.frame;ctx.save(),ctx.translate(pf.body.position[0],pf.body.position[1]),ctx.rotate(pf.body.angle+Math.PI),dragon?ctx.drawImage(roboBunny,3.5*-pf.shape.width,-pf.shape.height-0,3,6065/1861):ctx.drawImage(roboBunny,2*-pf.shape.width,-pf.shape.height-1,2,152/41),ctx.restore()}if(opponentScore!=-1){var scoreDiff=scoreVal-opponentScore;if(Math.abs(scoreDiff)<w/50/2+1){ctx.fillStyle=color.stick;var exactFrame=score-Math.floor(w/50/2)+pogo.frame.body.position[0],exactStick=score-Math.floor(w/50/2)+pogo.stick.body.position[0];drawboxGhost({x:opponentScoreData.scoreStick-exactStick+pogo.stick.body.position[0],y:opponentCoords.stick.y,angle:opponentScoreData.angle.stick,width:opponentScoreData.size.stick.width,height:opponentScoreData.size.stick.height}),colorful&&ctx.fill(),ctx.fillStyle=color.body,drawboxGhost({x:opponentScoreData.scoreFrame-exactFrame+pogo.frame.body.position[0],y:opponentCoords.frame.y,angle:opponentScoreData.angle.frame,width:opponentScoreData.size.frame.width,height:opponentScoreData.size.frame.height}),colorful&&ctx.fill()}}}function drawbox(obj){ctx.beginPath();var normpos=obj.body.position[0],x=normpos,y=obj.body.interpolatedPosition[1];ctx.save(),ctx.translate(x,y),ctx.rotate(obj.body.angle),ctx.rect(-obj.shape.width/2,-obj.shape.height/2,obj.shape.width,obj.shape.height),ctx.stroke(),ctx.restore()}function drawboxGhost(obj){ctx.beginPath();var x=obj.x,y=obj.y;ctx.save(),ctx.opacity="0.5",ctx.translate(x,y),ctx.rotate(obj.angle),ctx.rect(-obj.width/2,-obj.height/2,obj.width,obj.height),ctx.stroke(),ctx.opacity="1",ctx.restore()}function drawObstacles1(s){for(var closeO=[],i=0;i<s.o.length;i++){var d=Math.abs(pogo.frame.body.position[0]-s.o[i].position[0]);d<w/50/2+1&&closeO.push(s.o[i])}ctx.strokeStyle="white";for(var i=0;i<closeO.length;i++)ctx.beginPath(),ctx.arc(closeO[i].position[0],closeO[i].position[1],.485,0,2*Math.PI,!1),ctx.stroke();ctx.strokeStyle="orange";for(var i=0;i<closeO.length;i++)ctx.beginPath(),ctx.arc(closeO[i].position[0],closeO[i].position[1],.525,0,2*Math.PI,!1),ctx.stroke();ctx.strokeStyle="purple";for(var i=0;i<closeO.length;i++)ctx.beginPath(),ctx.arc(closeO[i].position[0],closeO[i].position[1]+coinDist,.3,0,2*Math.PI,!1),ctx.stroke();ctx.strokeStyle="black";for(var i=0;i<closeO.length;i++)ctx.beginPath(),ctx.arc(closeO[i].position[0],closeO[i].position[1],.5,0,2*Math.PI,!1),ctx.stroke()}function canvas_arrow(fromx,fromy,tox,toy){var headlen=.5,angle=Math.atan2(toy-fromy,tox-fromx);ctx.beginPath(),ctx.moveTo(fromx,fromy),ctx.lineTo(tox,toy),ctx.lineTo(tox-headlen*Math.cos(angle-Math.PI/6),toy-headlen*Math.sin(angle-Math.PI/6)),ctx.moveTo(tox,toy),ctx.lineTo(tox-headlen*Math.cos(angle+Math.PI/6),toy-headlen*Math.sin(angle+Math.PI/6)),ctx.stroke()}function rendertut(){if(pogo.frame.body.position[0]<0&&(gameOver=!0,leftplay=!1,pogo.frame.body.position[0]=Math.max(pogo.frame.body.position[0],-2),pogo.frame.body.position[1]=Math.max(pogo.frame.body.position[1],-5)),ctx.clearRect(0,0,w,h),colorful?ctx.fillStyle=color.sky:ctx.fillStyle="#FFFFFF",ctx.fillRect(0,0,w,h),ctx.fill(),ctx.save(),xscroll=-pogo.frame.body.position[0],v=pogo.frame.body.position[1]-yscroll,Math.abs(v)>.35?lerpval=.015:lerpval=.01,v<-.2&&(lerpval=.0325),yscroll=v*lerpval+yscroll,ctx.translate(w/2,h/2),ctx.scale(50,-50),ctx.translate(xscroll,-yscroll),ctx.strokeStyle="#000000",drawpogo(),tutlvl>0){var y=heightfield.body.position[1],x=heightfield.body.position[0];ctx.beginPath(),ctx.moveTo(x,-h/50);var px=pogo.frame.body.position[0],i=0;for(var d in data){var x1=i*heightfield.shape.elementWidth;if(x1>=px-w/50/2-1&&ctx.lineTo(x+x1,y+data[i]),x1>px+w/50/2+2)break;i+=1}ctx.lineTo(x+data.length-1*heightfield.shape.elementWidth,-h/50),ctx.closePath(),ctx.fillStyle=color.ground,colorful&&ctx.fill(),ctx.stroke(),tutlvl>1&&drawObstacles()}ctx.restore(),drawControls(),tutlvl>1&&(ctx.font="20px Comic Sans MS",ctx.fillStyle="#555555",ctx.textAlign="center",ctx.fillText("Next obstacle: "+Math.floor(2*rarity-pogo.frame.body.position[0]%(2*rarity)),w-100,h-20)),tutlvl>0&&(gameOver?(ctx.font="30px Comic Sans MS",ctx.fillStyle="red",ctx.textAlign="center",pendingquit||(score=Math.round(pogo.frame.body.position[0]),pendingquit=!0,restarttimer=setTimeout(function(){gameOver=!1,pendingquit=!1,inittut()},3e3)),ctx.fillText("Score: "+score,canvas.width/2,canvas.height/2-40)):(ctx.font="16px Comic Sans MS",ctx.fillStyle="black",ctx.textAlign="left",score=Math.round(pogo.frame.body.position[0]),ctx.fillText("Score: "+score,10,20)))}function tutnext(){if(tutlvl++,gameOver&&(leftplay=!0),1==tutlvl&&(document.getElementById("lvl0").style.display="none",document.getElementById("lvl1").style.display="block"),2==tutlvl&&(document.getElementById("nexttxt").style.display="none",document.getElementById("lvl1").style.display="none",document.getElementById("lvl2").style.display="block"),tutlvl>2){document.getElementById("tuthelp").style.display="none",data=[],noise.seed(10*Math.random()),data.push(0);for(var i=0;i<numDataPoints;i++){v=i/10;var value=noise.simplex2(v,0);noise.perlin2(v,0);data.push(1.75*value)}return tutlvl=0,void gohome()}inittut()}function inittut(){document.getElementById("tutnextb").style.display="inline",lives=3,tutlvl>1&&resetHealth(),gameOver=!1,pendingquit=!1,world=new p2.World({gravity:[0,-7]}),0==tutlvl&&(world.gravity=[0,0]),data=[],noise.seed(10*Math.random()),data.push(0);for(var i=0;i<numDataPoints;i++){v=i/10;var value=noise.simplex2(v,0);noise.perlin2(v,0);data.push(1*value)}world.defaultContactMaterial.friction=100,world.defaultContactMaterial.restitution=.1,tut.tutlvl0(),tutlvl>0&&(tut.tutlvl1(),tutlvl>1&&tut.tutlvl2()),tutlvl>0?world.on("beginContact",function(event){if(event.bodyA==pogo.frame.body||event.bodyB==pogo.frame.body){var h=event.bodyA==heightfield.body||event.bodyB==heightfield.body;h?(lives=0,loseHeart()):(lives-=1,loseHeart()),(lives<=0||h)&&(gameOver=!0,leftplay=!1)}}):world.on("beginContact",function(event){return leftplay=!1,!0})}var twistval=2.6,fixedjoy=!0,jloc=new Object,tiltoffset=0,orientationData,keyboard=!1,keysensitivityval=100,keys={left:37,right:39,up:38,space:32},keyspressed={left:!1,right:!1,up:!1,space:!1},mousedrag=!1,currentmouse=null,lastmouse={x:null,y:null},debugtesting=!1,coinsCnt=0,gameOver=!1,pendingquit=!1,pause=!1,home=!0,restarttimer=null,multiplayer=!1,lives=3,tutorialm=!1,leftplay=!1,topscore=0,score=0,world,pogo,firstrh=!0,angularVelocity=-.25,opponentScore=-1,FRAME=1,STICK=2,GROUND=4,OBSTACLE=8,controlMode={KEYBOARD:0,GYRO:1,JOYSTICK:2,UNFIXED_JOYSTICK:3,modeRaw:this.KEYBOARD,mode:this.modeRaw,modeName:"Keyboard",get modeName(){switch(this.modeRaw){case this.KEYBOARD:return"Keyboard";case this.GYRO:return"Gyro";case this.JOYSTICK:return"Joystick";case this.UNFIXED_JOYSTICK:return"Unfixed Joystick";default:return"Undefined"}return"Test"},set mode(val){return this.modeRaw=val,$(".dropdowntitle").html(this.modeName+' <span class="caret">'),$(".dropdowntitle").val(this.modeName),val},get mode(){return this.modeRaw},get isJoystickVariant(){return this.modeRaw==this.JOYSTICK||this.modeRaw==this.UNFIXED_JOYSTICK}};controlMode.mode=controlMode.KEYBOARD;var nojoystick=!1,heightfield,oldlabel="",stiffness=350,damping=.5,restLength=.25,rarity=10,pogomaterial=new p2.Material,icematerial=new p2.Material,sectionA={d:null,h:null,o:null},sectionB={d:null,h:null,o:null},multi=!1,conn,peerkey="k21h7zsvzls4te29",peer,seedVal,firstData=!0,opponentCoords={frame:{y:0},stick:{y:0}},opponentScoreData={scoreFrame:0,scoreStick:0,angle:{frame:0,stick:0},size:{frame:{height:0,width:0},stick:{height:0,width:0}}},secnum=0,secwidth=null,padding=2,coinDist=1,caveDepth=4,caveHeight=5,lvlCnt=10,lvl1length=100,addedDebug=!1,test=function(){},canvas,ctx,w,h,progress=0,colorful=!0,scoreVal=0,colordef={sky:"#4d79ff",skyday:"#4d79ff",skynight:"#241c52",ground:"#00b300",body:"#ed00ed",stick:"#ff66ff"},filtersEnabled=!0,color=JSON.parse(JSON.stringify(colordef)),currentRainAmnt=0,rainAmnt=4,addedClouds=!1,cloudSpeed=1,cloudSize=100,cloudSpeedDef=1.5,cloudSpeedMin=.2,cloudCnt=5,newlyVisible=!0,justNowVisible=!0,splashSize=5,offscreenCanvas=document.createElement("canvas");offscreenCanvas.width=300,offscreenCanvas.height=300;var offscreenContext=offscreenCanvas.getContext("2d"),clouds=[],obstacleCanvas=document.createElement("canvas");obstacleCanvas.width=4,obstacleCanvas.height=6;var obstacleContext=obstacleCanvas.getContext("2d");speed=300;var lastTime,maxSubSteps=5,fixedDeltaTime=1/speed,cloudsDark=!1,xscroll=0,yscroll=0,endscore=0,fullPause=!1,sendData=function(svalue){multiplayer&&conn.send(svalue)},alreadyWelcomed=!1,gyro=!1,cloudsVisible=!0,rabbitElegible=!1,newtopscore=!1,roboBunny=document.getElementById("roboBunnyImg"),roboBunnyLegs=document.getElementById("roboBunnyImgLegs"),rabbitMode=!1,dragon=!1,tutlvl=0,numDataPoints=500,heightfield=new Object,data=[],obstacles=[],tut={tutlvl0:function(){pogo={stick:new Object,frame:new Object,spring:null},pogo.stick.shape=new p2.Box({width:.25,height:1.6}),pogo.stick.body=new p2.Body({mass:.25,position:[0,2.75],angularVelocity:angularVelocity,velocity:[5,0]}),pogo.frame.shape=new p2.Box({width:.5,height:1.5,sensor:!0}),pogo.frame.body=new p2.Body({mass:3,position:[0,3],angularVelocity:angularVelocity,velocity:[5,0]}),pogo.frame.body.addShape(pogo.frame.shape),pogo.stick.body.addShape(pogo.stick.shape),world.addBody(pogo.frame.body),world.addBody(pogo.stick.body);var c1=new p2.PrismaticConstraint(pogo.frame.body,pogo.stick.body,{localAnchorA:[0,.5],localAnchorB:[0,.5],localAxisA:[0,1],disableRotationalLock:!0}),c2=new p2.PrismaticConstraint(pogo.frame.body,pogo.stick.body,{localAnchorA:[0,0],localAnchorB:[0,1],localAxisA:[0,1],disableRotationalLock:!0});c1.setLimits(-1,-.4),world.addConstraint(c2),world.addConstraint(c1),pogo.spring=new p2.LinearSpring(pogo.frame.body,pogo.stick.body,{restLength:restLength,stiffness:stiffness,damping:damping,localAnchorA:[0,0],localAnchorB:[0,0]}),world.addSpring(pogo.spring),pogo.frame.shape.collisionGroup=FRAME,pogo.stick.shape.collisionGroup=STICK,pogo.frame.shape.collisionMask=~STICK,pogo.stick.shape.collisionMask=~FRAME},tutlvl1:function(){heightfield.shape=new p2.Heightfield({heights:data,elementWidth:2}),heightfield.body=new p2.Body({position:[-1,-1]}),heightfield.body.addShape(heightfield.shape),world.addBody(heightfield.body),heightfield.shape.collisionGroup=GROUND,heightfield.shape.collisionMask=-1},tutlvl2:function(){var OBSTACLE=8;obstacles=[];for(var i=5;i<200;i++)if(i%rarity==0){Math.random()>.5?y=data[i]+2*Math.random():y=data[i]+5-2*Math.random();var circleShape=new p2.Circle({radius:.5}),circleBody=new p2.Body({mass:1,position:[2*i,y],fixedX:!0,fixedY:!0});circleBody.addShape(circleShape),circleShape.collisionGroup=OBSTACLE,obstacles.push(circleBody),world.addBody(circleBody)}}};