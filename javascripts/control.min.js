function initControls(){jloc={x:3*w/4,y:3*h/4},window.addEventListener("keydown",keydown,!1),window.addEventListener("keyup",keyup,!1),window.addEventListener("keypress",keypress,!1),canvas.onmousedown=onmousedown,canvas.addEventListener("touchstart",ontouchstart,!1),canvas.addEventListener("touchmove",ontouchmove,!1),canvas.addEventListener("touchend",ontouchend,!1),tiltoffset=window.screen.orientation.angle,console.log("Offset: "),console.log(window.screen.orientation.angle)}function handleOrientation(e){var o=-e.alpha-tiltoffset;console.log(o),o=2*Math.PI*o/360;var t=getDifference(o,pogo.frame.body.angle);pogo.frame.body.angularVelocity=3*t}function ontouchstart(e){if(e.preventDefault(),nojoystick)return pogo.spring.restLength=1.25,void pogo.spring.applyForce();pogo.spring.restLength=.25,pogo.spring.applyForce(),currentmouse={clientX:e.touches[0].clientX,clientY:e.touches[0].clientY};var o=Math.atan2(currentmouse.clientX-lastmouse.x,currentmouse.clientY-lastmouse.y);pogo.frame.body.angularVelocity=3*(o-pogo.frame.body.angle)}function ontouchmove(e){nojoystick||(currentmouse={clientX:e.touches[0].clientX,clientY:e.touches[0].clientY},e.preventDefault(),null!=lastmouse.x?(lastmouse.x!=e.touches[0].clientX,a=lastmouse.x-e.touches[0].clientX,b=lastmouse.y-e.touches[0].clientY,reacttocontrols()):lastmouse=fixedjoy?{x:jloc.x,y:jloc.y}:{x:e.touches[0].clientX,y:e.touches[0].clientY},mousedrag=!0)}function ontouchend(e){return nojoystick?(pogo.spring.restLength=.25,void pogo.spring.applyForce()):(currentmouse=null,mousedrag=!1,lastmouse={x:null,y:null},pogo.frame.body.angularVelocity=0,pogo.spring.restLength=1.25,void pogo.spring.applyForce())}function onmousedown(){pogo.spring.restLength=.25,pogo.spring.applyForce(),nojoystick||(document.onmousemove=function(e){currentmouse=e,null!=lastmouse.x?(lastmouse.x!=e.clientX,a=lastmouse.x-e.clientX,b=lastmouse.y-e.clientY,reacttocontrols()):lastmouse=fixedjoy?{x:jloc.x,y:jloc.y}:{x:e.clientX,y:e.clientY},mousedrag=!0}),this.onmouseup=function(){document.onmousemove=null,currentmouse=null,mousedrag=!1,lastmouse={x:null,y:null},pogo.frame.body.angularVelocity=0,pogo.spring.restLength=1.25,pogo.spring.applyForce()}}function reacttocontrols(){var e=Math.atan2(currentmouse.clientX-lastmouse.x,currentmouse.clientY-lastmouse.y),o=getDifference(e,pogo.frame.body.angle);pogo.frame.body.angularVelocity=3*o}function getDifference(e,o){var t=e-o;return t=function(e,o){return e-Math.floor(e/o)*o}(t+Math.PI,2*Math.PI),t-=Math.PI}function keydown(e){[32,37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault(),e.keyCode!=keys.up&&e.keyCode!=keys.space||(pogo.spring.restLength=1.25,pogo.spring.applyForce()),e.keyCode==keys.left&&(pogo.frame.body.angularVelocity=+twistval),e.keyCode==keys.right&&(pogo.frame.body.angularVelocity=-twistval)}function keyup(e){e.keyCode!=keys.up&&e.keyCode!=keys.space||(pogo.spring.restLength=.25,pogo.spring.applyForce()),e.keyCode!=keys.left&&e.keyCode!=keys.right||(pogo.frame.body.angularVelocity=0)}function keypress(e){[32,37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault(),e.keyCode==keys.left&&(pogo.frame.body.angularVelocity=twistval),e.keyCode==keys.right&&(pogo.frame.body.angularVelocity=-twistval)}var twistval=3.5,fixedjoy=!0,jloc=new Object,tiltoffset=0,keys={left:37,right:39,up:38,space:32},mousedrag=!1,currentmouse=null,lastmouse={x:null,y:null};