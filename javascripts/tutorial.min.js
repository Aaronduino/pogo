function rendertut(){if(pogo.frame.body.position[0]<0&&(gameOver=!0,leftplay=!1,pogo.frame.body.position[0]=Math.max(pogo.frame.body.position[0],-2),pogo.frame.body.position[1]=Math.max(pogo.frame.body.position[1],-5)),ctx.clearRect(0,0,w,h),colorful?ctx.fillStyle=color.sky:ctx.fillStyle="#FFFFFF",ctx.fillRect(0,0,w,h),ctx.fill(),ctx.save(),xscroll=-pogo.frame.body.position[0],v=pogo.frame.body.position[1]-yscroll,Math.abs(v)>.35?lerpval=.015:lerpval=.01,v<-.2&&(lerpval=.0325),yscroll=v*lerpval+yscroll,ctx.translate(w/2,h/2),ctx.scale(50,-50),ctx.translate(xscroll,-yscroll),ctx.strokeStyle="#000000",drawpogo(),tutlvl>0){var t=heightfield.body.position[1],o=heightfield.body.position[0];ctx.beginPath(),ctx.moveTo(o,-h/50);var e=pogo.frame.body.position[0],l=0;for(var a in data){var i=l*heightfield.shape.elementWidth;if(i>=e-w/50/2-1&&ctx.lineTo(o+i,t+data[l]),i>e+w/50/2+2)break;l+=1}ctx.lineTo(o+data.length-1*heightfield.shape.elementWidth,-h/50),ctx.closePath(),ctx.fillStyle=color.ground,colorful&&ctx.fill(),ctx.stroke(),tutlvl>1&&drawObstacles()}ctx.restore();var n=canvas.getBoundingClientRect();if(ctx.save(),fixedjoy){var d=Math.round((jloc.x-n.left)/(n.right-n.left)*canvas.width),s=Math.round((jloc.y-n.top)/(n.bottom-n.top)*canvas.height);ctx.beginPath(),ctx.arc(d,s,50,0,2*Math.PI,!1),ctx.globalAlpha=.5,ctx.fillStyle="#555555",ctx.fill(),ctx.beginPath(),ctx.arc(d,s,10,0,2*Math.PI,!1),ctx.globalAlpha=.7,ctx.fillStyle="#AAAAAA",ctx.fill()}if(ctx.restore(),mousedrag){var c=Math.round((lastmouse.x-n.left)/(n.right-n.left)*canvas.width),p=Math.round((lastmouse.y-n.top)/(n.bottom-n.top)*canvas.height),g=Math.round((currentmouse.clientX-n.left)/(n.right-n.left)*canvas.width),f=Math.round((currentmouse.clientY-n.top)/(n.bottom-n.top)*canvas.height);ctx.beginPath();var y=ctx.lineWidth;ctx.lineWidth=2,ctx.strokeStyle="#999999",ctx.moveTo(c,p),ctx.lineTo(g,f),ctx.stroke(),ctx.beginPath(),ctx.arc(g,f,4,0,2*Math.PI,!1),ctx.fillStyle="#999999",ctx.stroke(),ctx.fill(),ctx.lineWidth=y}tutlvl>1&&(ctx.font="20px Comic Sans MS",ctx.fillStyle="#555555",ctx.textAlign="center",ctx.fillText("Next obstacle: "+Math.floor(2*r-pogo.frame.body.position[0]%(2*r)),w-100,h-20)),tutlvl>0&&(gameOver?(ctx.font="30px Comic Sans MS",ctx.fillStyle="red",ctx.textAlign="center",pendingquit||(score=Math.round(pogo.frame.body.position[0]),pendingquit=!0,setTimeout(function(){return leftplay?void(leftplay=!1):(gameOver=!1,pendingquit=!1,void inittut())},3e3)),ctx.fillText("Score: "+score,canvas.width/2,canvas.height/2-40)):(ctx.font="16px Comic Sans MS",ctx.fillStyle="black",ctx.textAlign="left",score=Math.round(pogo.frame.body.position[0]),ctx.fillText("Score: "+score,10,20)))}function tutnext(){if(tutlvl++,gameOver&&(leftplay=!0),1==tutlvl&&(document.getElementById("lvl0").style.display="none",document.getElementById("lvl1").style.display="block"),2==tutlvl&&(document.getElementById("nexttxt").style.display="none",document.getElementById("lvl1").style.display="none",document.getElementById("lvl2").style.display="block"),tutlvl>2){document.getElementById("tuthelp").style.display="none",data=[],noise.seed(10*Math.random()),data.push(0);for(var t=0;t<numDataPoints;t++){v=t/10;var o=noise.simplex2(v,0);noise.perlin2(v,0);data.push(1.75*o)}return void gohome()}inittut()}function inittut(){document.getElementById("tutnextb").style.display="inline",lives=3,tutlvl>1&&resetHealth(),gameOver=!1,pendingquit=!1,world=new p2.World({gravity:[0,-7]}),0==tutlvl&&(world.gravity=[0,0]),data=[],noise.seed(10*Math.random()),data.push(0);for(var t=0;t<numDataPoints;t++){v=t/10;var o=noise.simplex2(v,0);noise.perlin2(v,0);data.push(1*o)}world.defaultContactMaterial.friction=100,world.defaultContactMaterial.restitution=.1,tut.tutlvl0(),tutlvl>0&&(tut.tutlvl1(),tutlvl>1&&tut.tutlvl2()),tutlvl>0?world.on("beginContact",function(t){if(t.bodyA==pogo.frame.body||t.bodyB==pogo.frame.body){var o=t.bodyA==heightfield.body||t.bodyB==heightfield.body;o?(lives=0,loseHeart()):(lives-=1,loseHeart()),(lives<=0||o)&&(gameOver=!0,leftplay=!1)}}):world.on("beginContact",function(t){return leftplay=!1,!0})}var tutlvl=0,numDataPoints=500,heightfield=new Object,data=[],obstacles=[],tut={tutlvl0:function(){pogo={stick:new Object,frame:new Object,spring:null},pogo.stick.shape=new p2.Box({width:.25,height:1.6}),pogo.stick.body=new p2.Body({mass:.25,position:[0,2.75],angularVelocity:angularVelocity,velocity:[5,0]}),pogo.frame.shape=new p2.Box({width:.5,height:1.5,sensor:!0}),pogo.frame.body=new p2.Body({mass:3,position:[0,3],angularVelocity:angularVelocity,velocity:[5,0]}),pogo.frame.body.addShape(pogo.frame.shape),pogo.stick.body.addShape(pogo.stick.shape),world.addBody(pogo.frame.body),world.addBody(pogo.stick.body);var t=new p2.PrismaticConstraint(pogo.frame.body,pogo.stick.body,{localAnchorA:[0,.5],localAnchorB:[0,.5],localAxisA:[0,1],disableRotationalLock:!0}),o=new p2.PrismaticConstraint(pogo.frame.body,pogo.stick.body,{localAnchorA:[0,0],localAnchorB:[0,1],localAxisA:[0,1],disableRotationalLock:!0});t.setLimits(-1,-.4),world.addConstraint(o),world.addConstraint(t),pogo.spring=new p2.LinearSpring(pogo.frame.body,pogo.stick.body,{restLength:restLength,stiffness:stiffness,damping:damping,localAnchorA:[0,0],localAnchorB:[0,0]}),world.addSpring(pogo.spring);var e=1,l=2;pogo.frame.shape.collisionGroup=e,pogo.stick.shape.collisionGroup=l,pogo.frame.shape.collisionMask=~l,pogo.stick.shape.collisionMask=~e},tutlvl1:function(){heightfield.shape=new p2.Heightfield({heights:data,elementWidth:2}),heightfield.body=new p2.Body({position:[-1,-1]}),heightfield.body.addShape(heightfield.shape),world.addBody(heightfield.body);var t=4;heightfield.shape.collisionGroup=t,heightfield.shape.collisionMask=-1},tutlvl2:function(){var t=8;obstacles=[];for(var o=5;o<200;o++)if(o%r==0){Math.random()>.5?y=data[o]+2*Math.random():y=data[o]+5-2*Math.random();var e=new p2.Circle({radius:.5}),l=new p2.Body({mass:1,position:[2*o,y],fixedX:!0,fixedY:!0});l.addShape(e),e.collisionGroup=t,obstacles.push(l),world.addBody(l)}}};