function updateCloud(){this.x-=this.xoffset,this.y-=this.yoffset;for(var t=0;t<this.rain.particles.length;t++)this.rain.particles[t].x-=this.xoffset,this.rain.particles[t].y-=this.yoffset;for(var t=0;t<this.rain.drops.length;t++)this.rain.drops[t].x-=this.xoffset,this.rain.drops[t].y-=this.yoffset;for(var o,e=this.rain.particles,r=this.rain.drops,t=0;o=e[t];t++){o.x+=o.velX,o.y+=o.velY+5;var c,l=0,i=o.x/50-xscroll-w/50/2;if(i>sectionB.h.body.position[0]){var a=(i-sectionB.h.body.position[0])/2;c=Math.floor(a);var n=a%2/2,s=sectionB.d[c+1]-sectionB.d[c]||0;l=50*-(sectionB.d[c]+s*n)}else{var a=(i-sectionA.h.body.position[0])/2;c=Math.floor(a);var n=2*a%2/2,s=sectionA.d[c+1]-sectionA.d[c]||0;l=50*-(sectionA.d[c]+s*n)}l+=h/2,l+=50*yscroll,l+=50,o.y>l&&(e.splice(t--,1),this.rain.splash(o.x,o.y,o.col))}for(var d,t=0;d=r[t];t++)d.x+=d.velX,d.y+=d.velY,d.radius-=.075,d.alpha>0?d.alpha-=.005:d.alpha=0,d.radius<0&&r.splice(t--,1);for(var t=currentRainAmnt;t--;){if(0!=this.idx){t=0;break}this.rain.addRaindrops(Math.floor(Math.random()*this.w),-500)}var x=this.x<-cloudSize,f=this.x>2*this.w+cloudSize;(x||f)&&(this.y=(this.h/2-20-this.h/87.5-10)*Math.random()-10,this.speed=Math.random()*(cloudSpeedDef-cloudSpeedMin)+cloudSpeedMin,x?this.x=this.w+cloudSize:this.x=-cloudSize),this.x+=this.speed*cloudSpeed}function addRaindrops(t,o,e){for(e=e||2;e--;)this.particles.push({velX:.25*Math.random(),velY:9*Math.random()+1,x:t,y:o,alpha:1,col:"hsla(200, 100%, 50%, 0.8)"})}function splash(t,o,e,r){for(r=r||splashSize;r--;)this.drops.push({velX:4*Math.random()-2,velY:Math.random()*-4,x:t,y:o,radius:.65+Math.floor(1.6*Math.random()),alpha:1,col:e})}function renderCloud(){for(var t,o=2*Math.PI,e=this.rain.particles,r=this.rain.drops,c=0;t=e[c];c++)ctx.globalAlpha=t.alpha,ctx.fillStyle=t.col,ctx.fillRect(t.x,t.y,t.velY/4,t.velY);for(var l,c=0;l=r[c];c++)ctx.globalAlpha=l.alpha,ctx.fillStyle=l.col,ctx.beginPath(),ctx.arc(l.x,l.y,l.radius,0,o),ctx.fill();ctx.shadowBlur=7,ctx.shadowColor="black",ctx.font=cloudSize+"px FontAwesome",ctx.globalAlpha="0.7",ctx.fillStyle="#ffffff",ctx.textAlign="center",ctx.fillText("",this.x-cloudSize/2,this.y),ctx.shadowBlur=0,ctx.globalAlpha="1"}function Cloud(t,o,e,r,c,l){this.idx=l,this.x=t,this.y=o,this.xoffset=0,this.yoffset=0,this.worldX=0,this.w=r,this.h=c,this.speed=e,this.update=updateCloud,this.render=renderCloud,this.rain={pieces:2,particles:[],drops:[],addRaindrops:addRaindrops,splash:splash}}function initRender(){clouds=[];for(var t=0;t<cloudCnt;t++)clouds.push(new Cloud(Math.random()*w,(h/2-20-h/87.5-10)*Math.random()-10,Math.random()*(cloudSpeedDef-cloudSpeedMin)+cloudSpeedMin,w,h,t));lastpx=w/50/2}function animate(t){pause||requestAnimationFrame(animate);var o=lastTime?(t-lastTime)/1e3:0;lastTime=t,o=Math.min(.1,o),world.step(fixedDeltaTime,o,maxSubSteps),tutorialm?rendertut():render()}function lerp(t,o,e){return(1-e)*t+e*o}function componentToHex(t){var o=t.toString(16);return 1==o.length?"0"+o:o}function rgbToHex(t,o,e){return"#"+componentToHex(t)+componentToHex(o)+componentToHex(e)}function hexToRgb(t){var o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16)}:null}function render(){var t=pogo.frame.body.position[0];t>secwidth,t-w/50/2>secwidth&&(removeSection(sectionA),removeSection(sectionB),sectionA=changenum(sectionB,0,1),sectionB=changenum(generateSection(),1,0),pogo.frame.body.position[0]-=secwidth,pogo.stick.body.position[0]-=secwidth,addSection(sectionA),addSection(sectionB),score+=secwidth),t<w/50/2&&secnum>2&&(removeSection(sectionA),removeSection(sectionB),secnum-=2,sectionB=changenum(sectionA,1,0),sectionA=generateSection(),pogo.frame.body.position[0]+=secwidth,pogo.stick.body.position[0]+=secwidth,addSection(sectionA),addSection(sectionB),score-=secwidth),pogo.frame.body.position[0]<0&&(gameOver=!0,leftplay=!1,pogo.frame.body.position[0]=Math.max(pogo.frame.body.position[0],-2),pogo.frame.body.position[1]=Math.max(pogo.frame.body.position[1],-5)),ctx.clearRect(0,0,w,h),colorful?ctx.fillStyle=color.sky:ctx.fillStyle="#FFFFFF",ctx.fillRect(0,0,w,h),ctx.fill();for(var o=50*(Math.max(pogo.frame.body.position[0],w/50/2)+xscroll)%secwidth,e=0;e<clouds.length;e++)clouds[e].xoffset=o;var r=yscroll;t>=w/50/2&&(xscroll=-pogo.frame.body.position[0]),v=pogo.frame.body.position[1]-yscroll,Math.abs(v)>.35?lerpval=.015:lerpval=.01,v<-.2&&(lerpval=.0325),yscroll=v*lerpval+yscroll;var c=distToTime(score+pogo.frame.body.position[0]-w/50/2),l=c*Math.PI-Math.PI;ctx.font="100px FontAwesome",ctx.fillStyle="#ffff00",ctx.textAlign="center",ctx.fillText("",Math.cos(l)*h/2+w/2,Math.sin(l)*h/2+50*yscroll+5*h/9),ctx.fillStyle="#ddddff",ctx.textAlign="center",ctx.fillText("",Math.cos(l+Math.PI)*h/2+w/2,Math.sin(l+Math.PI)*h/2+50*yscroll+5*h/9);var i=hexToRgb(color.skynight),a=hexToRgb(color.skyday),n=(c+.5)%2,s=a,d=i;if(n>1){var x=s;s=d,d=x}var f=Math.round(lerp(s.r,d.r,1-n%1)),p=Math.round(lerp(s.g,d.g,1-n%1)),d=Math.round(lerp(s.b,d.b,1-n%1));color.sky=rgbToHex(f,p,d);var u=color.sky,g=.025;if(c>2&&c%2<1-g&&(color.sky="#222222"),c%2>2-g){s=hexToRgb(color.sky),d=hexToRgb("#222222");var y=1-1*(2-c%2)/g,f=Math.round(lerp(s.r,d.r,y)),p=Math.round(lerp(s.g,d.g,y)),d=Math.round(lerp(s.b,d.b,y));color.sky=rgbToHex(f,p,d)}if(c>2&&c%2>1-g){d=hexToRgb(color.sky),s=hexToRgb("#222222");var y=1-1*(1-c%2)/g,f=Math.round(lerp(s.r,d.r,y)),p=Math.round(lerp(s.g,d.g,y)),d=Math.round(lerp(s.b,d.b,y));color.sky=rgbToHex(f,p,d)}if((c>2&&c%2>1||c<2)&&c%2<2-g&&(color.sky=u,color.ground=colordef.ground),c>2&&c%2<=1&&(color.ground="#222222"),c%2>2-g){s=hexToRgb(colordef.ground),d=hexToRgb("#222222");var y=1-1*(2-c%2)/g,f=Math.round(lerp(s.r,d.r,y)),p=Math.round(lerp(s.g,d.g,y)),d=Math.round(lerp(s.b,d.b,y));color.ground=rgbToHex(f,p,d)}if(c>2&&c%2>1-g){d=hexToRgb(colordef.ground),s=hexToRgb("#555555");var y=1-1*(1-c%2)/g,f=Math.round(lerp(s.r,d.r,y)),p=Math.round(lerp(s.g,d.g,y)),d=Math.round(lerp(s.b,d.b,y));color.ground=rgbToHex(f,p,d)}if(c>2&&c%2>1&&c%2<2-g&&(color.ground=colordef.ground),!addedClouds&&c>3){for(var e=0;e<cloudCnt;e++)clouds.push(new Cloud(Math.random()*w,(h/2-20-h/87.5-10)*Math.random()-10,Math.random()*(cloudSpeedDef-cloudSpeedMin)+cloudSpeedMin,w,h,e+cloudCnt));addedClouds=!0}c>3&&(currentRainAmnt=c%2>1?rainAmnt:0),ctx.save(),ctx.translate(w/2,h/2),ctx.scale(50,-50);for(var e=0;e<clouds.length;e++)clouds[e].yoffset=50*-(yscroll-r);ctx.translate(xscroll,-yscroll),ctx.strokeStyle="#000000",drawpogo();var b=-1,m=-1;ctx.beginPath(),ctx.moveTo(b,-h/50*7/4);for(var t=-xscroll,M=sectionA.d.slice(0,-1).concat(sectionB.d),e=0;e<M.length;e++){var S=2*e;if(S>=t-w/50/2-1&&ctx.lineTo(b+S,m+M[e]),S>t+w/50/2+2)break}ctx.lineTo(b+2*M.length-2,-h/50*7/4),ctx.closePath(),ctx.fillStyle=color.ground,colorful&&ctx.fill(),ctx.stroke();var T=null!=sectionA.h1,k=null!=sectionB.h1;if(ctx.fillStyle="#555555",T){ctx.beginPath();var A=sectionA.h1.body.position,P=sectionA.h1verts;ctx.moveTo(P[0][0]+A[0],P[0][1]+A[1]);for(var e=1;e<P.length-1;e++){var S=2*e;ctx.lineTo(A[0]+P[e][0],A[1]+P[e][1])}ctx.lineTo(P[P.length-1][0]+A[0],P[P.length-1][1]+A[1]),ctx.closePath(),colorful&&ctx.fill(),ctx.stroke()}if(k){ctx.beginPath();var A=sectionB.h1.body.position,P=sectionB.h1verts;ctx.moveTo(P[0][0]+A[0],P[0][1]+A[1]);for(var e=1;e<P.length-1;e++){var S=2*e;ctx.lineTo(A[0]+P[e][0],A[1]+P[e][1])}ctx.lineTo(P[P.length-1][0]+A[0],P[P.length-1][1]+A[1]),ctx.closePath(),colorful&&ctx.fill(),ctx.stroke()}ctx.restore();for(var e=0;e<clouds.length;e++)clouds[e].update(),clouds[e].render();ctx.save(),ctx.translate(w/2,h/2),ctx.scale(50,-50),ctx.translate(xscroll,-yscroll),ctx.strokeStyle="#000000",drawObstacles1(sectionA),drawObstacles1(sectionB),ctx.restore();var R=canvas.getBoundingClientRect();if(ctx.save(),fixedjoy&&!nojoystick){var C=Math.round((jloc.x-R.left)/(R.right-R.left)*canvas.width),B=Math.round((jloc.y-R.top)/(R.bottom-R.top)*canvas.height);ctx.beginPath(),ctx.arc(C,B,50,0,2*Math.PI,!1),ctx.globalAlpha=.5,ctx.fillStyle="#555555",ctx.fill(),ctx.beginPath(),ctx.arc(C,B,10,0,2*Math.PI,!1),ctx.globalAlpha=.7,ctx.fillStyle="#AAAAAA",ctx.fill()}if(ctx.restore(),mousedrag&&!nojoystick){var I=Math.round((lastmouse.x-R.left)/(R.right-R.left)*canvas.width),H=Math.round((lastmouse.y-R.top)/(R.bottom-R.top)*canvas.height),z=Math.round((currentmouse.clientX-R.left)/(R.right-R.left)*canvas.width),F=Math.round((currentmouse.clientY-R.top)/(R.bottom-R.top)*canvas.height);ctx.beginPath();var O=ctx.lineWidth;ctx.lineWidth=2,ctx.strokeStyle="#999999",ctx.moveTo(I,H),ctx.lineTo(z,F),ctx.stroke(),ctx.beginPath(),ctx.arc(z,F,4,0,2*Math.PI,!1),ctx.fillStyle="#999999",ctx.stroke(),ctx.fill(),ctx.lineWidth=O}ctx.font="20px Comic Sans MS",ctx.fillStyle="#555555",ctx.textAlign="center";var D=Math.floor((-xscroll-(c>2&&c%2<=1?4:0))%secwidth%(2*rarity));if(ctx.fillText("Next obstacle: "+(2*rarity-D),100,h-20),ctx.font="20px Comic Sans MS",ctx.fillStyle="#000000",ctx.textAlign="left",ctx.fillText("Level/Half-Days: "+c,0,60),gameOver){ctx.font="30px Comic Sans MS",ctx.fillStyle="red",ctx.textAlign="center",pendingquit||(endscore=score+Math.round(pogo.frame.body.position[0])-Math.floor(w/50/2),newtopscore=!1,endscore>topscore&&(topscore=endscore,newtopscore=!0,document.cookie="topscore="+endscore+"; expires=Tue, 19 Jan 2038 03:14:07 UTC"),pendingquit=!0,setTimeout(function(){return leftplay?void(leftplay=!1):(gameOver=!1,pendingquit=!1,void initgame())},3e3));var Y="";newtopscore&&(Y="New High Score!\n"),ctx.fillText(Y+"Score: "+endscore,canvas.width/2,canvas.height/2-40)}else ctx.font="16px Comic Sans MS",ctx.fillStyle="black",ctx.textAlign="left",ctx.fillText("High Score: "+topscore,10,20),ctx.fillText("Score: "+(score-Math.floor(w/50/2)+Math.round(pogo.frame.body.position[0])),10,36)}function getCookie(t){for(var o=t+"=",e=document.cookie.split(";"),r=0;r<e.length;r++){for(var c=e[r];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(o))return c.substring(o.length,c.length)}return""}function drawObstacles(){for(var t=w/50/2,e=t-1,r=-xscroll,c=Math.floor((r+e)/(2*rarity)),l=0;l<obstacles.length;l++)o=obstacles[l],Math.abs(o.position[0]-r)<=t&&(ctx.beginPath(),ctx.arc(o.position[0],o.position[1],.5,0,2*Math.PI,!1),ctx.stroke());canvas_arrow(r+e-.3,obstacles[c].position[1],r+e+.5,obstacles[c].position[1]),ctx.strokeStyle="#000000"}function drawpogo(){ctx.fillStyle=color.stick,drawbox(pogo.stick),colorful&&ctx.fill(),ctx.fillStyle=color.body,drawbox(pogo.frame),colorful&&ctx.fill()}function drawbox(t){ctx.beginPath();var o=t.body.interpolatedPosition[0],e=t.body.interpolatedPosition[1];ctx.save(),ctx.translate(o,e),ctx.rotate(t.body.angle),ctx.rect(-t.shape.width/2,-t.shape.height/2,t.shape.width,t.shape.height),ctx.stroke(),ctx.restore()}function drawObstacles1(t){for(var e=t.h.body.position[0]!=-1,r=w/50/2,c=r-1,l=-xscroll,i=Math.floor((l+c)/(2*rarity)),a=0;a<t.o.length;a++)o=t.o[a],Math.abs(o.position[0]-l)<=r&&(ctx.beginPath(),ctx.arc(o.position[0],o.position[1],.5,0,2*Math.PI,!1),ctx.stroke());try{if(!e){var n=sectionA.o.concat(sectionB.o);canvas_arrow(l+c-.3,n[i].position[1],l+c+.5,n[i].position[1]),ctx.strokeStyle="#000000"}}catch(s){return}}function canvas_arrow(t,o,e,r){var c=.5,l=Math.atan2(r-o,e-t);ctx.beginPath(),ctx.moveTo(t,o),ctx.lineTo(e,r),ctx.lineTo(e-c*Math.cos(l-Math.PI/6),r-c*Math.sin(l-Math.PI/6)),ctx.moveTo(e,r),ctx.lineTo(e-c*Math.cos(l+Math.PI/6),r-c*Math.sin(l+Math.PI/6)),ctx.stroke()}var canvas,ctx,w,h,colorful=!0,colordef={sky:"#4d79ff",skyday:"#4d79ff",skynight:"#241c52",ground:"#00b300",body:"#ed00ed",stick:"#ff66ff"},color={sky:"#4d79ff",skyday:"#4d79ff",skynight:"#241c52",ground:"#00b300",body:"#ed00ed",stick:"#ff66ff"},currentRainAmnt=0,rainAmnt=4,addedClouds=!1,cloudSpeed=1,cloudSize=100,cloudSpeedDef=1.5,cloudSpeedMin=.2,cloudCnt=5,splashSize=5,clouds=[];speed=300;var lastTime,maxSubSteps=5,fixedDeltaTime=1/speed,xscroll=0,yscroll=0,endscore=0,newtopscore=!1;