function getHatX(t){var o,e=0,r=t/50-xscroll-w/50/2;if(r>sectionB.h.body.position[0]){var s=(r-sectionB.h.body.position[0])/2;o=Math.floor(s);var i=s%2/2,a=sectionB.d[o+1]-sectionB.d[o]||0;e=50*-(sectionB.d[o]+a*i)}else{var s=(r-sectionA.h.body.position[0])/2;o=Math.floor(s);var i=2*s%2/2,a=sectionA.d[o+1]-sectionA.d[o]||0;e=50*-(sectionA.d[o]+a*i)}return e+=h/2,e+=50*yscroll,e+=50}function updateCloud(){for(var t=0;t<this.snow.particles.length;t++)this.snow.particles[t].x-=this.xoffset,this.snow.particles[t].y-=this.yoffset;this.snow.angle+=.01;for(var t=0;t<this.snow.mp;t++){var o=this.snow.particles[t];o.y+=Math.cos(this.snow.angle+o.d)+1+o.r/2,o.x+=2*Math.sin(this.snow.angle),0==this.idx&&5==Math.floor(distToTime(score+pogo.frame.body.position[0]-w/50/2))&&(o.x>w+5||o.x<-5||o.y>getHatX(o.x))&&(t%3>0?this.snow.particles[t]={x:Math.random()*w,y:-10,r:o.r,d:o.d}:Math.sin(this.snow.angle)>0?this.snow.particles[t]={x:-5,y:Math.random()*h,r:o.r,d:o.d}:this.snow.particles[t]={x:w+5,y:Math.random()*h,r:o.r,d:o.d})}this.x-=this.xoffset,this.y-=this.yoffset;for(var t=0;t<this.rain.particles.length;t++)this.rain.particles[t].x-=this.xoffset,this.rain.particles[t].y-=this.yoffset;for(var t=0;t<this.rain.drops.length;t++)this.rain.drops[t].x-=this.xoffset,this.rain.drops[t].y-=this.yoffset;for(var e,r=this.rain.particles,s=this.rain.drops,t=0;e=r[t];t++){e.x+=e.velX,e.y+=e.velY+5;var i=getHatX(e.x);e.y>i&&(r.splice(t--,1),this.rain.splash(e.x,e.y,e.col))}for(var a,t=0;a=s[t];t++)a.x+=a.velX,a.y+=a.velY,a.radius-=.075,a.alpha>0?a.alpha-=.005:a.alpha=0,a.radius<0&&s.splice(t--,1);for(var t=currentRainAmnt;t--;){if(0!=this.idx){t=0;break}this.rain.addRaindrops(Math.floor(Math.random()*this.w*1.5),-500)}var c=this.x<-cloudSize,n=this.x>2*this.w+cloudSize;(c||n)&&(this.y=(this.h/2-20-this.h/87.5-10)*Math.random()-10,this.speed=Math.random()*(cloudSpeedDef-cloudSpeedMin)+cloudSpeedMin,c?this.x=this.w+cloudSize:this.x=-cloudSize),this.x+=this.speed*cloudSpeed}function addRaindrops(t,o,e){for(e=e||2;e--;)this.particles.push({velX:.25*Math.random(),velY:9*Math.random()+1,x:t,y:o,alpha:1,col:"hsla(200, 100%, 50%, 0.8)"})}function splash(t,o,e,r){for(r=r||splashSize;r--;)this.drops.push({velX:4*Math.random()-2,velY:Math.random()*-4,x:t,y:o,radius:.65+Math.floor(1.6*Math.random()),alpha:1,col:e})}function renderCloud(){var t=Math.floor(distToTime(score+pogo.frame.body.position[0]-w/50/2));if(5==t){ctx.fillStyle="rgba(255, 255, 255, 0.8)",ctx.beginPath();for(var o=0;o<this.snow.mp;o++){var e=this.snow.particles[o];ctx.moveTo(e.x,e.y),ctx.arc(e.x,e.y,e.r,0,2*Math.PI,!0)}ctx.fill()}for(var r,s=2*Math.PI,i=this.rain.particles,a=this.rain.drops,o=0;r=i[o];o++)ctx.globalAlpha=r.alpha,ctx.fillStyle=r.col,ctx.fillRect(r.x,r.y,r.velY/4,r.velY);for(var c,o=0;c=a[o];o++)ctx.globalAlpha=c.alpha,ctx.fillStyle=c.col,ctx.beginPath(),ctx.arc(c.x,c.y,c.radius,0,s),ctx.fill();ctx.shadowBlur=7,ctx.shadowColor="black",ctx.font=cloudSize+"px FontAwesome",ctx.globalAlpha="0.7",ctx.fillStyle="#ffffff",ctx.textAlign="center",ctx.fillText("",this.x-cloudSize/2,this.y),ctx.shadowBlur=0,ctx.globalAlpha="1"}function Snow(){this.angle=0,this.mp=45,this.particles=[];for(var t=0;t<this.mp;t++)this.particles.push({x:Math.random()*w,y:Math.random()*h,r:4*Math.random()+1,d:Math.random()*this.mp})}function Cloud(t,o,e,r,s,i){this.idx=i,this.x=t,this.y=o,this.xoffset=0,this.yoffset=0,this.worldX=0,this.w=r,this.h=s,this.speed=e,this.update=updateCloud,this.render=renderCloud,this.rain={pieces:2,particles:[],drops:[],addRaindrops:addRaindrops,splash:splash},this.snow=new Snow}function initRender(){clouds=[];for(var t=0;t<cloudCnt;t++)clouds.push(new Cloud(Math.random()*w,(h/2-20-h/87.5-10)*Math.random()-10,Math.random()*(cloudSpeedDef-cloudSpeedMin)+cloudSpeedMin,w,h,t));lastpx=w/50/2}function animate(t){if(!pause){requestAnimationFrame(animate),keyboard&&((keyspressed.up||keyspressed.space)&&(pogo.spring.restLength=1.25,pogo.spring.applyForce()),keyspressed.left&&keyspressed.right||(keyspressed.left&&(pogo.frame.body.angularVelocity=+twistval),keyspressed.right&&(pogo.frame.body.angularVelocity=-twistval)),keyspressed.up||keyspressed.space||(pogo.spring.restLength=.25,pogo.spring.applyForce()),!keyspressed.left&&!keyspressed.right&&Math.abs(pogo.frame.body.angularVelocity)>3*twistval/4&&(pogo.frame.body.angularVelocity/=8));var o=lastTime?(t-lastTime)/1e3:0;lastTime=t,o=Math.min(.1,o),world.step(fixedDeltaTime,o,maxSubSteps),tutorialm?rendertut():render()}}function lerp(t,o,e){return(1-e)*t+e*o}function componentToHex(t){var o=t.toString(16);return 1==o.length?"0"+o:o}function rgbToHex(t,o,e){return"#"+componentToHex(t)+componentToHex(o)+componentToHex(e)}function hexToRgb(t){var o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16)}:null}function render(){if(!pause){var t=pogo.frame.body.position[0];if(t>secwidth,t-w/50/2>secwidth){removeSection(sectionA),removeSection(sectionB);for(var o=0;o<sectionA.inverts.length;o++)sectionA.inverts[o]=!1;for(var o=0;o<sectionB.inverts.length;o++)sectionB.inverts[o]=!1;for(var o=0;o<sectionA.o.length;o++){var e=sectionA.o[o];e.position[0]>sectionB.h.body.position[0]&&(sectionB.o.push(e),sectionA.o.splice(o,1),sectionB.inverts.push(!1),sectionA.inverts.splice(o,1))}sectionA=changenum(sectionB,0,1),sectionB=changenum(generateSection(),1,0),pogo.frame.body.position[0]-=secwidth,pogo.stick.body.position[0]-=secwidth,addSection(sectionA),addSection(sectionB),score+=secwidth}if(t<w/50/2&&secnum>2){removeSection(sectionA),removeSection(sectionB);for(var o=0;o<sectionA.inverts.length;o++)sectionA.inverts[o]=!sectionA.inverts[o];for(var o=0;o<sectionB.inverts.length;o++)sectionB.inverts[o]=!sectionB.inverts[o];for(var o=0;o<sectionB.o.length,!1;o++){var e=sectionB.o[o];e.position[0]<sectionB.h.body.position[0]&&(sectionA.o.push(copysec(sectionB).o[o]),sectionB.o.splice(o,1),sectionA.inverts.push(!0),sectionB.inverts.splice(o,1))}secnum-=2,sectionB=changenum(sectionA,1,0),sectionA=generateSection(),pogo.frame.body.position[0]+=secwidth,pogo.stick.body.position[0]+=secwidth,updateObstacles(),addSection(sectionA),addSection(sectionB),updateObstacles(),score-=secwidth}pogo.frame.body.position[0]<0&&(gameOver=!0,leftplay=!1,pogo.frame.body.position[0]=Math.max(pogo.frame.body.position[0],-2),pogo.frame.body.position[1]=Math.max(pogo.frame.body.position[1],-5)),ctx.clearRect(0,0,w,h),colorful?ctx.fillStyle=color.sky:ctx.fillStyle="#FFFFFF",ctx.fillRect(0,0,w,h),ctx.fill();for(var r=50*(Math.max(pogo.frame.body.position[0],w/50/2)+xscroll)%secwidth,o=0;o<clouds.length;o++)clouds[o].xoffset=r;var s=yscroll;t>=w/50/2&&(xscroll=-pogo.frame.body.position[0]),v=pogo.frame.body.position[1]-yscroll,Math.abs(v)>.35?lerpval=.015:lerpval=.01,v<-.2&&(lerpval=.0325),yscroll=v*lerpval+yscroll;var i=distToTime(score+pogo.frame.body.position[0]-w/50/2),a=i*Math.PI-Math.PI;if(ctx.font="100px FontAwesome",ctx.fillStyle="#ffff00",ctx.textAlign="center",ctx.fillText("",Math.cos(a)*h/2+w/2,Math.sin(a)*h/2+50*yscroll+5*h/9),ctx.fillStyle="#ddddff",ctx.textAlign="center",ctx.fillText("",Math.cos(a+Math.PI)*h/2+w/2,Math.sin(a+Math.PI)*h/2+50*yscroll+5*h/9),fadeColors(i),!addedClouds&&i>3){for(var o=0;o<cloudCnt;o++)clouds.push(new Cloud(Math.random()*w,(h/2-20-h/87.5-10)*Math.random()-10,Math.random()*(cloudSpeedDef-cloudSpeedMin)+cloudSpeedMin,w,h,o+cloudCnt));addedClouds=!0}i>3&&(currentRainAmnt=i<4?rainAmnt:0),ctx.save(),ctx.translate(w/2,h/2),ctx.scale(50,-50);for(var o=0;o<clouds.length;o++)clouds[o].yoffset=50*-(yscroll-s);ctx.translate(xscroll,-yscroll),ctx.strokeStyle="#000000",drawpogo();var c=-1,n=-1;ctx.beginPath(),ctx.moveTo(c,-h/50*7/4);for(var t=-xscroll,l=sectionA.d.slice(0,-1).concat(sectionB.d),o=0;o<l.length;o++){var d=2*o;if(d>=t-w/50/2-1&&ctx.lineTo(c+d,n+l[o]),d>t+w/50/2+2)break}ctx.lineTo(c+2*l.length-2,-h/50*7/4),ctx.closePath(),ctx.fillStyle=color.ground,colorful&&ctx.fill(),ctx.stroke();var p=null!=sectionA.h1,x=null!=sectionB.h1;if(ctx.fillStyle="#555555",p){ctx.beginPath();var f=sectionA.h1.body.position,u=sectionA.h1verts;ctx.moveTo(u[0][0]+f[0],u[0][1]+f[1]);for(var o=1;o<u.length-1;o++){var d=2*o;ctx.lineTo(f[0]+u[o][0],f[1]+u[o][1])}ctx.lineTo(u[u.length-1][0]+f[0],u[u.length-1][1]+f[1]),ctx.closePath(),colorful&&ctx.fill(),ctx.stroke()}if(x){ctx.beginPath();var f=sectionB.h1.body.position,u=sectionB.h1verts;ctx.moveTo(u[0][0]+f[0],u[0][1]+f[1]);for(var o=1;o<u.length-1;o++){var d=2*o;ctx.lineTo(f[0]+u[o][0],f[1]+u[o][1])}ctx.lineTo(u[u.length-1][0]+f[0],u[u.length-1][1]+f[1]),ctx.closePath(),colorful&&ctx.fill(),ctx.stroke()}ctx.restore();for(var o=0;o<clouds.length;o++)clouds[o].update(),clouds[o].render();ctx.save(),ctx.translate(w/2,h/2),ctx.scale(50,-50),ctx.translate(xscroll,-yscroll),ctx.strokeStyle="#000000",drawObstacles1(sectionA),drawObstacles1(sectionB),ctx.restore(),drawControls(),ctx.font="20px Comic Sans MS",ctx.fillStyle="#555555",ctx.textAlign="center";var g=Math.floor((-xscroll-(i>2&&i%2<=1?4:0))%secwidth%(2*rarity));if(ctx.fillText("Next obstacle: "+(2*rarity-g),100,h-20),ctx.font="20px Comic Sans MS",ctx.fillStyle="#000000",ctx.textAlign="left",ctx.fillText("Level/Half-Days: "+i,0,60),gameOver){ctx.font="30px Comic Sans MS",ctx.fillStyle="red",ctx.textAlign="center",pendingquit||(endscore=score+Math.round(pogo.frame.body.position[0])-Math.floor(w/50/2),newtopscore=!1,endscore>topscore&&(topscore=endscore,newtopscore=!0,document.cookie="topscore="+endscore+"; expires=Tue, 19 Jan 2038 03:14:07 UTC"),pendingquit=!0,setTimeout(function(){return leftplay?void(leftplay=!1):(gameOver=!1,pendingquit=!1,void initgame())},3e3));var y="";newtopscore&&(y="New High Score!\n"),ctx.fillText(y+"Score: "+endscore,w/2,h/2-40)}else ctx.font="16px Comic Sans MS",ctx.fillStyle="black",ctx.textAlign="left",ctx.fillText("High Score: "+topscore,10,20),ctx.fillText("Score: "+(score-Math.floor(w/50/2)+Math.round(pogo.frame.body.position[0])),10,36)}}function drawControls(){if(!keyboard){var t=canvas.getBoundingClientRect();if(ctx.save(),fixedjoy&&!nojoystick){var o=Math.round((jloc.x-t.left)/(t.right-t.left)*canvas.width),e=Math.round((jloc.y-t.top)/(t.bottom-t.top)*canvas.height);ctx.beginPath(),ctx.arc(o,e,50,0,2*Math.PI,!1),ctx.globalAlpha=.5,ctx.fillStyle="#555555",ctx.fill(),ctx.beginPath(),ctx.arc(o,e,10,0,2*Math.PI,!1),ctx.globalAlpha=.7,ctx.fillStyle="#AAAAAA",ctx.fill()}if(ctx.restore(),mousedrag&&!nojoystick){var r=Math.round((lastmouse.x-t.left)/(t.right-t.left)*canvas.width),s=Math.round((lastmouse.y-t.top)/(t.bottom-t.top)*canvas.height),i=Math.round((currentmouse.clientX-t.left)/(t.right-t.left)*canvas.width),a=Math.round((currentmouse.clientY-t.top)/(t.bottom-t.top)*canvas.height);ctx.beginPath();var c=ctx.lineWidth;ctx.lineWidth=2,ctx.strokeStyle="#999999",ctx.moveTo(r,s),ctx.lineTo(i,a),ctx.stroke(),ctx.beginPath(),ctx.arc(i,a,4,0,2*Math.PI,!1),ctx.fillStyle="#999999",ctx.stroke(),ctx.fill(),ctx.lineWidth=c}}}function fadeColors(t){var o=hexToRgb(color.skynight),e=hexToRgb(color.skyday),r=(t+.5)%2,s=e,i=o;if(r>1){var a=s;s=i,i=a}var c=Math.round(lerp(s.r,i.r,1-r%1)),n=Math.round(lerp(s.g,i.g,1-r%1)),i=Math.round(lerp(s.b,i.b,1-r%1));color.sky=rgbToHex(c,n,i);var l=color.sky,h=.025;if(t>2&&t%2<1-h&&(color.sky="#222222"),t%2>2-h){s=hexToRgb(color.sky),i=hexToRgb("#222222");var d=1-1*(2-t%2)/h,c=Math.round(lerp(s.r,i.r,d)),n=Math.round(lerp(s.g,i.g,d)),i=Math.round(lerp(s.b,i.b,d));color.sky=rgbToHex(c,n,i)}if(t>2&&t%2>1-h){i=hexToRgb(color.sky),s=hexToRgb("#222222");var d=1-1*(1-t%2)/h,c=Math.round(lerp(s.r,i.r,d)),n=Math.round(lerp(s.g,i.g,d)),i=Math.round(lerp(s.b,i.b,d));color.sky=rgbToHex(c,n,i)}if((t>2&&t%2>1||t<2)&&t%2<2-h&&(color.sky=l,color.ground=colordef.ground),t>2&&t%2<=1&&(color.ground="#222222"),t%2>2-h){s=hexToRgb(colordef.ground),i=hexToRgb("#222222");var d=1-1*(2-t%2)/h,c=Math.round(lerp(s.r,i.r,d)),n=Math.round(lerp(s.g,i.g,d)),i=Math.round(lerp(s.b,i.b,d));color.ground=rgbToHex(c,n,i)}if(t>2&&t%2>1-h){i=hexToRgb(colordef.ground),s=hexToRgb("#555555");var d=1-1*(1-t%2)/h,c=Math.round(lerp(s.r,i.r,d)),n=Math.round(lerp(s.g,i.g,d)),i=Math.round(lerp(s.b,i.b,d));color.ground=rgbToHex(c,n,i)}t>2&&t%2>1&&t%2<2-h&&(color.ground=colordef.ground)}function getCookie(t){for(var o=t+"=",e=document.cookie.split(";"),r=0;r<e.length;r++){for(var s=e[r];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(o))return s.substring(o.length,s.length)}return""}function drawObstacles(){for(var t=w/50/2,e=t-1,r=-xscroll,s=Math.floor((r+e)/(2*rarity)),i=0;i<obstacles.length;i++)o=obstacles[i],Math.abs(o.position[0]-r)<=t&&(ctx.beginPath(),ctx.arc(o.position[0],o.position[1],.5,0,2*Math.PI,!1),ctx.stroke());try{canvas_arrow(r+e-.3,obstacles[s].position[1],r+e+.5,obstacles[s].position[1])}catch(a){}ctx.strokeStyle="#000000"}function drawpogo(){ctx.fillStyle=color.stick,drawbox(pogo.stick),colorful&&ctx.fill(),ctx.fillStyle=color.body,drawbox(pogo.frame),colorful&&ctx.fill()}function drawbox(t){ctx.beginPath();var o=t.body.interpolatedPosition[0],e=t.body.interpolatedPosition[1];ctx.save(),ctx.translate(o,e),ctx.rotate(t.body.angle),ctx.rect(-t.shape.width/2,-t.shape.height/2,t.shape.width,t.shape.height),ctx.stroke(),ctx.restore()}function drawObstacles1(t){for(var e=t.h.body.position[0]!=-1,r=w/50/2,s=r-1,i=-xscroll,a=Math.floor((i+s)/(2*rarity)),c=0;c<t.o.length;c++)o=t.o[c],Math.abs(o.position[0]-i)<=r,ctx.beginPath(),ctx.arc(o.position[0],o.position[1],.5,0,2*Math.PI,!1),ctx.stroke();try{if(!e){var n=sectionA.o.concat(sectionB.o);canvas_arrow(i+s-.3,n[a].position[1],i+s+.5,n[a].position[1]),ctx.strokeStyle="#000000"}}catch(l){return}}function canvas_arrow(t,o,e,r){var s=.5,i=Math.atan2(r-o,e-t);ctx.beginPath(),ctx.moveTo(t,o),ctx.lineTo(e,r),ctx.lineTo(e-s*Math.cos(i-Math.PI/6),r-s*Math.sin(i-Math.PI/6)),ctx.moveTo(e,r),ctx.lineTo(e-s*Math.cos(i+Math.PI/6),r-s*Math.sin(i+Math.PI/6)),ctx.stroke()}var canvas,ctx,w,h,colorful=!0,colordef={sky:"#4d79ff",skyday:"#4d79ff",skynight:"#241c52",ground:"#00b300",body:"#ed00ed",stick:"#ff66ff"},color=Object.assign({},colordef),currentRainAmnt=0,rainAmnt=4,addedClouds=!1,cloudSpeed=1,cloudSize=100,cloudSpeedDef=1.5,cloudSpeedMin=.2,cloudCnt=5,splashSize=5,clouds=[];speed=300;var lastTime,maxSubSteps=5,fixedDeltaTime=1/speed,xscroll=0,yscroll=0,endscore=0,newtopscore=!1;