function getHatX(t){var o,e=0,i=t/50-xscroll-w/50/2;if(i>sectionB.h.body.position[0]){var s=(i-sectionB.h.body.position[0])/2;o=Math.floor(s);var r=s%2/2,n=sectionB.d[o+1]-sectionB.d[o]||0;e=50*-(sectionB.d[o]+n*r)}else{var s=(i-sectionA.h.body.position[0])/2;o=Math.floor(s);var r=2*s%2/2,n=sectionA.d[o+1]-sectionA.d[o]||0;e=50*-(sectionA.d[o]+n*r)}return e+=h/2,e+=50*yscroll,e+=50}function updateCloud(){for(var t=0;t<this.snow.particles.length;t++)this.snow.particles[t].x-=this.xoffset,this.snow.particles[t].y-=this.yoffset;this.snow.angle+=.01;for(var t=0;t<this.snow.mp;t++){var o=this.snow.particles[t];o.y+=Math.cos(this.snow.angle+o.d)+1+o.r/2,o.x+=2*Math.sin(this.snow.angle);var e=distToTime(score+pogo.frame.body.position[0]-w/50/2);if(0==this.idx&&6!=Math.floor(e)){var i=getHatX(o.x);e>6&&(i=0,i+=this.h/2,i+=50*yscroll),(o.x>w+5||o.x<-5||o.y>i)&&(t%3>0?this.snow.particles[t]={x:Math.random()*w,y:-10,r:o.r,d:o.d}:Math.sin(this.snow.angle)>0?this.snow.particles[t]={x:-5,y:Math.random()*i,r:o.r,d:o.d}:this.snow.particles[t]={x:w+5,y:Math.random()*i,r:o.r,d:o.d})}}this.x-=this.xoffset,this.y-=this.yoffset;for(var t=0;t<this.rain.particles.length;t++)this.rain.particles[t].x-=this.xoffset,this.rain.particles[t].y-=this.yoffset;for(var t=0;t<this.rain.drops.length;t++)this.rain.drops[t].x-=this.xoffset,this.rain.drops[t].y-=this.yoffset;for(var s,r=this.rain.particles,n=this.rain.drops,t=0;s=r[t];t++){s.x+=s.velX,s.y+=s.velY+5;var a=getHatX(s.x);s.y>a&&(r.splice(t--,1),this.rain.splash(s.x,s.y,s.col))}for(var c,t=0;c=n[t];t++)c.x+=c.velX,c.y+=c.velY,c.radius-=.075,c.alpha>0?c.alpha-=.005:c.alpha=0,c.radius<0&&n.splice(t--,1);for(var t=currentRainAmnt;t--;){if(0!=this.idx){t=0;break}this.rain.addRaindrops(Math.floor(Math.random()*this.w*1.5),-500)}var l=this.x<-cloudSize,h=this.x>2*this.w+cloudSize;(l||h)&&(this.y=(this.h/2-20-this.h/87.5-10)*Math.random()-10,this.speed=Math.random()*(cloudSpeedDef-cloudSpeedMin)+cloudSpeedMin,l?this.x=this.w+cloudSize:this.x=-cloudSize),this.x+=this.speed*cloudSpeed}function addRaindrops(t,o,e){for(e=e||2;e--;)this.particles.push({velX:.25*Math.random(),velY:9*Math.random()+1,x:t,y:o,alpha:1,col:"hsla(200, 100%, 50%, 0.8)"})}function splash(t,o,e,i){for(i=i||splashSize;i--;)this.drops.push({velX:4*Math.random()-2,velY:Math.random()*-4,x:t,y:o,radius:.65+Math.floor(1.6*Math.random()),alpha:1,col:e})}function renderCloud(){var t=Math.floor(distToTime(score+pogo.frame.body.position[0]-w/50/2));if(t>=5&&6!=t){ctx.fillStyle="rgba(255, 255, 255, 0.8)",ctx.beginPath();for(var o=0;o<this.snow.mp;o++){var e=this.snow.particles[o];ctx.moveTo(e.x,e.y),ctx.arc(e.x,e.y,e.r,0,2*Math.PI,!0)}ctx.fill()}for(var i,s=2*Math.PI,r=this.rain.particles,n=this.rain.drops,o=0;i=r[o];o++)ctx.globalAlpha=i.alpha,ctx.fillStyle=i.col,ctx.fillRect(i.x,i.y,i.velY/4,i.velY);for(var a,o=0;a=n[o];o++)ctx.globalAlpha=a.alpha,ctx.fillStyle=a.col,ctx.beginPath(),ctx.arc(a.x,a.y,a.radius,0,s),ctx.fill();ctx.shadowBlur=7,ctx.shadowColor="black",ctx.font=cloudSize+"px FontAwesome",ctx.globalAlpha="0.7",ctx.fillStyle="#ffffff",ctx.textAlign="center",ctx.fillText("",this.x-cloudSize/2,this.y),ctx.shadowBlur=0,ctx.globalAlpha="1"}function Snow(){this.angle=0,this.mp=45,this.particles=[];for(var t=0;t<this.mp;t++)this.particles.push({x:Math.random()*w,y:Math.random()*h,r:4*Math.random()+1,d:Math.random()*this.mp})}function Cloud(t,o,e,i,s,r){this.idx=r,this.x=t,this.y=o,this.xoffset=0,this.yoffset=0,this.worldX=0,this.w=i,this.h=s,this.speed=e,this.update=updateCloud,this.render=renderCloud,this.rain={pieces:2,particles:[],drops:[],addRaindrops:addRaindrops,splash:splash},this.snow=new Snow}function initRender(){clouds=[];for(var t=0;t<cloudCnt;t++)clouds.push(new Cloud(Math.random()*w,(h/2-20-h/87.5-10)*Math.random()-10,Math.random()*(cloudSpeedDef-cloudSpeedMin)+cloudSpeedMin,w,h,t));lastpx=w/50/2}function animate(t){if(!pause){requestAnimationFrame(animate),keyboard&&((keyspressed.up||keyspressed.space)&&(pogo.spring.restLength=1.25,pogo.spring.applyForce()),keyspressed.left&&keyspressed.right||(keyspressed.left&&(pogo.frame.body.angularVelocity=+twistval),keyspressed.right&&(pogo.frame.body.angularVelocity=-twistval)),keyspressed.up||keyspressed.space||(pogo.spring.restLength=.25,pogo.spring.applyForce()),!keyspressed.left&&!keyspressed.right&&Math.abs(pogo.frame.body.angularVelocity)>3*twistval/4&&(pogo.frame.body.angularVelocity/=8));var o=lastTime?(t-lastTime)/1e3:0;lastTime=t,o=Math.min(.1,o),world.step(fixedDeltaTime,o,maxSubSteps),tutorialm?rendertut():render()}}function lerp(t,o,e){return(1-e)*t+e*o}function componentToHex(t){var o=t.toString(16);return 1==o.length?"0"+o:o}function rgbToHex(t,o,e){return"#"+componentToHex(t)+componentToHex(o)+componentToHex(e)}function hexToRgb(t){var o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16)}:null}function render(){if(!pause){var t=pogo.frame.body.position[0];if(t>secwidth,t-w/50/2>secwidth){removeSection(sectionA),removeSection(sectionB);for(var o=0;o<sectionA.inverts.length;o++)sectionA.inverts[o]=!1;for(var o=0;o<sectionB.inverts.length;o++)sectionB.inverts[o]=!1;for(var o=0;o<sectionA.o.length;o++){var e=sectionA.o[o];e.position[0]>sectionB.h.body.position[0]&&(sectionB.o.push(e),sectionA.o.splice(o,1),sectionB.inverts.push(!1),sectionA.inverts.splice(o,1))}sectionA=changenum(sectionB,0,1),sectionB=changenum(generateSection(),1,0),pogo.frame.body.position[0]-=secwidth,pogo.stick.body.position[0]-=secwidth,addSection(sectionA),addSection(sectionB),score+=secwidth}if(t<w/50/2&&secnum>2){removeSection(sectionA),removeSection(sectionB);for(var o=0;o<sectionA.inverts.length;o++)sectionA.inverts[o]=!sectionA.inverts[o];for(var o=0;o<sectionB.inverts.length;o++)sectionB.inverts[o]=!sectionB.inverts[o];for(var o=0;o<sectionB.o.length,!1;o++){var e=sectionB.o[o];e.position[0]<sectionB.h.body.position[0]&&(sectionA.o.push(copysec(sectionB).o[o]),sectionB.o.splice(o,1),sectionA.inverts.push(!0),sectionB.inverts.splice(o,1))}secnum-=2,sectionB=changenum(sectionA,1,0),sectionA=generateSection(),pogo.frame.body.position[0]+=secwidth,pogo.stick.body.position[0]+=secwidth,updateObstacles(),addSection(sectionA),addSection(sectionB),updateObstacles(),score-=secwidth}pogo.frame.body.position[0]<0&&(gameOver=!0,leftplay=!1,pogo.frame.body.position[0]=Math.max(pogo.frame.body.position[0],-2),pogo.frame.body.position[1]=Math.max(pogo.frame.body.position[1],-5)),ctx.clearRect(0,0,w,h),colorful?ctx.fillStyle=color.sky:ctx.fillStyle="#FFFFFF",ctx.fillRect(0,0,w,h),ctx.fill();for(var i=50*(Math.max(pogo.frame.body.position[0],w/50/2)+xscroll)%secwidth,o=0;o<clouds.length;o++)clouds[o].xoffset=i;var s=yscroll;t>=w/50/2&&(xscroll=-pogo.frame.body.position[0]),v=pogo.frame.body.position[1]-yscroll,Math.abs(v)>.35?lerpval=.015:lerpval=.01,v<-.2&&(lerpval=.0325),yscroll=v*lerpval+yscroll;var r=distToTime(score+pogo.frame.body.position[0]-w/50/2),n=r*Math.PI-Math.PI;if(ctx.font="100px FontAwesome",ctx.fillStyle="#ffff00",ctx.textAlign="center",ctx.fillText("",Math.cos(n)*h/2+w/2,Math.sin(n)*h/2+50*yscroll+5*h/9),ctx.fillStyle="#ddddff",ctx.textAlign="center",ctx.fillText("",Math.cos(n+Math.PI)*h/2+w/2,Math.sin(n+Math.PI)*h/2+50*yscroll+5*h/9),fadeColors(r),!addedClouds&&r>3){for(var o=0;o<cloudCnt;o++)clouds.push(new Cloud(Math.random()*w,(h/2-20-h/87.5-10)*Math.random()-10,Math.random()*(cloudSpeedDef-cloudSpeedMin)+cloudSpeedMin,w,h,o+cloudCnt));addedClouds=!0}r>3&&(currentRainAmnt=r<4?rainAmnt:0),ctx.save(),ctx.translate(w/2,h/2),ctx.scale(50,-50);for(var o=0;o<clouds.length;o++)clouds[o].yoffset=50*-(yscroll-s);ctx.translate(xscroll,-yscroll),ctx.strokeStyle="#000000",drawpogo();var a=-1,c=-1;ctx.beginPath(),ctx.moveTo(a,-h/50*7/4);for(var t=-xscroll,l=sectionA.d.slice(0,-1).concat(sectionB.d),o=0;o<l.length;o++){var d=2*o;if(d>=t-w/50/2-1&&ctx.lineTo(a+d,c+l[o]),d>t+w/50/2+2)break}ctx.lineTo(a+2*l.length-2,-h/50*7/4),ctx.closePath(),ctx.fillStyle=color.ground,colorful&&ctx.fill(),ctx.stroke();var p=null!=sectionA.h1,f=null!=sectionB.h1;if(ctx.fillStyle="#555555",r<6.85||9==Math.floor(r)||(ctx.fillStyle="#5555FF"),p){ctx.beginPath();var x=sectionA.h1.body.position,u=sectionA.h1verts;ctx.moveTo(u[0][0]+x[0],u[0][1]+x[1]);for(var o=1;o<u.length-1;o++){var d=2*o;ctx.lineTo(x[0]+u[o][0],x[1]+u[o][1])}ctx.lineTo(u[u.length-1][0]+x[0],u[u.length-1][1]+x[1]),ctx.closePath(),colorful&&ctx.fill(),ctx.stroke()}if(f){ctx.beginPath();var x=sectionB.h1.body.position,u=sectionB.h1verts;ctx.moveTo(u[0][0]+x[0],u[0][1]+x[1]);for(var o=1;o<u.length-1;o++){var d=2*o;ctx.lineTo(x[0]+u[o][0],x[1]+u[o][1])}ctx.lineTo(u[u.length-1][0]+x[0],u[u.length-1][1]+x[1]),ctx.closePath(),colorful&&ctx.fill(),ctx.stroke()}ctx.restore();for(var o=0;o<clouds.length;o++)clouds[o].update(),clouds[o].render();ctx.save(),ctx.translate(w/2,h/2),ctx.scale(50,-50),ctx.translate(xscroll,-yscroll),ctx.strokeStyle="#000000",drawObstacles1(sectionA),drawObstacles1(sectionB);for(var g=-1,y=-1,b=!0,o=0;o<sectionA.o.length;o++)sectionA.o[o].position[0]>t+w/50/2&&(sectionA.o[o].position[0]-t<y||y==-1)&&(y=sectionA.o[o].position[0]-t,g=o);for(var o=0;o<sectionB.o.length;o++)sectionB.o[o].position[0]>t+w/50/2&&(sectionB.o[o].position[0]-t<y||y==-1)&&(y=sectionB.o[o].position[0]-t,g=o,b=!1);try{if(b)var e=sectionA.o[g];else var e=sectionB.o[g];canvas_arrow(t+w/50/2-.3-1,e.position[1],t+w/50/2+.5-1,e.position[1]),ctx.strokeStyle="#000000",ctx.stroke()}catch(m){}if(ctx.restore(),drawControls(),ctx.font="20px Comic Sans MS",ctx.fillStyle="#555555",ctx.textAlign="center",ctx.fillText("Next obstacle: "+Math.floor(y),100,h-20),ctx.font="20px Comic Sans MS",ctx.fillStyle="#000000",ctx.textAlign="left",ctx.fillText("Level/Half-Days: "+r,0,60),gameOver){ctx.font="30px Comic Sans MS",ctx.fillStyle="red",ctx.textAlign="center",pendingquit||(endscore=score+Math.round(pogo.frame.body.position[0])-Math.floor(w/50/2),newtopscore=!1,endscore>topscore&&(topscore=endscore,newtopscore=!0,document.cookie="topscore="+endscore+"; expires=Tue, 19 Jan 2038 03:14:07 UTC"),pendingquit=!0,setTimeout(function(){return leftplay?void(leftplay=!1):(gameOver=!1,pendingquit=!1,void initgame())},3e3));var M="";newtopscore&&(M="New High Score!\n"),ctx.fillText(M+"Score: "+endscore,w/2,h/2-40)}else ctx.font="16px Comic Sans MS",ctx.fillStyle="black",ctx.textAlign="left",ctx.fillText("High Score: "+topscore,10,20),ctx.fillText("Score: "+(score-Math.floor(w/50/2)+Math.round(pogo.frame.body.position[0])),10,36)}}function drawControls(){if(!keyboard){var t=canvas.getBoundingClientRect();if(ctx.save(),fixedjoy&&!nojoystick){var o=Math.round((jloc.x-t.left)/(t.right-t.left)*canvas.width),e=Math.round((jloc.y-t.top)/(t.bottom-t.top)*canvas.height);ctx.beginPath(),ctx.arc(o,e,50,0,2*Math.PI,!1),ctx.globalAlpha=.5,ctx.fillStyle="#555555",ctx.fill(),ctx.beginPath(),ctx.arc(o,e,10,0,2*Math.PI,!1),ctx.globalAlpha=.7,ctx.fillStyle="#AAAAAA",ctx.fill()}if(ctx.restore(),mousedrag&&!nojoystick){var i=Math.round((lastmouse.x-t.left)/(t.right-t.left)*canvas.width),s=Math.round((lastmouse.y-t.top)/(t.bottom-t.top)*canvas.height),r=Math.round((currentmouse.clientX-t.left)/(t.right-t.left)*canvas.width),n=Math.round((currentmouse.clientY-t.top)/(t.bottom-t.top)*canvas.height);ctx.beginPath();var a=ctx.lineWidth;ctx.lineWidth=2,ctx.strokeStyle="#999999",ctx.moveTo(i,s),ctx.lineTo(r,n),ctx.stroke(),ctx.beginPath(),ctx.arc(r,n,4,0,2*Math.PI,!1),ctx.fillStyle="#999999",ctx.stroke(),ctx.fill(),ctx.lineWidth=a}}}function fadeColors(t){var o=hexToRgb(color.skynight),e=hexToRgb(color.skyday),i=(t+.5)%2,s=e,r=o;if(i>1){var n=s;s=r,r=n}var a=Math.round(lerp(s.r,r.r,1-i%1)),c=Math.round(lerp(s.g,r.g,1-i%1)),r=Math.round(lerp(s.b,r.b,1-i%1));if(color.sky=rgbToHex(a,c,r),Math.floor(t)<7||9==Math.floor(t)){var l=color.sky,h=.025;if(t>2&&t%2<1-h&&(color.sky="#222222"),t%2>2-h){s=hexToRgb(color.sky),r=hexToRgb("#222222");var d=1-1*(2-t%2)/h,a=Math.round(lerp(s.r,r.r,d)),c=Math.round(lerp(s.g,r.g,d)),r=Math.round(lerp(s.b,r.b,d));color.sky=rgbToHex(a,c,r)}if(t>2&&t%2>1-h){r=hexToRgb(color.sky),s=hexToRgb("#222222");var d=1-1*(1-t%2)/h,a=Math.round(lerp(s.r,r.r,d)),c=Math.round(lerp(s.g,r.g,d)),r=Math.round(lerp(s.b,r.b,d));color.sky=rgbToHex(a,c,r)}if((t>2&&t%2>1||t<2)&&t%2<2-h&&(color.sky=l,color.ground=colordef.ground),t>2&&t%2<=1&&(color.ground="#222222"),t%2>2-h){s=hexToRgb(colordef.ground),r=hexToRgb("#222222");var d=1-1*(2-t%2)/h,a=Math.round(lerp(s.r,r.r,d)),c=Math.round(lerp(s.g,r.g,d)),r=Math.round(lerp(s.b,r.b,d));color.ground=rgbToHex(a,c,r)}if(t>2&&t%2>1-h){r=hexToRgb(colordef.ground),s=hexToRgb("#555555");var d=1-1*(1-t%2)/h,a=Math.round(lerp(s.r,r.r,d)),c=Math.round(lerp(s.g,r.g,d)),r=Math.round(lerp(s.b,r.b,d));color.ground=rgbToHex(a,c,r)}t>2&&t%2>1&&t%2<2-h&&(color.ground=colordef.ground)}}function getCookie(t){for(var o=t+"=",e=document.cookie.split(";"),i=0;i<e.length;i++){for(var s=e[i];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(o))return s.substring(o.length,s.length)}return""}function drawObstacles(){for(var t=w/50/2,e=t-1,i=-xscroll,s=Math.floor((i+e)/(2*rarity)),r=0;r<obstacles.length;r++)o=obstacles[r],Math.abs(o.position[0]-i)<=t&&(ctx.beginPath(),ctx.arc(o.position[0],o.position[1],.5,0,2*Math.PI,!1),ctx.stroke());try{canvas_arrow(i+e-.3,obstacles[s].position[1],i+e+.5,obstacles[s].position[1])}catch(n){}ctx.strokeStyle="#000000"}function drawpogo(){ctx.fillStyle=color.stick,drawbox(pogo.stick),colorful&&ctx.fill(),ctx.fillStyle=color.body,drawbox(pogo.frame),colorful&&ctx.fill()}function drawbox(t){ctx.beginPath();var o=t.body.interpolatedPosition[0],e=t.body.interpolatedPosition[1];ctx.save(),ctx.translate(o,e),ctx.rotate(t.body.angle),ctx.rect(-t.shape.width/2,-t.shape.height/2,t.shape.width,t.shape.height),ctx.stroke(),ctx.restore()}function drawObstacles1(t){for(var e=(t.h.body.position[0]!=-1,w/50/2),i=e-1,s=-xscroll,r=(Math.floor((s+i)/(2*rarity)),0);r<t.o.length;r++)o=t.o[r],Math.abs(o.position[0]-s)<=e,ctx.beginPath(),ctx.arc(o.position[0],o.position[1],.5,0,2*Math.PI,!1),ctx.stroke()}function canvas_arrow(t,o,e,i){var s=.5,r=Math.atan2(i-o,e-t);ctx.beginPath(),ctx.moveTo(t,o),ctx.lineTo(e,i),ctx.lineTo(e-s*Math.cos(r-Math.PI/6),i-s*Math.sin(r-Math.PI/6)),ctx.moveTo(e,i),ctx.lineTo(e-s*Math.cos(r+Math.PI/6),i-s*Math.sin(r+Math.PI/6)),ctx.stroke()}var canvas,ctx,w,h,colorful=!0,colordef={sky:"#4d79ff",skyday:"#4d79ff",skynight:"#241c52",ground:"#00b300",body:"#ed00ed",stick:"#ff66ff"},color=Object.assign({},colordef),currentRainAmnt=0,rainAmnt=4,addedClouds=!1,cloudSpeed=1,cloudSize=100,cloudSpeedDef=1.5,cloudSpeedMin=.2,cloudCnt=5,splashSize=5,clouds=[];speed=300;var lastTime,maxSubSteps=5,fixedDeltaTime=1/speed,xscroll=0,yscroll=0,endscore=0,newtopscore=!1;