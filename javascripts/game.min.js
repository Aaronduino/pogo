function fullscreen(){document.getElementById("myCanvas").style.width="100%",document.getElementById("myCanvas").style.height="100%",document.getElementById("myCanvas").width=window.innerWidth,document.getElementById("myCanvas").height=window.innerHeight}function resetHealth(){document.getElementById("health").style.animation="fadeinout 4s linear forwards";var e=document.getElementById("health");e.style.display="block";var t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),document.getElementById("health").innerHTML='<i class="fa fa-heart" aria-hidden="true"></i> <i id="h2" class="fa fa-heart" aria-hidden="true"></i> <i id="h3" class="fa fa-heart" aria-hidden="true"></i>'}function loseHeart(){document.getElementById("health").style.animation="fadeinout 4s linear forwards";var e=document.getElementById("health");e.style.display="block";var t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),2==lives&&(document.getElementById("health").innerHTML='<i class="fa fa-heart" aria-hidden="true"></i> <i id="h2" class="fa fa-heart" aria-hidden="true"></i> <i id="h3" class="fa fa-heart-o" aria-hidden="true"></i>'),1==lives&&(document.getElementById("health").innerHTML='<i class="fa fa-heart" aria-hidden="true"></i> <i id="h2" class="fa fa-heart-o" aria-hidden="true"></i> <i id="h3" class="fa fa-heart-o" aria-hidden="true"></i>'),0>=lives&&(document.getElementById("health").innerHTML='<i class="fa fa-heart-o" aria-hidden="true"></i> <i id="h2" class="fa fa-heart-o" aria-hidden="true"></i> <i id="h3" class="fa fa-heart-o" aria-hidden="true"></i>')}function init(){gameOver=!1,pendingquit=!1,window.mobileAndTabletcheck=function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e};var e=window.mobileAndTabletcheck();if(console.log("Mobile or tablet: "+e),e&&!fixedjoy&&togglefixedjoy(),mobile=e,mobile?nojoystick||joysticktoggle():(joysticktoggle(),joysticktoggle()),e){elems=document.getElementsByClassName("dtop");for(var t=0;t<elems.length;t++)elems[t].style.display="none"}canvas=document.getElementById("myCanvas"),w=canvas.width,h=canvas.height,ctx=canvas.getContext("2d"),ctx.lineWidth=.05,noise.seed(10*Math.random()),tutorialm?inittut():initgame(),initControls()}function copysec(e){for(var t=[],o=0,n=1;n<e.d.length;n++)if(n%rarity==0){var l=new p2.Circle({radius:.5,sensor:!0}),i=new p2.Body({mass:1,position:e.o[o].position,fixedX:!0,fixedY:!0});i.addShape(l),l.collisionGroup=OBSTACLE,l.collisionMask=FRAME|STICK,t.push(i),o+=1}var a=new Object;a.shape=new p2.Heightfield({heights:e.d,elementWidth:2}),a.body=new p2.Body({position:e.h.body.position}),a.shape.collisionGroup=GROUND,a.shape.collisionMask=FRAME|STICK,a.body.addShape(a.shape);var s=null;if(null!=e.h1){s=new Object,s.body=new p2.Body({position:e.h1.body.position}),s.body.fromPolygon(JSON.parse(JSON.stringify(e.h1verts)));for(var n=0;n<s.body.shapes.length;n++)s.body.shapes[n].collisionGroup=GROUND,s.body.shapes[n].collisionMask=FRAME|STICK}return{d:e.d,h:a,h1:s,h1verts:e.h1verts,o:t,od:e.od}}function changenum(e,t,o){var n=copysec(e);n.h1verts.length<1&&null!=n.h1,n.h.body.position[0]+=(t-o)*secwidth;for(var l=0;l<n.o.length;l++)n.o[l].position[0]+=(t-o)*secwidth;return null!=n.h1&&(n.h1.body.position[0]+=(t-o)*secwidth),n}function caveMouthSigmoid(e){return-2*(e/(1+Math.abs(e)))-1}function generateSection(){for(var e=[],t=[],o=!1,n=null,l=null,i=0;secwidth/2>=i;i++){var a=(i+secnum*secwidth/2)/10,s=1.75*noise.simplex2(a,0),c=distToTime(secnum*secwidth+2*i);if(c>2&&1>c%2){s/=1.75;var r=null;if(.5>=c%1){var d=c%1*4-1;r=caveMouthSigmoid(d)*caveDepth}if(c%1>.5){var d=(c-.5)%1*4-1;r=caveMouthSigmoid(-d)*caveDepth}if(s+=r,-caveDepth/2>r||o){var u=s+caveHeight;o||(n=2*i,l=u,o=!0,t.push([5,5]),t.push([0,8])),t.push([2*i-n,u-l]),i%rarity==rarity-2&&i!=secwidth/2&&(Math.random()>.5?s+=2*Math.random():t.push([2*i-n,u-l-1.5*Math.random()-1]))}}e.push(s)}var y=new Object;if(y.shape=new p2.Heightfield({heights:e,elementWidth:2}),y.body=new p2.Body({position:[-1,-1]}),y.shape.collisionGroup=GROUND,y.shape.collisionMask=FRAME|STICK,y.body.addShape(y.shape),o){t.push([t[t.length-1][0],t[t.length-1][1]+5+3]);var p=new Object;p.body=new p2.Body({position:[n-1,l-1]}),console.log(p.body.fromPolygon(JSON.parse(JSON.stringify(t)))),console.log(p.body);for(var i=0;i<p.body.shapes.length;i++)p.body.shapes[i].collisionGroup=GROUND,p.body.shapes[i].collisionMask=FRAME|STICK}for(var h=[],u=null,m=[],i=1;i<e.length;i++)if(i%rarity==0){var c=Math.floor(distToTime(secnum*secwidth+2*i));u=Math.random()>.5&&0!=c&&c>2&&1>c%2?e[i]+2*Math.random():e[i]+5-2*Math.random(),0==c&&(u+=4),c>2&&1>c%2&&(u-=10),h.push(u);var g=new p2.Circle({radius:.5,sensor:!0}),f=new p2.Body({mass:1,position:[2*i,u],fixedX:!0,fixedY:!0});f.addShape(g),g.collisionGroup=OBSTACLE,g.collisionMask=FRAME|STICK,m.push(f)}return secnum+=1,null!=p&&t.length<1&&(t=[[-1,1],[-1,0],[1,0],[1,1],[.5,.5]]),{d:e,h:y,h1:p,h1verts:t,o:m,od:h}}function addSection(e){world.addBody(e.h.body);for(var t=0;t<e.o.length;t++)world.addBody(e.o[t]);null!=e.h1&&world.addBody(e.h1.body)}function removeSection(e){world.removeBody(e.h.body);for(var t=0;t<e.o.length;t++)world.removeBody(e.o[t]);null!=e.h1&&world.removeBody(e.h1.body)}function getsecwidth(){var e=Math.ceil(w/50+padding),t=Math.ceil(e/rarity)*rarity;return t}function isEmpty(e){return!e||0===e.length}function distToTime(e){return lvlCnt*(1-Math.pow(1-1/lvlCnt,e/lvl1length))}function initgame(){initRender(),cookie=getCookie("topscore"),isEmpty(cookie)?document.cookie="topscore=0; expires=Tue, 19 Jan 2038 03:14:07 UTC;":topscore=parseInt(cookie),score=0,secnum=0,lives=3,resetHealth(),gameOver=!1,pendingquit=!1,world=new p2.World({gravity:[0,-7]}),world.defaultContactMaterial.friction=100,world.defaultContactMaterial.restitution=.1;var e=w/50/2;pogo={stick:new Object,frame:new Object,spring:null},pogo.stick.shape=new p2.Box({width:.25,height:1.6}),pogo.stick.body=new p2.Body({mass:.25,position:[e,2.75],angularVelocity:angularVelocity,velocity:[5,0]}),pogo.frame.shape=new p2.Box({width:.5,height:1.5}),pogo.frame.body=new p2.Body({mass:3,position:[e,3],angularVelocity:angularVelocity,velocity:[5,0]}),pogo.frame.body.addShape(pogo.frame.shape),pogo.stick.body.addShape(pogo.stick.shape),world.addBody(pogo.frame.body),world.addBody(pogo.stick.body);var t=new p2.PrismaticConstraint(pogo.frame.body,pogo.stick.body,{localAnchorA:[0,.5],localAnchorB:[0,.5],localAxisA:[0,1],disableRotationalLock:!0}),o=new p2.PrismaticConstraint(pogo.frame.body,pogo.stick.body,{localAnchorA:[0,0],localAnchorB:[0,1],localAxisA:[0,1],disableRotationalLock:!0});t.setLimits(-1,-.4),world.addConstraint(o),world.addConstraint(t),pogo.spring=new p2.LinearSpring(pogo.frame.body,pogo.stick.body,{restLength:restLength,stiffness:stiffness,damping:damping,localAnchorA:[0,0],localAnchorB:[0,0]}),world.addSpring(pogo.spring),secwidth=getsecwidth(),sectionA=generateSection(),sectionB=changenum(generateSection(),1,0),addSection(sectionA),addSection(sectionB),pogo.frame.shape.collisionGroup=FRAME,pogo.stick.shape.collisionGroup=STICK,pogo.frame.shape.collisionMask=GROUND|OBSTACLE,pogo.stick.shape.collisionMask=GROUND|OBSTACLE,world.on("beginContact",function(e){if(e.bodyA==pogo.frame.body||e.bodyB==pogo.frame.body){var t=e.bodyA==sectionA.h.body||e.bodyB==sectionA.h.body;t=t||e.bodyA==sectionB.h.body||e.bodyB==sectionB.h.body,t?(lives=0,loseHeart()):(lives-=1,loseHeart()),(0>=lives||t)&&(gameOver=!0,leftplay=!1)}})}function gohome(){document.getElementById("pausebutton").className="circlebutton",document.getElementById("helpbutton").className="circlebutton",document.getElementById("settingsbutton").className="circlebutton",document.getElementById("pausebutton").style.display="none",document.getElementById("helpbutton").style.display="none",document.getElementById("settingsbutton").style.display="none",document.getElementById("mainmenu").style.display="inline",document.getElementById("mainmenu").style.opacity="1",document.getElementById("myCanvas").style.display="none",document.getElementById("gamearea").style.backgroundColor="white",document.getElementById("homebutton").style.display="none",document.getElementById("tutnextb").style.display="none",document.getElementById("health").style.display="none",gameOver&&(leftplay=!0),tutorialm=!1,pause=!0}function play(){pause&&back(),document.getElementById("pausebutton").className="circlebutton",document.getElementById("helpbutton").className="circlebutton",document.getElementById("settingsbutton").className="circlebutton",document.getElementById("helpbutton").style.display="none",document.getElementById("settingsbutton").style.display="none",document.getElementById("mainmenu").style.display="none",document.getElementById("mainmenu").style.opacity="0",document.getElementById("myCanvas").style.display="inline",document.getElementById("pausebutton").innerHTML='<i class="fa fa-pause"></i>',document.getElementById("pausebutton").style.display="block",document.getElementById("myCanvas").style.opacity="1",document.getElementById("gamearea").style.backgroundColor="black",document.getElementById("homebutton").style.display="none",pause||init(),requestAnimationFrame(animate),pause=!1}function pausegame(){tutorialm||(pause?play():(pause=!0,document.getElementById("myCanvas").style.opacity="0.3",document.getElementById("pausebutton").innerHTML='<i class="fa fa-play"></i>',document.getElementById("helpbutton").style.display="inline-block",document.getElementById("settingsbutton").style.display="inline-block",document.getElementById("homebutton").style.display="inline-block",document.getElementById("pausebutton").className="circlebuttoni",document.getElementById("helpbutton").className="circlebuttoni",document.getElementById("settingsbutton").className="circlebuttoni"))}function mainbpprep(){document.getElementById("mainmenu").style.display="none",document.getElementById("mainmenu").style.opacity="0",document.getElementById("myCanvas").style.display="inline",document.getElementById("pausebutton").innerHTML='<i class="fa fa-pause"></i>',document.getElementById("pausebutton").style.display="block",document.getElementById("myCanvas").style.opacity="1",document.getElementById("gamearea").style.backgroundColor="black",init(),animate(),pause=!0,document.getElementById("myCanvas").style.opacity="0.3",document.getElementById("pausebutton").innerHTML='<i class="fa fa-play"></i>',document.getElementById("helpbutton").style.display="inline-block",document.getElementById("settingsbutton").style.display="inline-block",document.getElementById("pausebutton").className="circlebuttoni",document.getElementById("helpbutton").className="circlebuttoni",document.getElementById("settingsbutton").className="circlebuttoni"}function tutorial(){document.getElementById("mainmenu").style.display="none",document.getElementById("mainmenu").style.opacity="0",document.getElementById("myCanvas").style.display="inline",document.getElementById("myCanvas").style.opacity="1",document.getElementById("tuthelp").style.display="block",document.getElementById("tuthelp").style.opacity="1",document.getElementById("lvl0").style.display="block",document.getElementById("lvl2").style.display="none",document.getElementById("homebutton").style.display="none",document.getElementById("gamearea").style.backgroundColor="black",tutorialm=!0,pause=!1,lvl=0,init(),animate()}function help(){document.getElementById("helpbutton").style.display="none",document.getElementById("settingsbutton").style.display="none",document.getElementById("helparea").style.display="block",document.getElementById("helparea").style.opacity="1",document.getElementById("homebutton").style.display="none"}function help1(){mainbpprep(),help()}function settings(){document.getElementById("homebutton").style.display="none",document.getElementById("helpbutton").style.display="none",document.getElementById("settingsbutton").style.display="none",document.getElementById("settings").style.display="block",document.getElementById("settings").style.opacity="1"}function settings1(){mainbpprep(),settings()}function back(){document.getElementById("helpbutton").style.display="inline-block",document.getElementById("settingsbutton").style.display="inline-block",document.getElementById("homebutton").style.display="inline-block",document.getElementById("helparea").style.display="none",document.getElementById("helparea").style.opacity="0",document.getElementById("settings").style.display="none",document.getElementById("settings").style.opacity="0"}function togglefixedjoy(){fixedjoy=!fixedjoy,document.getElementById("fixedjoy").innerHTML=(fixedjoy?"Unfix":"Fix")+" joystick location",fixedjoy?(document.getElementById("unfixjoyhelp").display="none",document.getElementById("fixjoyhelp").display="inherit"):(document.getElementById("unfixjoyhelp").display="inherit",document.getElementById("fixjoyhelp").display="none")}function joysticktoggle(){mobile?(nojoystick=!nojoystick,nojoystick?window.addEventListener("deviceorientation",handleOrientation):window.removeEventListener("deviceorientation",handleOrientation),document.getElementById("joysticktoggle").innerHTML=(nojoystick?"Enable":"Disable")+" joystick"):document.getElementById("joysticktoggle").className="future"}function toggleColor(){colorful=!colorful,document.getElementById("coltoggle").innerHTML=(colorful?"Disable":"Enable")+" colors"}function updateSky(){color.sky="#"+document.getElementById("skyCP").value}function updateGround(){color.ground="#"+document.getElementById("groundCP").value}function updateBody(){color.body="#"+document.getElementById("bodyCP").value}function updateStick(){color.stick="#"+document.getElementById("stickCP").value}function resetcolors(){colorful||toggleColor(),document.getElementById("skyCP").jscolor.fromString(colordef.sky.slice(1)),document.getElementById("groundCP").jscolor.fromString(colordef.ground.slice(1)),document.getElementById("bodyCP").jscolor.fromString(colordef.body.slice(1)),document.getElementById("stickCP").jscolor.fromString(colordef.stick.slice(1)),color.sky=colordef.sky,color.ground=colordef.ground,color.body=colordef.body,color.stick=colordef.stick}function rendertut(){if(pogo.frame.body.position[0]<0&&(gameOver=!0,leftplay=!1,pogo.frame.body.position[0]=Math.max(pogo.frame.body.position[0],-2),pogo.frame.body.position[1]=Math.max(pogo.frame.body.position[1],-5)),ctx.clearRect(0,0,w,h),colorful?ctx.fillStyle=color.sky:ctx.fillStyle="#FFFFFF",ctx.fillRect(0,0,w,h),ctx.fill(),ctx.save(),xscroll=-pogo.frame.body.position[0],v=pogo.frame.body.position[1]-yscroll,Math.abs(v)>.35?lerpval=.015:lerpval=.01,v<-.2&&(lerpval=.0325),yscroll=v*lerpval+yscroll,ctx.translate(w/2,h/2),ctx.scale(50,-50),ctx.translate(xscroll,-yscroll),ctx.strokeStyle="#000000",drawpogo(),tutlvl>0){var e=heightfield.body.position[1],t=heightfield.body.position[0];ctx.beginPath(),ctx.moveTo(t,-h/50);var o=pogo.frame.body.position[0],n=0;for(var l in data){var i=n*heightfield.shape.elementWidth;if(i>=o-w/50/2-1&&ctx.lineTo(t+i,e+data[n]),i>o+w/50/2+2)break;n+=1}ctx.lineTo(t+data.length-1*heightfield.shape.elementWidth,-h/50),ctx.closePath(),ctx.fillStyle=color.ground,colorful&&ctx.fill(),ctx.stroke(),tutlvl>1&&drawObstacles()}ctx.restore();var a=canvas.getBoundingClientRect();if(ctx.save(),fixedjoy){var s=Math.round((jloc.x-a.left)/(a.right-a.left)*canvas.width),c=Math.round((jloc.y-a.top)/(a.bottom-a.top)*canvas.height);ctx.beginPath(),ctx.arc(s,c,50,0,2*Math.PI,!1),ctx.globalAlpha=.5,ctx.fillStyle="#555555",ctx.fill(),ctx.beginPath(),ctx.arc(s,c,10,0,2*Math.PI,!1),ctx.globalAlpha=.7,ctx.fillStyle="#AAAAAA",ctx.fill()}if(ctx.restore(),mousedrag){var d=Math.round((lastmouse.x-a.left)/(a.right-a.left)*canvas.width),u=Math.round((lastmouse.y-a.top)/(a.bottom-a.top)*canvas.height),y=Math.round((currentmouse.clientX-a.left)/(a.right-a.left)*canvas.width),p=Math.round((currentmouse.clientY-a.top)/(a.bottom-a.top)*canvas.height);ctx.beginPath();var m=ctx.lineWidth;ctx.lineWidth=2,ctx.strokeStyle="#999999",ctx.moveTo(d,u),ctx.lineTo(y,p),ctx.stroke(),ctx.beginPath(),ctx.arc(y,p,4,0,2*Math.PI,!1),ctx.fillStyle="#999999",ctx.stroke(),ctx.fill(),ctx.lineWidth=m}tutlvl>1&&(ctx.font="20px Comic Sans MS",ctx.fillStyle="#555555",ctx.textAlign="center",ctx.fillText("Next obstacle: "+Math.floor(2*r-pogo.frame.body.position[0]%(2*r)),w-100,h-20)),tutlvl>0&&(gameOver?(ctx.font="30px Comic Sans MS",ctx.fillStyle="red",ctx.textAlign="center",pendingquit||(score=Math.round(pogo.frame.body.position[0]),pendingquit=!0,setTimeout(function(){return leftplay?void(leftplay=!1):(gameOver=!1,pendingquit=!1,void inittut())},3e3)),ctx.fillText("Score: "+score,canvas.width/2,canvas.height/2-40)):(ctx.font="16px Comic Sans MS",ctx.fillStyle="black",ctx.textAlign="left",score=Math.round(pogo.frame.body.position[0]),ctx.fillText("Score: "+score,10,20)))}function tutnext(){if(tutlvl++,gameOver&&(leftplay=!0),1==tutlvl&&(document.getElementById("lvl0").style.display="none",document.getElementById("lvl1").style.display="block"),2==tutlvl&&(document.getElementById("nexttxt").style.display="none",document.getElementById("lvl1").style.display="none",document.getElementById("lvl2").style.display="block"),tutlvl>2){document.getElementById("tuthelp").style.display="none",data=[],noise.seed(10*Math.random()),data.push(0);for(var e=0;numDataPoints>e;e++){v=e/10;var t=noise.simplex2(v,0);noise.perlin2(v,0);data.push(1.75*t)}return void gohome()}inittut()}function inittut(){document.getElementById("tutnextb").style.display="inline",lives=3,tutlvl>1&&resetHealth(),gameOver=!1,pendingquit=!1,world=new p2.World({gravity:[0,-7]}),0==tutlvl&&(world.gravity=[0,0]),data=[],noise.seed(10*Math.random()),data.push(0);for(var e=0;numDataPoints>e;e++){v=e/10;var t=noise.simplex2(v,0);noise.perlin2(v,0);data.push(1*t)}world.defaultContactMaterial.friction=100,world.defaultContactMaterial.restitution=.1,tut.tutlvl0(),tutlvl>0&&(tut.tutlvl1(),tutlvl>1&&tut.tutlvl2()),tutlvl>0?world.on("beginContact",function(e){if(e.bodyA==pogo.frame.body||e.bodyB==pogo.frame.body){var t=e.bodyA==heightfield.body||e.bodyB==heightfield.body;t?(lives=0,loseHeart()):(lives-=1,loseHeart()),(0>=lives||t)&&(gameOver=!0,leftplay=!1)}}):world.on("beginContact",function(){return leftplay=!1,!0})}function moveCloud(){var e=this.x<-cloudSize,t=this.x>2*this.w+cloudSize;(e||t)&&(this.y=(this.h/2-20-this.h/87.5-10)*Math.random()-10,this.speed=Math.random()*(cloudSpeedDef-cloudSpeedMin)+cloudSpeedMin,e?this.x=this.w+cloudSize:this.x=-cloudSize),this.x+=this.speed*cloudSpeed}function renderCloud(){ctx.shadowBlur=7,ctx.shadowColor="black",ctx.font=cloudSize+"px FontAwesome",ctx.globalAlpha="0.7",ctx.fillStyle="#ffffff",ctx.textAlign="center",ctx.fillText("",this.x-cloudSize/2,this.y),ctx.shadowBlur=0,ctx.globalAlpha="1"}function Cloud(e,t,o,n,l){this.x=e,this.y=t,this.w=n,this.h=l,this.speed=o,this.update=moveCloud,this.render=renderCloud}function initRender(){clouds=[];for(var e=0;cloudCnt>e;e++)clouds.push(new Cloud(Math.random()*w,(h/2-20-h/87.5-10)*Math.random()-10,Math.random()*(cloudSpeedDef-cloudSpeedMin)+cloudSpeedMin,w,h));lastpx=w/50/2}function animate(e){pause||requestAnimationFrame(animate);var t=lastTime?(e-lastTime)/1e3:0;lastTime=e,t=Math.min(.1,t),world.step(fixedDeltaTime,t,maxSubSteps),tutorialm?rendertut():render()}function lerp(e,t,o){return(1-o)*e+o*t}function componentToHex(e){var t=e.toString(16);return 1==t.length?"0"+t:t}function rgbToHex(e,t,o){return"#"+componentToHex(e)+componentToHex(t)+componentToHex(o)}function hexToRgb(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function render(){var e=pogo.frame.body.position[0];e-w/50/2>secwidth&&(removeSection(sectionA),removeSection(sectionB),sectionA=changenum(sectionB,0,1),sectionB=changenum(generateSection(),1,0),pogo.frame.body.position[0]-=secwidth,pogo.stick.body.position[0]-=secwidth,addSection(sectionA),addSection(sectionB),score+=secwidth),w/50/2>e&&secnum>2&&(removeSection(sectionA),removeSection(sectionB),secnum-=2,sectionB=changenum(sectionA,1,0),sectionA=generateSection(),pogo.frame.body.position[0]+=secwidth,pogo.stick.body.position[0]+=secwidth,addSection(sectionA),addSection(sectionB),score-=secwidth),pogo.frame.body.position[0]<0&&(gameOver=!0,leftplay=!1,pogo.frame.body.position[0]=Math.max(pogo.frame.body.position[0],-2),pogo.frame.body.position[1]=Math.max(pogo.frame.body.position[1],-5)),ctx.clearRect(0,0,w,h),colorful?ctx.fillStyle=color.sky:ctx.fillStyle="#FFFFFF",ctx.fillRect(0,0,w,h),ctx.fill();for(var t=50*(Math.max(pogo.frame.body.position[0],w/50/2)+xscroll)%secwidth,o=0;o<clouds.length;o++)clouds[o].x-=t;var n=yscroll;e>=w/50/2&&(xscroll=-pogo.frame.body.position[0]),v=pogo.frame.body.position[1]-yscroll,Math.abs(v)>.35?lerpval=.015:lerpval=.01,v<-.2&&(lerpval=.0325),yscroll=v*lerpval+yscroll;var l=distToTime(score+pogo.frame.body.position[0]-w/50/2),i=l*Math.PI-Math.PI;ctx.font="100px FontAwesome",ctx.fillStyle="#ffff00",ctx.textAlign="center",ctx.fillText("",Math.cos(i)*h/2+w/2,Math.sin(i)*h/2+50*yscroll+5*h/9),ctx.fillStyle="#ddddff",ctx.textAlign="center",ctx.fillText("",Math.cos(i+Math.PI)*h/2+w/2,Math.sin(i+Math.PI)*h/2+50*yscroll+5*h/9);var a=hexToRgb(color.skynight),s=hexToRgb(color.skyday),c=(l+.5)%2,r=s,d=a;if(c>1){var u=r;r=d,d=u}var y=Math.round(lerp(r.r,d.r,1-c%1)),p=Math.round(lerp(r.g,d.g,1-c%1)),d=Math.round(lerp(r.b,d.b,1-c%1));color.sky=rgbToHex(y,p,d);var m=color.sky,g=.025;if(l>2&&1-g>l%2&&(color.sky="#222222"),l%2>2-g){r=hexToRgb(color.sky),d=hexToRgb("#222222");var f=1-1*(2-l%2)/g,y=Math.round(lerp(r.r,d.r,f)),p=Math.round(lerp(r.g,d.g,f)),d=Math.round(lerp(r.b,d.b,f));color.sky=rgbToHex(y,p,d)}if(l>2&&l%2>1-g){d=hexToRgb(color.sky),r=hexToRgb("#222222");var f=1-1*(1-l%2)/g,y=Math.round(lerp(r.r,d.r,f)),p=Math.round(lerp(r.g,d.g,f)),d=Math.round(lerp(r.b,d.b,f));color.sky=rgbToHex(y,p,d)}if((l>2&&l%2>1||2>l)&&2-g>l%2&&(color.sky=m,color.ground=colordef.ground),l>2&&1>=l%2&&(color.ground="#222222"),l%2>2-g){r=hexToRgb(colordef.ground),d=hexToRgb("#222222");var f=1-1*(2-l%2)/g,y=Math.round(lerp(r.r,d.r,f)),p=Math.round(lerp(r.g,d.g,f)),d=Math.round(lerp(r.b,d.b,f));color.ground=rgbToHex(y,p,d)}if(l>2&&l%2>1-g){d=hexToRgb(colordef.ground),r=hexToRgb("#555555");var f=1-1*(1-l%2)/g,y=Math.round(lerp(r.r,d.r,f)),p=Math.round(lerp(r.g,d.g,f)),d=Math.round(lerp(r.b,d.b,f));color.ground=rgbToHex(y,p,d)}l>2&&l%2>1&&2-g>l%2&&(color.ground=colordef.ground),ctx.save(),ctx.translate(w/2,h/2),ctx.scale(50,-50);for(var o=0;o<clouds.length;o++)clouds[o].y+=50*(yscroll-n);ctx.translate(xscroll,-yscroll),ctx.strokeStyle="#000000",drawpogo();var b=-1,x=-1;ctx.beginPath(),ctx.moveTo(b,-h/50*3/4);for(var e=-xscroll,k=sectionA.d.slice(0,-1).concat(sectionB.d),o=0;o<k.length;o++){var B=2*o;if(B>=e-w/50/2-1&&ctx.lineTo(b+B,x+k[o]),B>e+w/50/2+2)break}ctx.lineTo(b+2*k.length-2,-h/50*3/4),ctx.closePath(),ctx.fillStyle=color.ground,colorful&&ctx.fill(),ctx.stroke();var M=null!=sectionA.h1,I=null!=sectionB.h1;if(ctx.fillStyle="#555555",M){ctx.beginPath();var E=sectionA.h1.body.position,S=sectionA.h1verts;ctx.moveTo(S[0][0]+E[0],S[0][1]+E[1]);for(var o=1;o<S.length-1;o++){var B=2*o;ctx.lineTo(E[0]+S[o][0],E[1]+S[o][1])}ctx.lineTo(S[S.length-1][0]+E[0],S[S.length-1][1]+E[1]),ctx.closePath(),colorful&&ctx.fill(),ctx.stroke()}if(I){ctx.beginPath();var E=sectionB.h1.body.position,S=sectionB.h1verts;ctx.moveTo(S[0][0]+E[0],S[0][1]+E[1]);for(var o=1;o<S.length-1;o++){var B=2*o;ctx.lineTo(E[0]+S[o][0],E[1]+S[o][1])}ctx.lineTo(S[S.length-1][0]+E[0],S[S.length-1][1]+E[1]),ctx.closePath(),colorful&&ctx.fill(),ctx.stroke()}ctx.restore();for(var o=0;o<clouds.length;o++)clouds[o].update(),clouds[o].render();ctx.save(),ctx.translate(w/2,h/2),ctx.scale(50,-50),ctx.translate(xscroll,-yscroll),ctx.strokeStyle="#000000",drawObstacles1(sectionA),drawObstacles1(sectionB),ctx.restore();var C=canvas.getBoundingClientRect();if(ctx.save(),fixedjoy&&!nojoystick){var T=Math.round((jloc.x-C.left)/(C.right-C.left)*canvas.width),A=Math.round((jloc.y-C.top)/(C.bottom-C.top)*canvas.height);ctx.beginPath(),ctx.arc(T,A,50,0,2*Math.PI,!1),ctx.globalAlpha=.5,ctx.fillStyle="#555555",ctx.fill(),ctx.beginPath(),ctx.arc(T,A,10,0,2*Math.PI,!1),ctx.globalAlpha=.7,ctx.fillStyle="#AAAAAA",ctx.fill()}if(ctx.restore(),mousedrag&&!nojoystick){var j=Math.round((lastmouse.x-C.left)/(C.right-C.left)*canvas.width),P=Math.round((lastmouse.y-C.top)/(C.bottom-C.top)*canvas.height),O=Math.round((currentmouse.clientX-C.left)/(C.right-C.left)*canvas.width),L=Math.round((currentmouse.clientY-C.top)/(C.bottom-C.top)*canvas.height);ctx.beginPath();var H=ctx.lineWidth;ctx.lineWidth=2,ctx.strokeStyle="#999999",ctx.moveTo(j,P),ctx.lineTo(O,L),ctx.stroke(),ctx.beginPath(),ctx.arc(O,L,4,0,2*Math.PI,!1),ctx.fillStyle="#999999",ctx.stroke(),ctx.fill(),ctx.lineWidth=H}ctx.font="20px Comic Sans MS",ctx.fillStyle="#555555",ctx.textAlign="center";var R=Math.floor((-xscroll-(l>2&&1>=l%2?4:0))%secwidth%(2*rarity));if(ctx.fillText("Next obstacle: "+(2*rarity-R),100,h-20),ctx.font="20px Comic Sans MS",ctx.fillStyle="#000000",ctx.textAlign="left",ctx.fillText("Level/Half-Days: "+l,0,60),gameOver){ctx.font="30px Comic Sans MS",ctx.fillStyle="red",ctx.textAlign="center",pendingquit||(endscore=score+Math.round(pogo.frame.body.position[0])-Math.floor(w/50/2),newtopscore=!1,endscore>topscore&&(topscore=endscore,newtopscore=!0,document.cookie="topscore="+endscore+"; expires=Tue, 19 Jan 2038 03:14:07 UTC"),pendingquit=!0,setTimeout(function(){return leftplay?void(leftplay=!1):(gameOver=!1,pendingquit=!1,void initgame())},3e3));var F="";newtopscore&&(F="New High Score!\n"),ctx.fillText(F+"Score: "+endscore,canvas.width/2,canvas.height/2-40)}else ctx.font="16px Comic Sans MS",ctx.fillStyle="black",ctx.textAlign="left",ctx.fillText("High Score: "+topscore,10,20),ctx.fillText("Score: "+(score-Math.floor(w/50/2)+Math.round(pogo.frame.body.position[0])),10,36)}function getCookie(e){for(var t=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var l=o[n];" "==l.charAt(0);)l=l.substring(1);if(0==l.indexOf(t))return l.substring(t.length,l.length)}return""}function drawObstacles(){for(var e=w/50/2,t=e-1,n=-xscroll,l=Math.floor((n+t)/(2*rarity)),i=0;i<obstacles.length;i++)o=obstacles[i],Math.abs(o.position[0]-n)<=e&&(ctx.beginPath(),ctx.arc(o.position[0],o.position[1],.5,0,2*Math.PI,!1),ctx.stroke());canvas_arrow(n+t-.3,obstacles[l].position[1],n+t+.5,obstacles[l].position[1]),ctx.strokeStyle="#000000"}function drawpogo(){ctx.fillStyle=color.stick,drawbox(pogo.stick),colorful&&ctx.fill(),ctx.fillStyle=color.body,drawbox(pogo.frame),colorful&&ctx.fill()}function drawbox(e){ctx.beginPath();var t=e.body.interpolatedPosition[0],o=e.body.interpolatedPosition[1];ctx.save(),ctx.translate(t,o),ctx.rotate(e.body.angle),ctx.rect(-e.shape.width/2,-e.shape.height/2,e.shape.width,e.shape.height),ctx.stroke(),ctx.restore()}function drawObstacles1(e){for(var t=-1!=e.h.body.position[0],n=w/50/2,l=n-1,i=-xscroll,a=Math.floor((i+l)/(2*rarity)),s=0;s<e.o.length;s++)o=e.o[s],Math.abs(o.position[0]-i)<=n&&(ctx.beginPath(),ctx.arc(o.position[0],o.position[1],.5,0,2*Math.PI,!1),ctx.stroke());try{if(!t){var c=sectionA.o.concat(sectionB.o);canvas_arrow(i+l-.3,c[a].position[1],i+l+.5,c[a].position[1]),ctx.strokeStyle="#000000"}}catch(r){return}}function canvas_arrow(e,t,o,n){var l=.5,i=Math.atan2(n-t,o-e);ctx.beginPath(),ctx.moveTo(e,t),ctx.lineTo(o,n),ctx.lineTo(o-l*Math.cos(i-Math.PI/6),n-l*Math.sin(i-Math.PI/6)),ctx.moveTo(o,n),ctx.lineTo(o-l*Math.cos(i+Math.PI/6),n-l*Math.sin(i+Math.PI/6)),ctx.stroke()}function initControls(){jloc={x:3*w/4,y:3*h/4},window.addEventListener("keydown",keydown,!1),window.addEventListener("keyup",keyup,!1),window.addEventListener("keypress",keypress,!1),canvas.onmousedown=onmousedown,canvas.addEventListener("touchstart",ontouchstart,!1),canvas.addEventListener("touchmove",ontouchmove,!1),canvas.addEventListener("touchend",ontouchend,!1)}function handleOrientation(e){var t=-e.gamma;t=2*Math.PI*t/360;var o=getDifference(t,pogo.frame.body.angle);pogo.frame.body.angularVelocity=3*o}function ontouchstart(e){if(e.preventDefault(),nojoystick)return pogo.spring.restLength=1.25,void pogo.spring.applyForce();pogo.spring.restLength=.25,pogo.spring.applyForce(),currentmouse={clientX:e.touches[0].clientX,clientY:e.touches[0].clientY};var t=Math.atan2(currentmouse.clientX-lastmouse.x,currentmouse.clientY-lastmouse.y);pogo.frame.body.angularVelocity=3*(t-pogo.frame.body.angle)}function ontouchmove(e){nojoystick||(currentmouse={clientX:e.touches[0].clientX,clientY:e.touches[0].clientY},e.preventDefault(),null!=lastmouse.x?(lastmouse.x!=e.touches[0].clientX,a=lastmouse.x-e.touches[0].clientX,b=lastmouse.y-e.touches[0].clientY,reacttocontrols()):lastmouse=fixedjoy?{x:jloc.x,y:jloc.y}:{x:e.touches[0].clientX,y:e.touches[0].clientY},mousedrag=!0)}function ontouchend(){return nojoystick?(pogo.spring.restLength=.25,void pogo.spring.applyForce()):(currentmouse=null,mousedrag=!1,lastmouse={x:null,y:null},pogo.frame.body.angularVelocity=0,pogo.spring.restLength=1.25,void pogo.spring.applyForce())}function onmousedown(){pogo.spring.restLength=.25,pogo.spring.applyForce(),nojoystick||(document.onmousemove=function(e){currentmouse=e,null!=lastmouse.x?(lastmouse.x!=e.clientX,a=lastmouse.x-e.clientX,b=lastmouse.y-e.clientY,reacttocontrols()):lastmouse=fixedjoy?{x:jloc.x,y:jloc.y}:{x:e.clientX,y:e.clientY},mousedrag=!0}),this.onmouseup=function(){document.onmousemove=null,currentmouse=null,mousedrag=!1,lastmouse={x:null,y:null},pogo.frame.body.angularVelocity=0,pogo.spring.restLength=1.25,pogo.spring.applyForce()}}function reacttocontrols(){var e=Math.atan2(currentmouse.clientX-lastmouse.x,currentmouse.clientY-lastmouse.y),t=getDifference(e,pogo.frame.body.angle);pogo.frame.body.angularVelocity=3*t}function getDifference(e,t){var o=e-t;return o=function(e,t){return e-Math.floor(e/t)*t}(o+Math.PI,2*Math.PI),o-=Math.PI}function keydown(e){[32,37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault(),
e.keyCode!=keys.up&&e.keyCode!=keys.space||(pogo.spring.restLength=1.25,pogo.spring.applyForce()),e.keyCode==keys.left&&(pogo.frame.body.angularVelocity=+twistval),e.keyCode==keys.right&&(pogo.frame.body.angularVelocity=-twistval)}function keyup(e){e.keyCode!=keys.up&&e.keyCode!=keys.space||(pogo.spring.restLength=.25,pogo.spring.applyForce()),e.keyCode!=keys.left&&e.keyCode!=keys.right||(pogo.frame.body.angularVelocity=0)}function keypress(e){[32,37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault(),e.keyCode==keys.left&&(pogo.frame.body.angularVelocity=twistval),e.keyCode==keys.right&&(pogo.frame.body.angularVelocity=-twistval)}var gameOver=!1,pendingquit=!1,pause=!1,lives=3,tutorialm=!1,leftplay=!1,topscore=0,score=0,world,pogo,firstrh=!0,angularVelocity=-.25,stiffness=350,damping=.5,restLength=.25,FRAME=1,STICK=2,GROUND=4,OBSTACLE=8,rarity=10,mobile=!1,nojoystick=!1,heightfield,sectionA={d:null,h:null,o:null},sectionB={d:null,h:null,o:null},secnum=0,secwidth=null,padding=2,caveDepth=4,caveHeight=5,lvlCnt=5,lvl1length=100,tutlvl=0,numDataPoints=500,heightfield=new Object,data=[],obstacles=[],tut={tutlvl0:function(){pogo={stick:new Object,frame:new Object,spring:null},pogo.stick.shape=new p2.Box({width:.25,height:1.6}),pogo.stick.body=new p2.Body({mass:.25,position:[0,2.75],angularVelocity:angularVelocity,velocity:[5,0]}),pogo.frame.shape=new p2.Box({width:.5,height:1.5,sensor:!0}),pogo.frame.body=new p2.Body({mass:3,position:[0,3],angularVelocity:angularVelocity,velocity:[5,0]}),pogo.frame.body.addShape(pogo.frame.shape),pogo.stick.body.addShape(pogo.stick.shape),world.addBody(pogo.frame.body),world.addBody(pogo.stick.body);var e=new p2.PrismaticConstraint(pogo.frame.body,pogo.stick.body,{localAnchorA:[0,.5],localAnchorB:[0,.5],localAxisA:[0,1],disableRotationalLock:!0}),t=new p2.PrismaticConstraint(pogo.frame.body,pogo.stick.body,{localAnchorA:[0,0],localAnchorB:[0,1],localAxisA:[0,1],disableRotationalLock:!0});e.setLimits(-1,-.4),world.addConstraint(t),world.addConstraint(e),pogo.spring=new p2.LinearSpring(pogo.frame.body,pogo.stick.body,{restLength:restLength,stiffness:stiffness,damping:damping,localAnchorA:[0,0],localAnchorB:[0,0]}),world.addSpring(pogo.spring);var o=1,n=2;pogo.frame.shape.collisionGroup=o,pogo.stick.shape.collisionGroup=n,pogo.frame.shape.collisionMask=~n,pogo.stick.shape.collisionMask=~o},tutlvl1:function(){heightfield.shape=new p2.Heightfield({heights:data,elementWidth:2}),heightfield.body=new p2.Body({position:[-1,-1]}),heightfield.body.addShape(heightfield.shape),world.addBody(heightfield.body);var e=4;heightfield.shape.collisionGroup=e,heightfield.shape.collisionMask=-1},tutlvl2:function(){var e=8;obstacles=[];for(var t=5;200>t;t++)if(t%r==0){Math.random()>.5?y=data[t]+2*Math.random():y=data[t]+5-2*Math.random();var o=new p2.Circle({radius:.5}),n=new p2.Body({mass:1,position:[2*t,y],fixedX:!0,fixedY:!0});n.addShape(o),o.collisionGroup=e,obstacles.push(n),world.addBody(n)}}},canvas,ctx,w,h,colorful=!0,colordef={sky:"#4d79ff",skyday:"#4d79ff",skynight:"#241c52",ground:"#00b300",body:"#ed00ed",stick:"#ff66ff"},color={sky:"#4d79ff",skyday:"#4d79ff",skynight:"#241c52",ground:"#00b300",body:"#ed00ed",stick:"#ff66ff"},cloudSpeed=1,cloudSize=100,cloudSpeedDef=1.5,cloudSpeedMin=.2,cloudCnt=5,clouds=[];speed=300;var lastTime,maxSubSteps=5,fixedDeltaTime=1/speed,xscroll=0,yscroll=0,endscore=0,newtopscore=!1,twistval=3.5,fixedjoy=!0,jloc=new Object,keys={left:37,right:39,up:38,space:32},mousedrag=!1,currentmouse=null,lastmouse={x:null,y:null};